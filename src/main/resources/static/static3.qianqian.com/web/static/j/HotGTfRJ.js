define(["core/utils","widget/toast/toast","widget/ushare/ushare","tmpl/rank/urank/guizeTmpl"],function(i,t,e,n){var a=$(".rule");a.on("click",".rul-btn",function(i){var t=n();$(".rule").append(t);a.find(".rul-bg").show();$(".rule-bg").show()}).on("click",".rule-hot",function(i){a.find(".rul-bg").hide();$(".rule-bg").hide()});var s=$("#bang-wrapper");s.on("click",".icon-date",function(i){s.find(".qishu").show()}).on("click",".qishu-btn",function(i){s.find(".qishu").hide()});s.on("click",".qishu",function(i){$(".qishu-content").removeClass("qishu-visit");$(i.target).addClass("qishu-visit");$(".qishu-btn").removeClass("qishu-visit")});var u=$(".music-body"),o=function(i){e.init({onlyLetter:false,shareParam:{bdText:"推荐一张"+i.artist_name+"的专辑《"+(i.album_title||i.title)+"》 （分享自@千千音乐）",bdDesc:i.album_title,bdUrl:"http://music.taihe.com/cms/webview/song_buy/index_tpay/index.html?type=2&type_id="+i.album_id,bdPic:i.album_pic},apiParam:{userid:ting.userInfo&&ting.userInfo.userId,source_type:2,source_id:i.album_id},addNumCallBack:function(){if(i.artist_id){d({artist_id:i.artist_id||"",add_type:"share",album_id:""})}}});e.show()},l=function(e,n,a,s,u){if(ting&&ting.media){ting.passport.checkLogin(function(){$(".sellpage-content-box, .sellpage-content-box-bg").remove();ting.media.sellAlbum(e,n,{title:"购买专辑，为你心中的ta打榜助威！"},a,s||"urank",u);ting.logger.log("illclick",{page:"付费弹窗",sub:"",pos:""});$("body").off("click",".sellpage-tobuy").on("click",".sellpage-tobuy",function(){var e=$(this).data("id")||"";var n=$(this).data("artistid")||"";var a=Number($("#sell-num").val())||0;var s={type_id:e,type:2,nums:a,action:"cloud",pay_type:"zfb",pay_client_type:2,callback_url:location.href+"?album_id="+e+"&artist_id="+n+"&shouhu_num="+a};i.tingApi("baidu.ting.pay.sorder",s).done(function(i){window.open(i.result.desk_url);$(".sellpage-content-box, .sellpage-content-box-bg").remove()}).fail(function(i){t.show({data:{cls:"fail",text:"操作失败，请稍后重试！"}})})})})}},c=function(i){if(!i.album_id){t.show({data:{cls:"fail",text:"该专辑不存在"}});return false}if(ting&&ting.media){ting.media.playAlbum(i.album_id);if(i.artist_id){d({artist_id:i.artist_id,add_type:"listen",album_id:""})}t.show({data:{cls:"succ",text:"开始播放"}})}},r=function(e){if(!e.album_id){t.show({data:{cls:"fail",text:"该专辑不存在"}});return false}ting.passport.checkLogin(function(){var n={list_id:e.album_id||"",source:1};i.tingApi("baidu.ting.ugcdiy.addFavoriteDiy",n).done(function(i){t.show({data:{cls:"succ",text:"收藏成功"}});if(e.artist_id){d({artist_id:e.artist_id,add_type:"collect",album_id:e.album_id||""})}}).fail(function(i){switch(Number(i.error_code)){case 22713:errTip="已收藏过专辑 ";break;case 22001:errTip="操作失败，请稍候再试 ";break;case 22706:errTip="收藏数量已满，去个人中心管理收藏吧";break;default:errTip="操作失败，请稍候再试 "}t.show({data:{cls:"fail",text:errTip}})})})},d=function(e){if(e){var n=setTimeout(function(){clearTimeout(n);i.tingApi("baidu.ting.active.addUpNum",e).done(function(i){t.show({data:{cls:"succ",text:"up值添加成功"}})}).fail(function(i){})},2e3)}},f=function(i,t){if(!t){return false}var i=i||window.location.search;i=i.substring(1);i=i.split("&");var e=[];var n={};for(var a=0;a<i.length;a++){e=i[a].split("=");n[e[0]]=e[1]}return n[t]};u.on("click",".share",function(){var i=$(this).closest(".three-btn").data("album")||0;if(i){if(!ting.userInfo){ting.passport.checkLogin(function(t){o(i)})}else{o(i)}}}).on("click",".collect",function(){var i=$(this).closest(".three-btn").data("album")||0;if(i){if(!ting.userInfo){ting.passport.checkLogin(function(t){r(i)})}else{r(i)}}}).on("click",".play",function(){var i=$(this).closest(".three-btn").data("album")||0;if(i){if(!ting.userInfo){ting.passport.checkLogin(function(t){c(i)})}else{c(i)}}}).on("click",".buy-zj",function(i){l($(this),i)}).on("click",".rule-bg",function(){a.find(".rul-bg").hide();$(".rule-bg").hide()});return{addUpNums:function(i){d(i)},showBuyAlbum:function(i,t,e,n,a){l(i,t,e,n,a)},getUrlParam:function(i,t){return f(i,t)}}});

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/