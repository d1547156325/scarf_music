define(["core/utils","tmpl/feed/list","tmpl/feed/details","tmpl/songpage/samesonglastTmpl","tmpl/songpage/maybelovelastTmpl","tmpl/feed/feedlivelastTmpl","widget/report/report","widget/toast/toast","widget/pop_window/pop_window"],function(e,i,t,a,d,n,o,s,l){var r={};var f={baseEl:$("body"),apiParam:{type:21,type_id:0,author_id:0},innerSelect:".feed-box",callback:function(){}};var m=function(e){r.options=$.extend(f,e)||{};r.$base=r.options.baseEl;r.$ucmInner=$(r.options.innerSelect,r.$base);r.$listBox=$(".feed-list");r.mv=r.$base.find(".feed-mv");r.$listTmpl=$(".feed-box");r.songId=r.options.id||r.$listTmpl.data("songid");p();getList(r.songId,r.options.type)},p=function(){r.$listTmpl.on("click",".add-zan",function(){var e=$(this);ting.passport.checkLogin(function(){if(e.hasClass("icon-like-ard")){likeFuc(2,e)}else{likeFuc(1,e)}})}).on("click",".icon-report",function(){var e=$(this);ting.passport.checkLogin(function(){var i=getItem(e);o.init({baseEl:r.$ucmInner,apiParam:{report_id:0,type:r.options.apiParam.type,type_id:0}})})}).on("click",".icon-close",function(){var e=$(this);r.$details.hide();r.$mask.hide();$("body").css("overflow","initial")}).on("click",".feed-item h3, .feed-item .feed-detail-btn, .feed-img img",function(){var e=$(this);var i=e.parents(".feed-item").data("feedid");try{var t=e.parents(".feed-item").data("feedtype");if(t==8){var a=e.parents(".feed-item").data("spec_id").split("_");window.open("//music.taihe.com/h5pc/spec_detail?id="+a[1]+"&columnid="+a[0]);return}}catch(d){}loadListTmpl(i)});$(".feed-main").on("click",".loadmore",function(){if($(this).hasClass("loaded")){return}getList(r.songId,r.options.type)});$(".feed-box").on("click",".feed-item",function(){var e=$(this).data("feedid");var i=$(this).data("method");var t={};if(r.options.type=="artist"){t={starid:window.location.href.split("/")[4],feedid:e,page:"m_artist",pos:"feed",sub:"news"}}else{t={msgid:e,methodid:i,msgtype:"news",page:"song",pos:"similary_feed",sub:"click"}}ting.logger.log("click",t)});$(".mv-box").on("click",".feed-item",function(){var e=$(this).data("mvid");var i=$(this).data("method");ting.logger.log("click",{msgid:feedid,methodid:i,msgtype:"mv_self",page:"song",pos:"similary_feed",sub:"click"})});if($(".feed-item")[0]){var e=window.location.href.split("/")[4];ting.logger.log("exposure",{songid:e,page:"song",pos:"similary_feed",sub:"commend"})}};loadie8=function(){var e=1350,i=document.body.clientWidth;if(i<=e){$(".feed-details").addClass("feed-details-add");$(".feed-warp").addClass("feed-warp-add")}};getItem=function(e){var i=e.parents(".feed-item");var t={};t.userid=i.data("userid");t.feedid=i.data("feedid");return t},likeFuc=function(i,t){var a=i==2?"baidu.ting.ugcfav.delFav":"baidu.ting.ugcfav.addFav";var d=getItem(t);var n=$.extend(r.options.apiParam,{author_id:d.userid,type_id:d.feedid});var o=t.parents(".feed-item").data("feedtype");if(o==8){var s=t.parents(".feed-item").data("spec_id");n.type_id=s;n.type=8}e.tingApi(a,n).done(function(e){i==2?t.removeClass("icon-like-ard"):t.addClass("icon-like-ard");var a=i==2?"取消点赞成功":"点赞成功";var d=t.find(".num-zan"),n=parseInt(d.html());d.html(i==2?--n:++n);loadToastTmpl("succ",a)}).fail(function(e){var t=i==2?"取消点赞失败":"点赞失败";loadToastTmpl("fail",t)})};sameSongSixAd=function(){$.ajax({url:"/data/live/list?offset=0&size=10",type:"GET",dataType:"json"}).always(function(e){var i=e||{};if(i.length>0){var t=$(".samesonglist-unic");t.html(a({item:i[0]}));if(i.length>1){var o=$(".maybelove-wrap-5");o.html(d({item:i[1]}))}if(i.length>2){var s=$(".maybelove-wrap-10");s.html(d({item:i[2]}))}if(i.length>5){var l=$(".feed-live-zhibo");if(l.length){l.html(n({item:i[3],picmiddle1:i[3],picmiddle2:i[4],picmiddle3:i[5]}))}}}else{}})};getList=function(t,a){var d=this;var n={limit:r.options.limit||3};if(a=="artist"){n.artist_id=t}else{n.song_id=t}if(r.options.page||r.options.page==0){n.page=r.options.page}if(r.have_more==0){loadToastTmpl("","已加载全部");return}createLoading();e.tingApi("baidu.ting.feedstream.articleList",n).done(function(e){removeLoading();r.have_more=e.have_more||0;var e=e&&e.result;r.options.page++;r.$listBox.append(i({list:e||[],page:n.page}));if((!e||e.length==0)&&(_hasMV&&_graySource)){$(".feed-main").hide()}if((!e||e.length==0)&&!_hasMV){$(".feed-main").hide()}$(".feed-mv").show();if(r.have_more==0){$(".loadmore").html("已加载全部").addClass("loaded")}if(a!="artist"&&!taihe0514){sameSongSixAd();if(!e||e.length==0){$(".feed-main").addClass("no-feed-list")}}}).fail(function(e){$(".feed-main").hide()})};loadListTmpl=function(i){var a=this;var d={feed_id:i};e.tingApi("baidu.ting.feedstream.articleContent",d).done(function(e){var e=e.result;if(e){r.$details=$(r.options.innerSelect).find(".feed-details");r.$mask=$(r.options.innerSelect).find(".feed-mask");r.$details.html(t(e));getThumbInfo(i);r.$details.show();r.$mask.show();$("body").css("overflow","hidden");loadie8()}else{loadToastTmpl("fail","获取失败，请重试！")}}).fail(function(e){loadToastTmpl("fail","获取失败，请重试！")})};getThumbInfo=function(i){var t=this;var a={feed_id:i};e.tingApi("baidu.ting.feedstream.getThumbInfo",a).done(function(e){var e=e.result;var i=e.likes_num;var t=e.is_liked;var a=Number(i)||0;if(a>9999){a=(a/1e4).toFixed(2)+" 万"}$(".feed-details .num-zan").html(a);if(t){$(".feed-details .add-zan").addClass("icon-like-ard")}}).fail(function(e){})};loadToastTmpl=function(e,i,t){s.show({innerSelect:".toast-tmpl",data:{cls:e,text:i},callback:t})};createLoading=function(){var e='<div class="feed-list-loading"></div>';r.$listBox.append(e)};removeLoading=function(){$(".feed-list-loading").remove()};r.init=function(e){m(e)};r.bookmark=function(e){scrollFnc(e)};return r});

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/