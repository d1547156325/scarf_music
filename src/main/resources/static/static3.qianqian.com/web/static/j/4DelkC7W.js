var lib=lib||{};lib.swf=lib.swf||{};(function(t){var e=null;t.widget("http://static3.qianqian.com/web/static/j/ui.mv",{options:{width:"100%",height:"100%",chainDataElem:null,data:[]},eventsMap:{dataready:"loadstart",ready:"load",startplay:"playstart",loadcomplete:"loaded",stoped:"playend"},index:-1,_create:function(){if(this.options.data&&this.options.data.length>0){this.log={};this.player=null;this.statsRecorder();this.setLogInfo();this.bindEvent();this.bindLogEvent();this.autoPlayNextMv();this.createFlash();this.addVideoList();this.playerEvent()}},createFlash:function(e){e=e||this.options.data[0];if(t.swf.version){var i=Math.random()*1e17;t.swf.create({id:"mvFlash",width:this.options.width,height:this.options.height,url:"http://dispatcher.video.qiyi.com/disp/shareplayer.swf?randomNum="+i,allowscriptaccess:"always",wmode:"opaque",allowfullscreen:true,bgcolor:"#000000",vars:{vid:e.vid,tvid:e.tvid,autoPlay:"1",autoChainPlay:"1",showSearch:"0",showSearchBox:"0",autoHideControl:"1",showFocus:"0",showShare:"0",showLogo:"0",coop:"coop_baidump3",cid:"qc_100001_300089",bd:"1",showDock:0}},this.element.get(0));t(".feed-mv-top").show()}else{var a='<h5 style="color:#fff"> 为了更好的试听体验，请开启Adobe flash。<br/><a href="http://get.adobe.com/cn/flashplayer/" style="display:block;padding: 10px 0 20px;font-size:16px;color:#e13228;text-decoration: underline;">点击即可启用</a></h5>';var o='<div class="common-pop" style="margin-left: -158px; box-shadow:none; background:none; margin-top: -49px; position: absolute;"><div class="common-pop-text">'+a+"</div> </div>";t(".feed-mv-top").append(o);t(".common-pop .cancel, .common-pop .commit, .common-pop .close").click(function(){t(".common-pop").remove()})}this.player=t.swf.getMovie("mvFlash");this._trigger("createflashsuccess")},playerEvent:function(){var e=this,i=false,a=false,o=false,n=null;if(lib.swf.notice){return}lib.swf.notice=function(r){if(t.type(r)==="string"){r=t.parseJSON(r)}if(r.type==="playerStateChange"){clearTimeout(n);var s=r.data.state;if(s==="DataReady"){i=false;a=false;o=false}e._trigger(e.getStandardEventType(s));if(s!=="Stoped"&&o){e._trigger("speedslow")}o=false;if(s==="Seeking"){a=true}else{if(s==="StartPlay"){i=true}else if(s==="Playing"&&i){i=false;e._trigger("play100ms")}else if(s==="Waiting"&&!a&&!i){o=true;n=setTimeout(function(){e._trigger("speedslow");o=false},900)}a=false}}else if(r.type!=="playStateChange"){e._trigger(e.getStandardEventType(r.type))}}},getStandardEventType:function(t){t=t.toLowerCase();return this.eventsMap[t]||t},statsRecorder:function(){var t=0,e=0,i=0,a=0,o=false,n=this;this._on({mvloadstart:function(){t=(new Date).getTime();n.resetRecorder();this.recorder.timestamp=(new Date).getTime();o=true},mvload:function(){if(o){e=(new Date).getTime()}},mvloaded:function(){if(o){a=(new Date).getTime();n.recorder.buftotal=a-t}},mvplay100ms:function(){if(o){i=(new Date).getTime();n.recorder.fromstart=i-t;n.recorder.fromload=i-e}},mvplayend:function(){o=false},mvspeedslow:function(){this.recorder.buffct++}})},resetRecorder:function(){this.recorder={fromload:-1,fromstart:-1,buftotal:-1,buffct:0,timestamp:-1}},addVideoList:function(){var e=[];t.each(this.options.data,function(t,i){e.push({tvid:i.tvid,vid:i.vid})});this._on({mvplayerloadsuccess:function(){this._callPlayer("addVideoList",{index:0,list:e})}})},_callPlayer:function(t,e){if(e===undefined){this.player[t]()}else{e=JSON.stringify(e);this.player[t](e)}},setLogInfo:function(t){t=t||this.options.data[0];this.log={ref:"mv",vid:t.vid,tvid:t.tvid,mvid:t.mvid,song_id:t.songId,song_title:t.title,singer_id:t.authorId,singer_name:t.author,album_id:t.albumId,album_name:t.albumTitle,time:t.time,source:t.source}},bindEvent:function(){var e=this.options,i=e.chainDataElem,a=this;i.find(".mv-cover a").on("click",function(){var e=t(this).parents("li"),o=i.index(e);a.playIndex(o)})},bindLogEvent:function(){if(!(ting&&ting.logger&&ting.logger.log)){return}var e=this.log,i=this;this._on({mvchangemv:function(){e=i.log},mvplaystart:function(){var a={timestamp:i.recorder.timestamp};t.extend(a,e);ting.logger.log("playstart",a)},mvplay100ms:function(){var a={fromload:i.recorder.fromload,fromstart:i.recorder.fromstart,timestamp:i.recorder.timestamp};t.extend(a,e);ting.logger.log("playsong100ms",a)},mvloaded:function(){var a={buftotal:i.recorder.buftotal,timestamp:i.recorder.timestamp};t.extend(a,e);ting.logger.log("loaded",a)},mvplayend:function(){var a={};t.extend(a,i.recorder,e);ting.logger.log("playend",a)},mverror:function(){var a={};t.extend(a,i.recorder,e);ting.logger.log("playerror",e)},mvspeedslow:function(){if(i.recorder.buffct===1){var a={timestamp:i.recorder.timestamp};t.extend(a,e);ting.logger.log("firsthalt",a)}}})},autoPlayNextMv:function(){this._on({mvloadstart:function(){this.playNext()}})},playMv:function(t){this.setLogInfo(t);this._trigger("changemv");this.refreshHtml(t)},setIndex:function(t){var e=this.options,i=e.data;if(t<0||t>=i.length){return}this.animateIndex(t);this.index=t;this.playMv(e.data[t])},animateIndex:function(t){var e=this.options,i=e.chainDataElem.eq(this.index),a=e.chainDataElem.eq(t);i.removeClass("actived");i.find(".play-tip").remove();a.addClass("actived");a.find(".mv-cover").append('<div class="play-tip"><div class="bg"></div><div class="tip-text">正在播放...</div></div>')},playIndex:function(t){var e=this.options,i=e.data[t];this._callPlayer("loadQiyiVideo",{tvid:i.tvid,vid:i.vid});this.animateIndex(t);this.index=t-1},getPlayer:function(){return this.player},playNext:function(){this.setIndex(this.index+1)},refreshHtml:function(e){window._bd_share_config.common.bdText="推荐"+e.author+"的MV《"+e.title+"》 （分享自@千千音乐）";window._bd_share_main.init();t("#mv_title").html("[MV]"+e.author+"-"+e.title);var n="<li>歌曲："+a(e)+"</li>                         <li>歌手："+o(e)+"</li>                         <li>时长："+i(e.time)+"</li>                         <li>发行时间："+r(e)+"</li>";t("#info").html(n)}});var i=function(t){var e=Math.floor(t/60),i=t%60;if(e<10){e="0"+e}if(i<10){i="0"+i}return e+":"+i};var a=function(t){var e='<a href="';if(t.songId){if(t.idhash){e+="/song/s/"+t.idhash}else{e+="/song/"+t.songId}}else{e+="/search?key="+encodeURIComponent(t.title)}e+='" title="'+t.title+'" target="_blank">'+t.title+"</a>";return e};var o=function(e){var i=' <span class="author_list" title="'+e.author+'">',a=e.authorId.toString().split(","),o=e.author.toString().split(","),n=a.length;t.each(a,function(t,a){if((e.relateStatus==0||e.relateStatus==1)&&a>0){i+='<a target="_blank" href="/artist/'+a+'" title="'+o[t]+'">'+o[t]+"</a>"}else{i+='<a target="_blank" href="/search?key='+encodeURIComponent(o[t])+'" title="'+o[t]+'">'+o[t]+"</a>"}if(t<n-1){i+='<span class="artist-line">&nbsp;/&nbsp;</span>'}});i+="</span>";return i};var n=function(t){if(!t.albumTitle){return"未知"}var e='<a target="_blank" ';if(t.relateStatus==0||t.relateStatus==2){e+='href="/album/'+t.albumId+'" title="'+t.albumTitle+'">'}else{e+='href="/search?key='+encodeURIComponent(t.albumTitle)+'" title="'+t.albumTitle+'">'}e+="《"+t.albumTitle+"》</a>";return e};var r=function(t){if(!t.publishTime||t.publishTime==""){return"未知"}return t.publishTime}})(jQuery);

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/