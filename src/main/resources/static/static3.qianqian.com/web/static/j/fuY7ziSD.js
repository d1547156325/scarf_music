define(["core/utils","tmpl/songlist/collectToTmpl","widget/toast/toast"],function(t,e,i){var o=$(".songlist-info-desc-text"),n=$(".adds"),s=$(".btn-collect-to-songlist"),a=n.data("songid"),l=false;init=function(i,o,s,l){n=l.find(".adds");a=o||l.data("songid");ting.passport.checkLogin(function(){t.tingApi("baidu.ting.ugcdiy.userList",{size:500,source:0,type:10,offset:0}).done(function(t){if($(".songlist-collect-to")){$(".songlist-collect-to").remove()}l.closest(".adds").append(e(t.result));if(s){s()}$("body").on("click",".cerate-songlist-btn",function(t){var t=t||window.envet;t.preventDefault();if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=true}var e=$(this);if(!ting.userInfo){ting.passport.checkLogin(function(t){window.location.reload()})}else{e.hide();$(".create-newList-btn").show();$(".create-newList-name").show().focus();if(ting&&ting.logger){ting.logger.log("click",{page:"songdetail",pos:"createsonglist"})}return false}})})})};$("body").click(function(t){var t=t||window.envet;if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=true}var e=t.target.className;if(e.indexOf("songlist-title-tip")>-1||e.indexOf("icon-collects")>-1||e.indexOf("create-newList-btn")>-1||e.indexOf("cerate-songlist-btn")>-1||e.indexOf("create-newList-name")>-1){return false}closeSonglist()});closeSonglist=function(){$(".songlist-collect-to, .create-newList-btn").hide();$(".create-newList-name").hide();$(".songlist-title-tip").hide().html("");$(".cerate-songlist-btn").show()};createNewSonglist=function(e){var e=e||window.envet;e.preventDefault();if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}if(!l){$(".songlist-title-tip").show().html("歌单名不正确");return false}var i=$(".create-newList-name").val();if(i==""||!a){$(".create-newList-name").addClass("red-border");return false}$(".create-newList-name").removeClass("red-border");var o={title:i};t.tingApi("baidu.ting.ugcdiy.addSongList",o).done(function(e){if(e.error_code==22e3){var i=e.result.list_id}var o={list_id:i,song_ids:a};if(o.song_ids&&o.list_id){t.tingApi("baidu.ting.ugcdiy.sortDiySongs",o).done(function(t){opt={msg:"新建歌单已保存",iconClass:"tip-success"};s.tip().tip("tipup",opt);closeSonglist()}).fail(function(t){opt={msg:"歌单列表保存失败",iconClass:"tip-error"};s.tip().tip("tipup",opt);closeSonglist()})}else{opt={msg:"新建歌单已保存",iconClass:"tip-success"};s.tip().tip("tipup",opt);closeSonglist()}}).fail(function(t){if(t.error_code==22231){$(".songlist-title-tip").show().html("歌单名含有 '"+t.filter_word+"' 等不合法，请重新输入")}else{opt={msg:"新建歌单保存失败",iconClass:"tip-error"};s.tip().tip("tipup",opt)}})};$("body").on("click",".create-newList-btn",createNewSonglist);$("body").on("click",".create-newList-name",function(t){var t=t||window.envet;t.preventDefault();if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=true}});$("body").on("keyup",".create-newList-name",function(t){if(t.keyCode==13){createNewSonglist();return false}var e=$(".create-newList-name").val();if(e==""||$.trim(e)==""){$(".songlist-title-tip").show().html("歌单名不能为空");return false}if(e.length>20){$(".songlist-title-tip").show().html("歌单名长度需在20以内");return false}l=true;$(".songlist-title-tip").hide()});$("body").on("click",".mylist-mysonglist",function(e){var e=e||window.envet;e.preventDefault();if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}var o=$(this);var n=$(".songlist-collect-to").attr("data-songindex");var s=o.data("listid");var l={list_id:s,song_ids:a};t.tingApi("baidu.ting.ugcdiy.addSongToDiy",l).done(function(t){i.show({data:{cls:"succ",text:"成功添加到歌单"}});$(".songlist-collect-to").remove();$(".add-to").hide()}).fail(function(t){var e="";switch(Number(t.error_code)){case 22001:case 22005:e="操作失败,请重试！";break;case 22452:e="请先登录";break;case 22682:e="歌单歌曲数量超出限制";break;default:e="操作失败,请重试！";break}i.show({data:{cls:"fail",text:"errorText"}});$(".songlist-collect-to").remove();$(".add-to").hide()})});return{createSonglists:function(t,e,i,o){init(t,e,i,o)},closeSonglist:function(){closeSonglist()}}});

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/