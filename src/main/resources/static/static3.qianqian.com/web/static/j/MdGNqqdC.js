(function(t,e){if(typeof exports==="object"){return module.exports=e()}else if(typeof define==="function"&&define.amd){return define("muplayer/plugin/lrc",e)}else{return t._mu.Lrc=e()}})(this,function(){var t,e,r,i,s,n;r=/\n|\r/;n=/\[[\s\S]*?\]/;s=/\[\d{2,}:\d{2}(?:[\.|:]\d{2,5})?\]/g;e=/\[offset:[+|\-]?\d+?(?=\])/;i=function(t){var e,r,i,s;s=t.split(":");e=s[0];if(s.length===3){i=s[1];r=s[2]}else{s=s[1].split(".");i=s[0];r=s[1]}return~~e*60*1e3+~~i*1e3+~~r};t=function(){t.prototype.defaults={lrc:"",el:"",ul:'<ul style="position:relative"></ul>',itemTmpl:_.template('<li class="<%- cls %>" lang="<%- time %>"><%= txt && _.escape(txt) || "&nbsp;" %></li>'),cls:"muui-lrc",itemCls:"muui-lrc-item",scrollingCls:"muui-lrc-scrolling",duration:500,offset:0};function t(t){var e;this.opts=e=$.extend({},this.defaults,t);if(!e.el){throw new Error("el cannot be empty.")}this.$el=$(e.el).addClass(e.cls);this.$ul=$(e.ul).appendTo(this.$el);this.create(e.lrc)}t.prototype.create=function(t){delete this._curLine;this.lrc=t;this.parse();return this.render()};t.prototype.render=function(){var t,e,r,i,s,n,l,o,u,a,c;t=this.$el,e=this.$ul,u=this.opts,l=u.itemTmpl,c=u.scrollingCls,n=u.itemCls;a=this._parsed;for(i=0,o=a.length;i<o;i++){s=a[i];e.append(l({cls:n,time:s[0],txt:s[1]}))}r=_.debounce(function(){return t.removeClass(c)},1e3);t.on("scroll",function(){t.addClass(c);return r()}).html(e);return this.$item=t.find("."+n)};t.prototype.scrollTo=_.throttle(function(t,e){var r,i,s,n,l,o,u,a,c;t=~~t;if(!t||this.getState()!=="lrc"){return}r=this.$el,i=this.$item,o=this.opts,u=this.opts,a=u.scrollingCls,l=u.offset,s=u.duration;if(r.hasClass(a)){return}n=this.findLine(t);if(n===-1){return r.scrollTop(0)}else if(n===this._curLine){return}i.removeClass("on");this._curLine=n;c=i.eq(n).addClass("on").position().top-r.height()/2+13;if(c<0){c=0}if(e===false){return}return r.stop(true).animate({scrollTop:c},s)},500);t.prototype.isLrc=function(t){return s.test(t)};t.prototype.setState=function(t){this._state=t;return this.$el.addClass(t)};t.prototype.getState=function(){return this._state};t.prototype.parseLrc=function(t){var n,l,o,u,a,c,p,f,h,d,m,g,y;d=[];h=0;if(f=t.match(e)){h=~~f[0].slice(8)}m=t.split(r);for(n=0,a=m.length;n<a;n++){p=m[n];if(o=p.match(s)){if($.isArray(o)){y=$.trim(p.replace(o.join(""),""))}for(u=0,c=o.length;u<c;u++){l=o[u];g=i(l.slice(1,-1))+h;d.push([g,y])}}}if(d.length){this._parsed=d.sort(function(t,e){return t[0]-e[0]});return this.setState("lrc")}else{return this.setState("no-lrc")}};t.prototype.parseTxt=function(t){var e,i,s,l,o;o=[];l=t.replace(n,"").split(r);for(e=0,i=l.length;e<i;e++){s=l[e];s=$.trim(s);if(s){o.push([-1,s])}}if(o.length){this._parsed=o;return this.setState("txt-lrc")}else{return this.setState("no-lrc")}};t.prototype.parse=function(){var t;t=this.lrc;if(!_.isString(t)||!(t=$.trim(t))){return this.setState("no-lrc")}if(this.isLrc(t)){return this.parseLrc(t)}else{return this.parseTxt(t)}};t.prototype.findLine=function(t){var e,r,i,s,n;s=this._parsed;if(!s||!s.length){return-1}r=0;n=s.length;i=this._curLine||0;e=function(t){var e;e=s[t];return e&&e[0]||Number.MAX_VALUE};if(t<e(0)){return-1}while(true){if(t<e(i)){n=i-1}else{r=i+1}i=Math.floor((r+n)/2);if(t>=e(i)&&t<e(i+1)){break}}return i};return t}();return t});

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/