require(["core/utils","tmpl/dynamic/dynamicTmpl","page/dynamic/publish","widget/ucomment/ucomment","widget/pop_window/pop_window","page/dynamic/dynamic_picList","widget/report/report","ting/ting.traceSource"],function(i,a,t,e,n,s,d){var m=$(".dynamic-list"),c=$(".page-navigator-hook"),r=$(".dynamic"),o=$(".loading-dynamic"),g=0,p="",l="",u="",f=2,y=0,v=function(){},h="",_=0;init=function(){getDyData()},getDyData=function(){l=$(".dynamic-detail").data("msgid");var t={msgid:l};i.tingApi("baidu.ting.ugcfriend.getDetail",t).done(function(i){u=i.msg.author.userid;f=i.msg.isAuthor;i.msg.dynamicDetail=true;m.append(a({item:i.msg}));var t={};var e={};var n=[];if(i.msg.piclist){for(var d=0;d<i.msg.piclist.length;d++){n.push(i.msg.piclist[d].master)}}t.picList=n;t.msgid=i.msg.msgid+"--"+h+"-"+i.msg.specFlag;e[i.msg.msgid+"--"+h+"-"+i.msg.specFlag]=t;var t={};var n=[];if(i.msg.msg_parent&&i.msg.msg_parent.piclist){for(var d=0;d<i.msg.msg_parent.piclist.length;d++){n.push(i.msg.msg_parent.piclist[d].master)}t.picList=n;t.msgid=i.msg.msgid+"-"+i.msg.msg_parent_id+"--"+h+"-"+i.msg.msg_parent.specFlag;e[i.msg.msgid+"-"+i.msg.msg_parent_id+"--"+h+"-"+i.msg.msg_parent.specFlag]=t}s.createPreview({msg:i.msg,el:$(".dynamic-pics-hook-"+i.msg.msgid+"-"+h+"-"+i.msg.specFlag)});if(i.msg.msg_parent){var c={msg:i.msg.msg_parent,el:$(".dynamic-pics-hook-"+i.msg.msgid+"-"+i.msg.msg_parent.msgid+"-"+h+"-"+i.msg.msg_parent.specFlag)};c.msg.msgid=i.msg.msgid+"-"+i.msg.msg_parent.msgid;s.createPreview(c)}s.initPreviews(e);m.append('<a href="javascript:void(0)" class="more-btn fr pa"></a>');$(".ucomment-box").show();r.addClass("dynamic-show");o.addClass("loading-hide");showComment();if($(".dynamic-detail-wrap").data("ucomment")==1){var g=setTimeout(function(){clearTimeout(g);$("html, body").animate({scrollTop:$("#ucomment-bookmark").offset().top},300,function(){$(".textarea-hook").focus()})},1e3)}require(["page/uuser/friend"])})},addZan=function(a){var a=a;ting.passport.checkLogin(function(t){var e={type:a.data("zantype"),type_id:a.closest(".dynamic").data("dynamicid"),author_id:a.data("userid")};i.tingApi("baidu.ting.ugcfav.addFav",e).done(function(i){if(i.error_code==22e3){a.removeClass("add-zan").addClass("del-zan")}getZanUserList()}).fail(function(){})})},delZan=function(a){var a=a;var t={type:a.data("zantype"),type_id:a.closest(".dynamic").data("dynamicid"),author_id:a.data("userid")};i.tingApi("baidu.ting.ugcfav.delFav",t).done(function(i){if(i.error_code==22e3){a.removeClass("del-zan").addClass("add-zan")}getZanUserList()}).fail(function(){})},getZanUserList=function(){var a={msgid:l};i.tingApi("baidu.ting.ugcfriend.getDetail",a).done(function(i){if(i.msg.zan_list){require(["tmpl/dynamic/dynamicZanUserTmpl"],function(a){var t=a({item:i.msg});$(".zan-userlist").html(t)})}}).fail(function(){})},changeRecomment=function(){var i=$(".recomment-user ul");var a=$(".recomment-user ul").length;if(y<a-1){y++}else{y=0}i.hide();i.eq(y).show()},showComment=function(){e.init({apiParam:{type:4,type_id:l,author_id:u}})},t.init({baseEl:$(".music-body"),callback:function(){}});$(".dynamic-list").on("click",".share",function(){var i=$(this);ting.passport.checkLogin(function(){var a=i.data("share");var e=0;if(a.parentUser){e=2;parentUser=a.user}else{e=1}var n={dorigin:{msg_id:a.parentMsgId||a.msgId||0,user:a.parentUser||a.user||{},topic_id:a.topicId||0,topic_title:a.topicTitle},dparent:{msg_id:a.msgId,msg_title:$(".dynamic-texts-"+a.msgId).text()||"",user:a.user||{},msg_users:a.msgUsers||[]}};t.show(e,n)})});$(".add-zan").live("click",function(){addZan($(this))});$(".del-zan").live("click",function(){delZan($(this))});$(".more-btn").live("click",function(i){i.stopPropagation();if(f==1){$(".dynamic-list").append('<em class="dynamic-del dynamic-pa pa"><i class="pa arrow"></i>删除</em>')}else{$(".dynamic-list").append('<i class="dynamic-report dynamic-pa pa"><em class="pa arrow"></em>举报</i>')}});$(".dynamic-report").live("click",function(i){var a=$(".dynamic-data-hook").eq(0),t=a.data("dynamicid"),e=a.data("userid");ting.passport.checkLogin(function(){d.init({apiParam:{report_id:e,type:4,type_id:t}})})});$(".dynamic-del").live("click",function(){pop=n.create({spPop:true,title:"是否删除该动态？",text:{btnText:"删除"},callback:function(){var a=$(".dynamic-data-hook").eq(0),t=a.data("dynamicid");var e={msgid:t};i.tingApi("baidu.ting.ugcfriend.delMsgInfo",e).done(function(i){window.location.href="http://static0.qianqian.com/dynamic";n.destory(pop)})}})});$(document).on("click",function(i){$(".dynamic-pa").remove()});init()});$(function(){$(".icon-play").live("click",function(){var i=$(this);var a=i.data("id");if(ting&&a){ting.media.playSong(a,{});i.tip().tip("tipup",{msg:"已开始播放",iconClass:"tip-success"})}})});

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/