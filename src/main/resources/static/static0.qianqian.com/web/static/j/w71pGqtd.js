define(["core/utils","tmpl/dynamic/dynamicTmpl","tmpl/dynamic/dynamicTopicTmpl","widget/ucomment/ucomment","page/dynamic/dynamic_picList","page/dynamic/publish","widget/toast/toast","page/uuser/friend"],function(a,i,e,t,n,s,m,d){var c={dataUrl:"baidu.ting.ugcfriend.getList",$dynamicBox:$(".dynamic-list"),dyData:{},moudleName:"",page:"dynamic",showDomCallBack:function(){},count:false,insertTop:false,hideCount:false,noDataTip:false,getDyListParam:{size:10}},l={},o={},g=function(a){l=$.extend(c,a);var t=l.dyData;html="";for(var s in t){var m=t[s];m.hideCount=l.hideCount;if(m.msgtype==1||m.msgtype==4){m.moudleName=l.moudleName||"";html+=i({item:m});var r={};var g=[];if(m.piclist){for(var s=0;s<m.piclist.length;s++){g.push(m.piclist[s].master)}}r.picList=g;r.msgid=m.msgid+"--"+m.moudleName+"-"+m.specFlag;o[m.msgid+"--"+m.moudleName+"-"+m.specFlag]=r;var r={};var g=[];if(m.msg_parent&&m.msg_parent.piclist){for(var s=0;s<m.msg_parent.piclist.length;s++){g.push(m.msg_parent.piclist[s].master)}r.picList=g;r.msgid=m.msgid+"-"+m.msg_parent_id+"--"+m.moudleName+"-"+m.msg_parent.specFlag;o[m.msgid+"-"+m.msg_parent_id+"--"+m.moudleName+"-"+m.msg_parent.specFlag]=r}}if(m.msgtype==2){html+=e({item:m})}}if(l._reload==true){l.$dynamicBox.html("")}if(l.insertTop){l.$dynamicBox.prepend(html)}else{l.$dynamicBox.append(html)}$(".dynamic").each(function(a){var i=$(this);var e=i.find(".dynamic-text");var t=i.find(".dynamic-text-btn");if(e.height()>120){e.addClass("dynamic-text-ofh");t.show()}});l.showDomCallBack();d.bindEvent();for(var s in t){t[s].moudleName=l.moudleName||"";n.createPreview({msg:t[s],el:$(".dynamic-pics-hook-"+t[s].msgid+"-"+t[s].moudleName+"-"+t[s].specFlag)});if(t[s].msg_parent){var p={msg:t[s].msg_parent,el:$(".dynamic-pics-hook-"+t[s].msgid+"-"+t[s].msg_parent.msgid+"-"+t[s].moudleName+"-"+t[s].msg_parent.specFlag)};p.msg.msgid=t[s].msgid+"-"+t[s].msg_parent.msgid;n.createPreview(p)}}n.initPreviews(o);if(!m&&!l.noDataTip){l.noDataTip=true;$(".loading-dynamic").hide("loading-hide");l.$dynamicBox.append('<p class="no-data-text">没有更多数据了！</p>')}$(".dynamic").addClass("dynamic-show");$(".loading-dynamic").hide();f()},p=function(a){l=$.extend(c,a);var i=l.dyData;i.moudleName=a.moudleName||"";var e=[];if(i.piclist){for(var t=0;t<i.piclist.length;t++){e.push(i.piclist[t].master)}}o[i.msgid+"--"+i.moudleName+"-"+i.specFlag]={msgid:i.msgid+"--"+i.moudleName+"-"+i.specFlag,picList:e};var e=[];if(i.msg_parent&&i.msg_parent.piclist){for(var t=0;t<i.msg_parent.piclist.length;t++){e.push(i.msg_parent.piclist[t].master)}o[i.msgid+"-"+i.msg_parent_id+"--"+i.moudleName+"-"+i.msg_parent.specFlag]={msgid:i.msgid+"-"+i.msg_parent_id+"--"+i.moudleName+"-"+i.msg_parent.specFlag,picList:e}}n.createPreview({msg:i,el:$(".dynamic-pics-hook-"+i.msgid+"-"+i.moudleName+"-"+i.specFlag)});if(i.msg_parent){var s={msg:i.msg_parent,el:$(".dynamic-pics-hook-"+i.msgid+"-"+i.msg_parent.msgid+"-"+i.moudleName+"-"+i.msg_parent.specFlag)};s.msg.msgid=i.msgid+"-"+i.msg_parent.msgid;n.createPreview(s)}n.initPreviews(o);f()},u=function(a,i,e){m.show({innerSelect:".toast-tmpl",data:{cls:a,text:i},callback:e})},f=function(a){var i=360;$(".gallery-type1 .pic").load(function(){var a=$(this);if(a.height()>i){a.css({height:i+"px"})}})};addZan=function(i){if(!i){return false}var e={type:i.data("zantype"),type_id:i.closest(".dynamic").data("dynamicid"),author_id:i.data("userid")};a.tingApi("baidu.ting.ugcfav.addFav",e).done(function(a){if(a.error_code==22e3){i.removeClass("add-zan").addClass("del-zan");var e=i.find(".num-zan").html();if(isNaN(e)){e=1}else{e=Number(e)+1}i.find(".num-zan").html(e)}}).fail(function(a){var i="点赞失败";switch(Number(a.error_code)){case 22452:i="未检测登录状态";break;case 22009:i="没有权限";break;case 22009:i="没有权限";break;case 22011:i="操作太频繁，稍后重试";break}u("fail",i)})};delZan=function(i){if(!i){return false}var e={type:i.data("zantype"),type_id:i.closest(".dynamic").data("dynamicid"),author_id:i.data("userid")};a.tingApi("baidu.ting.ugcfav.delFav",e).done(function(a){if(a.error_code==22e3){i.removeClass("del-zan").addClass("add-zan");var e=Number(i.find(".num-zan").html());if(e==1){e="赞"}else{e=e-1}i.find(".num-zan").html(e)}}).fail(function(){var a="取消点赞失败";switch(Number(r.error_code)){case 22452:a="未检测登录状态";break;case 22009:a="没有权限";break;case 22009:a="没有权限";break;case 22011:a="操作太频繁，稍后重试";break}u("fail",a)})};function h(){this.index=0}$(".dynamic-list").on("click",".dynamic-text-btn",function(){var a=$(this);var i=a.closest(".dynamic").data("dynamicid");if(a.html()=="全文"){a.html("收起");$(".dynamic-text-"+i).removeClass("dynamic-text-ofh")}else{a.html("全文");$(".dynamic-text-"+i).addClass("dynamic-text-ofh")}});$(".dynamic-list").on("click",".share",function(){var a=$(this);ting.passport.checkLogin(function(){var i=a.data("share");var e=0;if(i.parentUser){e=2}else{e=1}var t={dorigin:{msg_id:i.parentMsgId||i.msgId,user:i.parentUser||i.user||{},topic_id:i.topicId||0,topic_title:i.topicTitle},dparent:{msg_id:i.msgId,msg_title:$(".dynamic-texts-"+i.msgId).text(),user:i.user||{},msg_users:i.msgUsers||[]}};s.show(e,t);var n=a.find(".icon-share-val");if(n){var m=n.html();if(isNaN(m)){m=1}else{m=Number(m)+1}n.html(m)}})});$(".dynamic-list").on("click",".dynamic-topic-name-btn",function(){if(ting&&ting.logger){ting.logger.log("click",{page:"topic_click",pos:"topic"})}});$(".add-zan").live("click",function(){var a=$(this);ting.passport.checkLogin(function(){addZan(a)})});$(".del-zan").live("click",function(){var a=$(this);ting.passport.checkLogin(function(){delZan(a)})});return{showDynamic:function(a){g(a)},eventDynamic:function(a){p(a)}}});$(function(){$(".dynamic-list").on("click",".icon-play",function(){var a=$(this);var i=a.data("id");if(ting&&i){ting.media.playSong(i,{});a.tip().tip("tipup",{msg:"已开始播放",iconClass:"tip-success"})}})});

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/