define(["core/utils","widget/toast/toast","widget/pop_window/pop_window"],function(o,i,e){var n=function(e,n){var t=$.Deferred();var l=e.data("fid")||0;o.tingApi("baidu.ting.ugcfriend.doFriend",{fid:l,type:n}).done(function(o){i.show({data:{cls:"succ",text:n==1?"关注成功":"取消关注成功"}});t.resolve(o)}).fail(function(o){if(o.error_code==22452){ting.passport.checkLogin(function(){window.location.reload()})}else{i.show({data:{cls:"fail",text:n==1?"关注失败":"取消关注失败"}})}t.reject()});return t.promise()};var t=function(){$(".friend-btn-hook").on("click",".follow-hook",function(){var o=$(this);n(o,1).done(function(i){var e=o.hasClass("noact-hook");o.removeClass();if(e){if(i.isFriend==1){o.replaceWith('<span class="followed"><i></i>已关注</span>')}else if(i.isFriend==2){o.replaceWith('<span class="allfollowed"><i></i>互相关注</span>')}}else{if(i.isFriend==1){o.addClass("followed followed-hook").html("<i></i>已关注")}else if(i.isFriend==2){o.addClass("allfollowed allfollowed-hook").html("<i></i>互相关注")}}o.attr({title:"取消关注"})})}).on("click",".followed-hook",function(){var o=$(this);n(o,2).done(function(){o.removeClass();o.addClass("follow follow-hook").html("<i></i>关注")});o.attr({title:"关注"})}).on("click",".allfollowed-hook",function(){var o=$(this);var i=e.create({baseEl:$(".music-body").eq(0),spPop:true,title:"确认取消关注？",text:{btnText:"确定"},callback:function(){n(o,2).done(function(){o.removeClass();o.addClass("follow follow-hook").html("<i></i>关注");o.attr({title:"关注"})});e.hide(i)}})}).on("click",".letter-hook",function(){var e=$(this),n=e.data("info");ting.passport.checkLogin(function(){var e=function(){window.open("/message/letter?nickname="+encodeURIComponent(n.username))};if(n.userauth==0&&n.isFriend<2){i.show({data:{cls:"fail",text:"对方设置了隐私"}});return}if(n.isFriend==0||n.isFriend==3){o.tingApi("baidu.ting.ugcfriend.doFriend",{fid:n.userid,type:1}).done(function(o){i.show({data:{cls:"succ",text:"已自动关注，可以发私信啦"},callback:function(){window.location.reload()}});e()});return}e()})})};t();return{bindEvent:function(){$(".friend-btn-hook").off("click");t()}}});

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/