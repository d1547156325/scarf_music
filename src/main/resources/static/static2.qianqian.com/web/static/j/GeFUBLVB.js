!function t(e,n,o){function i(l,s){if(!n[l]){if(!e[l]){var a="function"==typeof require&&require;if(!s&&a)return a(l,!0);if(r)return r(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var c=n[l]={exports:{}};e[l][0].call(c.exports,function(t){var n=e[l][1][t];return i(n?n:t)},c,c.exports,t,e,n,o)}return n[l].exports}for(var r="function"==typeof require&&require,l=0;l<o.length;l++)i(o[l]);return i}({1:[function(t,e,n){var o=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty,r=[].slice;t("./Event"),t("../ui/UIBase"),BME.Editor=function(e){function n(e,o){n.__super__.constructor.apply(this,arguments),console.log("new Editor"),this.id=e,this.readyState=this._READY_STATES.INIT,t("../option.default"),$.extend(this.option={},BME.default_option,o),this.util=BME.util,this.browser=BME.util.browser,this.commands={},console.log(this.browser),this.option.initialContent="<p>"+(this.browser.ie?"":"<br>")+"</p>",(this.holder=document.getElementById(e))?(this.initUI(),this.initToolbars(),this.render()):console.log("holder #"+e+" not found")}return o(n,e),n.prototype._option={fillChar:"​"},n.prototype._READY_STATES={INIT:0,EDITORUI_READY:1,SETUP_READY:2},n.prototype.setup=function(e){return t("./Selection"),this.document=e,this.window=e.defaultView||e.parentWindow,this.body=e.body,BME.util.browser.ie9below&&this.window!==this.window.parent&&dom.util.ie8hack(window),this.body.contentEditable=!0,this.body.spellcheck=!1,this.selection=new dom.Selection(e),this.browser.gecko&&this.selection.getNative().removeAllRanges(),this.body.innerHTML=this.option.content||this.option.initialContent,this.initEvents(),this.readyState=this._READY_STATES.SETUP_READY,this.trigger("ready:setup")},n.prototype.render=function(){var t,e,n,o,i,r,l,s,a,d,c,u,h,f,p;for(c=this,e=this.ui.renderHTML(),$(this.holder).addClass("editor "+(this.option.theme?"editor-"+this.option.theme:"")).html(e),this.readyState=this._READY_STATES.EDITORUI_READY,this.trigger("ready:editorui"),d=[],p=[],u=this.option.links,n=0,l=u.length;n<l;n++)a=u[n],d.push('<link rel="stylesheet" type="text/css" href="'+a+'">');for(h=this.option.scripts,r=0,s=h.length;r<s;r++)f=h[r],p.push('<script type="text/javascript" src="'+f+'"></script>');return i=(this.browser.ie9below?"":"<!DOCTYPE html>")+'\n<html xmlns="http://www.w3.org/1999/xhtml">\n<head>\n    <title>music editor content</title>\n    '+d.join("\n")+"\n    <style>\n        html{overflow: hidden;}\n        body{margin: 0;padding: 0;padding-bottom: 50px;box-sizing: border-box;}\n        div.uneditable{display: inline-block;width: 99%;}\n    </style>\n    "+p.join("\n")+'\n</head>\n<body style="word-wrap: break-word;" draggable="false" spellcheck="false">\n\n</body>\n<script type="text/javascript">\n    setTimeout(function(){window.editor = window.parent.editor;editor.setup(document);});\n</script>\n</html>',o=document.createElement("iframe"),o.src="javascript:void(function(){document.open();"+(document.domain===location.hostname?"":'document.domain="'+document.domain+'";')+"document.write('"+i+"');document.close();}())",o.style.cssText="width: 100%;height: 100%;",o.frameBorder=0,this.iframe=o,t=$("#"+this.id+" .iframe-holder"),t.append(o),this.on("ready:setup",function(e){return function(){var n,o,i,r,l;if(n=$("#"+e.id+" .content")[0],r=parseFloat(t.css("padding-top"))+parseFloat(t.css("padding-bottom")),o=n.offsetHeight-r,i=!0)return l=setInterval(function(){var t,e,i,l,s,a;if(s=c.body.offsetHeight,a=c.body.scrollHeight,(i=c.body.firstChild)&&(l=parseFloat($(i).css("margin-top")),a-=l),t=c.body.style.height?Math.max(s,a):s,e=n.offsetHeight-r,t<=o){if(c.body.style.height||(c.body.style.height=o+"px"),n.style.height)return n.style.height=""}else if(c.body.style.height&&(c.body.style.height=""),e!==t)return n.style.height=t+r+"px"},100)}}(this))},n.prototype.initUI=function(){return t("../ui/editorUI"),this.ui=new BME.ui.Editor(this)},n.prototype.initToolbars=function(){var e,n,o,i,r,l,s;for(t("../toolbar/toolbar.default"),(o=BME.tool.commands)&&this.registerCommand(o),n=(this.option.toolbars||[]).concat(this.option.toolbars_extra),this.toolbars=[],l=[],i=0,r=n.length;i<r;i++)e=n[i],s=new BME.tool.Toolbar($.extend(e,{owner_editor:this})),l.push(this.toolbars.push(s));return l},n.prototype.initEvents=function(){var t,e,n,o;return o=this,n=this.body,t=function(t){return dom.util.isBlock(t)&&"false"===t.contentEditable},e=function(e){var n;return n=new RegExp("^"+o._option.fillChar),n.test(e.nodeValue)&&t(e.previousSibling)},$(this.document).on("keydown",function(t){var n,i,r,l,s,a;switch(s=o.selection.getRange(),t.keyCode){case 13:if(o.browser.ie){if(s.collapsed&&e(s.startContainer,o._option.fillChar))return n=s.startContainer,r=$(o.option.initialContent)[0],dom.util.insertAfter(n,r),s.setStart(r,0),s.setEnd(r,0),s.select(),o.selection.clear(),!1}else setTimeout(function(t){return function(){return o.document.execCommand("formatblock",!1,"<p>")}}(this));break;case 8:if(s.collapsed){if(n=s.startContainer,e(n,o._option.fillChar))return l=n.previousSibling,r=document.createElement("p"),i=document.createTextNode(""),r.appendChild(i),dom.util.removeNode(n),dom.util.replaceElement(l,r),s.selectNodeText(r),s.collapse(!1),s.select(),o.selection.clear(),!1;if(r=dom.util.getInlineBlock(n),l=r.previousSibling,0===s.startOffset&&!dom.util.isEmptyNode(r)&&e(l,o._option.fillChar))return a=l.previousSibling,dom.util.removeNode(l),dom.util.removeNode(a),!1}}return o.selection.clear()}),$(this.document).on("mouseup keydown",function(t){return o.selectionChange(null,t)}).on("keyup",function(t){var i,r,l,s,a;switch(l=o.selection.getRange(),t.keyCode){case 8:l.collapsed&&(0!==n.childNodes.length&&dom.util.isBlock(n.firstChild)?(r=dom.util.getInlineBlock(l.startContainer),r&&dom.util.isEmptyNode(r)&&(s=$(o.option.initialContent)[0],dom.util.replaceElement(r,s))):(n.innerHTML=o.option.initialContent,s=n.firstChild),s&&(l.setStart(s,0),l.setEnd(s,0),l.select()))}if(l.collapsed&&(i=l.startContainer,e(i,o._option.fillChar)&&i.nodeValue.length>1))return r=document.createElement("p"),a=i.nodeValue.substr(1),i.nodeValue=o._option.fillChar,r.appendChild(document.createTextNode(a)),dom.util.insertAfter(i,r),l.selectNodeText(r),l.collapse(!1),l.select()}),this.on("selectionchange",function(t){return console.log(t),console.log(t.queryInlineStyle()),console.log(t.queryBlockStyle())})},n.prototype.bindGlobal=function(t){return this.readyState<this._READY_STATES.SETUP_READY?this.on("ready:setup",function(e){return function(){return e.bindGlobal(t)}}(this)):(t(this.window),this.window.parent!==this.window?t(this.window.parent):void 0)},n.prototype.selectionChange=function(){var t;return t=null,function(e,n){var o;return null==e&&(e=100),o=this,o.selection.clear(),clearTimeout(t),t=setTimeout(function(){var t,e,n,i,r,l;switch(s.type){case"mouseup":if(o.browser.ie&&(n=o.selection.getNative(),"None"===n.type||null===n.focusNode)){i=s.clientX,r=s.clientY,e=o.document.body.createTextRange();try{e.moveToPoint(i,r)}catch(s){t=s,console.log(t),e=null}o.selection.cacheIeRange(e)}}return l=o.selection.getRange(),o.trigger("selectionchange",l)},e)}}(),n.prototype.contentChange=function(){},n.prototype.registerCommand=function(t){var e,n,o,i;e=void 0,arguments.length>1&&(n=t,t={},t[n]=arguments[1]);for(i in t)o=t[i],this.commands[i]?(console.log("command ["+i+"] has been registered"),(null!=e?e:e=[]).push(i)):this.commands[i]=o;return e},n.prototype.execCommand=function(){var t,e,n,o,i;if(t=arguments[0],n=2<=arguments.length?r.call(arguments,1):[],!(e=this.commands[t]))throw new Error("command "+t+" not found");if(o=null!=(i=this.selection)?i.getRange():void 0,o.startContainer&&o.endContainer)return n.unshift(o),e.apply(this,n)},n.prototype.getContent=function(){var t;return t=this.body.innerHTML},n.prototype.focus=function(){return dom.util.focus(this.document)},n}(BME.Event)},{"../option.default":8,"../toolbar/toolbar.default":17,"../ui/UIBase":18,"../ui/editorUI":19,"./Event":2,"./Selection":4}],2:[function(t,e,n){var o=[].slice;BME.Event=function(){function t(){this._events={}}return t.prototype.on=function(t,e){var n;return null==(n=this._events)[t]&&(n[t]=[]),this._events[t].push(e)},t.prototype.once=function(t,e){var n;return null==(n=this._events)[t]&&(n[t]=[]),e._trigger_once=!0,this._events[t].push(e)},t.prototype.off=function(t,e){var n,o,i,r,l,s;if(this._events[t]){if(e){for(l=this._events[t],s=[],o=i=0,r=l.length;i<r;o=++i)n=l[o],n===e?s.push(this._events[t].splice(o,1)):s.push(void 0);return s}return this._events[t]=[]}},t.prototype.trigger=function(){var t,e,n,i,r,l;for(i=arguments[0],e=2<=arguments.length?o.call(arguments,1):[],t=this._events[i]||[],r=-1,l=[];++r<t.length;)n=t[r],n.apply(this,e),n._trigger_once?(t.splice(r,1),l.push(r--)):l.push(void 0);return l},t}()},{}],3:[function(t,e,n){var o,i,r,l,s,a,d,c,u,h,f,p,m,g,y;a=function(t,e,n,o,i){var r,l,s,a,d,c,u,h,f,p,g;for(l=document.createDocumentFragment(),p=m.util.getIndexPath(t,n),f=n,s=l,3===f.nodeType?(l.appendChild(document.createTextNode("")),s=l.childNodes[0]):i&&(h=document.createElement(f.tagName),m.util.copyStyle(f,h),l.appendChild(h),s=l.childNodes[0]),r=c=0,u=p.length;c<u;r=++c){for(d=p[r],a=0,g=o?d:f.childNodes.length-d-1;a++<g;)s.appendChild(f.childNodes[o?0:d+1]);switch(f=f.childNodes[o?0:d],f.nodeType){case 1:h=document.createElement(f.tagName),m.util.copyStyle(f,h);break;case 3:h=document.createTextNode("")}o?s.appendChild(h):m.util.appendInTop(h,s),s=h}switch(f.nodeType){case 1:if(a=0,o)for(;a++<e;)s.appendChild(f.childNodes[0]);else for(;a++<f.childNodes.length-d;)s.appendChild(f.childNodes[e]);break;case 3:o?(s.nodeValue=f.nodeValue.substr(0,e),f.nodeValue=f.nodeValue.substr(e)):(s.nodeValue=f.nodeValue.substr(e),f.nodeValue=f.nodeValue.substr(0,e))}return l},s=function(t,e,n,o,i){var r,l,s,d,c,u,h,f,p,g,y,v,C,b,N,E;if(t&&n)if(c=document.createDocumentFragment(),t!==n)if(m.util.contains(t,n)){for(d=m.util.getImmediateChild(n,t),c=a(n,o,d,!0,!1),u=m.util.getIndex(d,!0);--u>=e;)m.util.appendInTop(t.childNodes[u],c);r=t,g=e-1}else if(m.util.contains(n,t)){for(d=m.util.getImmediateChild(t,n),c=a(t,e,d,!1,!1),h=m.util.getIndex(d,!0),u=h;++u<o;)c.appendChild(n.childNodes[h+1]);r=n,g=h}else{for(r=m.util.getCommonAncestor(t,n,i),v=m.util.getIndexPath(t,r),y=m.util.getIndexPath(n,r),b=r.childNodes[v[0]],l=r.childNodes[y[0]],N=a(t,e,b,!1,!0),s=a(n,o,l,!0,!0),c.appendChild(N),u=v[0]+1;u++<y[0];)c.appendChild(r.childNodes[v[0]+1]);c.appendChild(s),g=v[0],C=r.childNodes[g],3===C.nodeType&&""===C.nodeValue&&(m.util.removeNode(C),g--)}else switch(t.nodeType){case 1:for(r=t.parentNode,u=e;u++<o;)c.appendChild(r[e]);g=e-1;break;case 3:r=t.parentNode,E=t.nodeValue,f=document.createTextNode(E.substring(e,o)),c.appendChild(f),p=document.createTextNode(E.substr(0,e)),t.nodeValue=E.substr(o),""!==p.nodeValue?(r.insertBefore(p,t),g=m.util.getIndex(p,r)):g=m.util.getIndex(t,r)-1,""===t.nodeValue&&m.util.removeNode(t)}else t?(r=m.util.getInlineBlock(t),c=a(t,e,r,!1),v=m.util.getIndexPath(t,r),g=g=v[0]):n&&(r=m.util.getInlineBlock(n),c=a(t,e,r,!1),g=0);return{fragment:c,ancestor:r,offset:g}},d=function(t,e,n,o,i,r){var l,d,c,u,h,f,p,g,y,v,C;for(null==r&&(r=!0),v=s(t,e,n,o,!0),u=v.fragment,d=v.ancestor,h=v.offset,f=d,c=u,C=r?i.parentNode:i;f!==C;)if(l=m.util.cloneStyleNode(f),l.appendChild(c),11===c.nodeType&&(y=l),c=l,u=document.createDocumentFragment(),u.appendChild(l),!(f=f.parentNode))throw new Error("args error(_extractFragmentWithAncestor)");return p=a(d,h+1,i,!0,!0),m.util.isEmptyNode(p)?h=m.util.getIndex(i,!0)-1:(h=m.util.getIndex(i,!0),g=p.firstChild.lastChild,m.util.isEmptyNode(g)&&m.util.removeNode(g),i.parentNode.insertBefore(p,i)),m.util.isEmptyNode(i)?m.util.removeNode(i):m.util.isEmptyNode(i.firstChild)&&m.util.removeNode(i.firstChild),{fragment:u,offset:h,raw_node:y}},r=function(t){var e,n,o,i,r,l,s;for(n=m.util.getAllChilds(t,!0),o=0,r=n.length;o<r;o++)e=n[o],3===e.nodeType&&""===e.nodeValue&&m.util.removeNode(e);for(s=[],i=0,l=n.length;i<l;i++)e=n[i],1===e.nodeType&&0===e.childNodes.length?s.push(m.util.removeNode(e)):s.push(void 0);return s},f=function(t){var e,n,o,i,r,l,s,a,d;n=m.util.getAllChilds(t),s=m.util.getStyle(t),o={};for(r in s)d=s[r],o[r]="*";for(a=[],i=0,l=n.length;i<l;i++)e=n[i],a.push(m.util.removeStyle(e,o));return a},h=function(t){var e,n,o,i,r,l,s,a,d,c,u,h,f,p,g;if((p=t.childNodes).length){for(c=[],i=0,g=p[0];i++<p.length-1;)e=p[i],m.util.isEqualStyle(g,e)?(null!=(u=d=c[c.length])?u.indexOf(g):void 0)>-1?d.push(e):c.push([g,e]):g=e;for(r=0,s=c.length;r<s;r++)n=c[r],m.util.mergeNodes.apply(null,n);for(h=m.util.getChildren(t),f=[],l=0,a=h.length;l<a;l++)o=h[l],f.push(arguments.callee(o));return f}},u=function(t){return f(t),h(t)},l=function(t,e){var n,o,i,r,l;if("*"===e)return l=m.util.getFullText(t),m.util.removeAllChilds(t),t.appendChild(l);for(o=m.util.getAllChilds(t),i=0,r=o.length;i<r;i++)n=o[i],m.util.removeStyle(n,e);return h(t)},p=function(t,e,n,o){var i,r,l,s,a,d;for(d={},null==e&&(e=m.util.getInlineBlock(t));t&&t!==e;){for(a=t.parentNode,d=m.util.extend(m.util.clone(d),m.util.getStyle(t),!1),n?(l=-1,s=m.util.getIndex(t,!0)):(l=m.util.getIndex(t,!0),s=a.childNodes.length);++l<s;)r=a.childNodes[l],m.util.isEmptyNode(r)||(i=m.util.getNodeStyle(r),d=m.util.union(d,i));t=a}if(!t)throw new Error("node is not child of ancestor(_queryInlineStyleInAncestor)");return o&&m.util.extend(d,m.util.getStyle(e),!1),d},o=function(t,e,n){var o;return e>-1&&(o=t.childNodes[e])?m.util.insertAfter(o,n):m.util.appendInTop(n,t)},y=function(t){return t.startContainer===t.endContainer&&t.startOffset===t.endOffset?t.collapsed=!0:t.collapsed=!1},g=function(t,e,n,o){return t?(o.startContainer=e,o.startOffset=n,o.endContainer||o.collapse(!0)):(o.endContainer=e,o.endOffset=n,o.startContainer||o.collapse(!1)),y(o)},m=window.dom,c="undefined"!=typeof editor&&null!==editor?editor._option.fillChar:void 0,i=BME.util.browser,m.Range=function(){function t(t){this.document=t||document,this.startContainer=null,this.startOffset=null,this.endContainer=null,this.endOffset=null,this.collapsed=!0,this._cache={}}return t.prototype.setStart=function(t,e){return g(!0,t,e,this),this.clearCache()},t.prototype.setEnd=function(t,e){return g(!1,t,e,this),this.clearCache()},t.prototype.collapse=function(t){return t?this.setEnd(this.startContainer,this.startOffset):this.setStart(this.endContainer,this.endOffset)},t.prototype.selectNode=function(t){},t.prototype.selectNodeContents=function(t){},t.prototype.selectNodeText=function(t){var e,n;if(n=m.util.getEndTextNode(t,!0),e=m.util.getEndTextNode(t,!1),n&&e)return this.clearCache(),this.setStart(n,0),this.setEnd(e,e.nodeValue.length);throw new Error("node content no text (selectNodeText)")},t.prototype.extractContents=function(){var t,e,n,o,i;if(!this.collapsed)return this.clearCache(),i=s(this.startContainer,this.startOffset,this.endContainer,this.endOffset),e=i.fragment,t=i.ancestor,n=i.offset,n>-1&&(o=t.childNodes[n])?(this.setStart(t,n),this.setEnd(t,n)):(this.setStart(t,0),this.setEnd(t,0)),e},t.prototype.extractText=function(){var t,e;return t=this.extractContents(),e=m.util.getFullText(t)},t.prototype.getStartNode=function(){var t;return t=3===this.startContainer.nodeType?this.startContainer:this.startContainer.childNodes[this.startOffset]||this.startContainer},t.prototype.getEndNode=function(){var t,e;return t=3===this.endContainer.nodeType?this.endContainer:(null!=(e=this.endContainer.childNodes[this.endOffset])?e.previousSibling:void 0)||this.endContainer},t.prototype.queryInlineStyle=function(){var t,e,n,o,i,r,l,s,a,d,c,u,h,f;if(this._cache.inline_style)return this._cache.inline_style;if(f={},this.startContainer&&this.endContainer){if(this.isCrossLine())for(o=this.getInlineBlocks(),h=this.getStartNode(),s=this.getEndNode(),f=p(h,o[0],!1,!1),m.util.isEmptyObject(f)||(n=p(s,o[o.length-1],!0,!1),f=m.util.union(f,n)),a=0;!m.util.isEmptyObject(f)&&++a<o.length-1;)d=o[a],t=m.util.getNodeStyle(d,!0),f=m.util.union(f,t);else{if(i=m.util.getCommonAncestor(this.startContainer,this.endContainer),"body"===(null!=i?i.tagName.toLowerCase():void 0))return;if(u=m.util.getImmediateChild(this.startContainer,i),l=m.util.getImmediateChild(this.endContainer,i),1===(null!=u?u.nodeType:void 0)&&1===(null!=l?l.nodeType:void 0)&&(h=this.getStartNode(),s=this.getEndNode(),f=p(h,u,!1,!0),m.util.isEmptyObject(f)||(n=p(s,l,!0,!0),f=m.util.union(f,n)),u!==l))for(c=u;(c=c.nextSibling)!==l&&!m.util.isEmptyObject(f);){if(!c)throw new Error("queryInlineStyle error");e=m.util.getNodeStyle(c),f=m.util.union(f,e)}r=m.util.getInlineStyle(i),$.extend(f,r)}return this._cache.inline_style=f}},t.prototype.applyInlineStyle=function(t,e){var n,i,r,l,d,h,f,p,g,y,v,C,b,N,E,T,w;if(null==t&&(t="span"),null==e&&(e={}),y=this.document.createElement(t),!m.util.isEmptyObject(e)){l="";for(p in e)w=e[p],l+=p+": "+w+";"}if(l&&(y.style.cssText=l),this.collapsed)c&&(y.innerHTML=c),b=s(this.startContainer,this.startOffset,this.endContainer,this.endOffset,!0),d=b.fragment,i=b.ancestor,v=b.offset,"body"===(null!=(N=i.tagName)?N.toLowerCase():void 0)?(m.util.removeAllChild(this.startContainer),this.startContainer.appendChild(y)):o(i,v,y),this.selectNodeText(y),this.collapse(!1);else if(this.isCrossLine())for(r=this.getInlineBlocks(),h=f=0,g=r.length;f<g;h=++f)switch(C=r[h],n=y.cloneNode(),h){case 0:d=a(this.startContainer,this.startOffset,C,!1),n.appendChild(d),u(n),C.appendChild(n),T=m.util.getEndTextNode(n,!0),this.setStart(T,0);break;case r.length-1:d=a(this.endContainer,this.endOffset,C,!0),n.appendChild(d),u(n),m.util.appendInTop(n,C),T=m.util.getEndTextNode(n,!1),this.setEnd(T,T.nodeValue.length);break;default:d=m.util.extractChildNodes(C),n.appendChild(d),u(n),C.appendChild(n)}else E=s(this.startContainer,this.startOffset,this.endContainer,this.endOffset,!0),d=E.fragment,i=E.ancestor,v=E.offset,y.appendChild(d),o(i,v,y),u(y),this.selectNodeText(y);return this.clearCache(),this.select()},t.prototype.clearInlineStyle=function(t,e){var n,i,r,u,h,f,p,g,y,v,C,b,N,E,T,w,x,S,_,O,I;if(null==e&&(e={}),n=m.util.formatStyle(t,e),this.isCrossLine())for(r=this.getInlineBlocks(),g=y=0,v=r.length;y<v;g=++y)switch(b=r[g],g){case 0:S=a(this.startContainer,this.startOffset,b,!1),l(S,n),O=m.util.getEndTextNode(S,!0),b.appendChild(S),this.setStart(O,0);break;case r.length-1:h=a(this.endContainer,this.endOffset,b,!0),O=m.util.getEndTextNode(h,!1),l(h,n),m.util.appendInTop(h,b),this.setEnd(O,O.nodeValue.length);break;default:l(b,n)}else"*"===n?(b=this.getInlineBlocks()[0],T=d(this.startContainer,this.startOffset,this.endContainer,this.endOffset,b,!1),f=T.fragment,C=T.offset,E=T.raw_node,p=m.util.getFullText(f),I=document.createTextNode(p),o(b,C,I)):(_=m.util.getClosestStyleNode(m.util.getCommonAncestor(this.startContainer,this.endContainer),n),_?(N=_.parentNode,w=d(this.startContainer,this.startOffset,this.endContainer,this.endOffset,_),f=w.fragment,C=w.offset,E=w.raw_node,(u=this.collapsed)&&(E.childNodes[0].nodeValue=c),m.util.removeStyle(f.firstChild,n),this.selectNodeText(f),u&&this.collapse(!1),o(N,C,f)):(x=s(this.startContainer,this.startOffset,this.endContainer,this.endOffset,!0),f=x.fragment,i=x.ancestor,C=x.offset,l(f,n),this.selectNodeText(f),o(i,C,f)));return this.clearCache(),this.select()},t.prototype.extractFragmentWithAncestor=function(){var t;return t=m.util.getInlineBlock(this.startContainer),d(this.startContainer,this.startOffset,this.endContainer,this.endOffset,t)},t.prototype.insertNode=function(t){var e,n,r,l,a,u,h,f,p,g;if(r=!("false"===t.contentEditable),m.util.isBlock(t)&&(this.isCrossLine()?(p=s(startContainer,startOffset,endContainer,endOffset),a=p.fragment,e=p.ancestor,u=p.offset,o(e,u,t)):((h=this.getInlineBlocks()[0])||(h=document.createElement("p"),m.util.insertAfter(this.startContainer,h),this.setStart(h,0),this.setEnd(h,0)),n=h.parentNode,m.util.isEmptyNode(h)?m.util.replaceElement(h,t):(g=d(this.startContainer,this.startOffset,this.endContainer,this.endOffset,h),a=g.fragment,u=g.offset,f=g.raw_node,o(n,u,t))),!r)){if(l=document.createTextNode(c),m.util.insertAfter(t,l),i.ie9below)return this.clearCache();this.selectNodeText(l)}return this.collapse(!1),this.select()},t.prototype.queryBlockStyle=function(){var t,e,n,o,i;if(this._cache.block_style)return this._cache.block_style;if(i={},e=this.getInlineBlocks(),e.length>0)for(i=m.util.getStyle(e[0]),n=0;++n<e.length;)o=e[n],t=m.util.getStyle(o),i=m.util.union(i,t);return this._cache.block_style=i},t.prototype.applyBlockStyle=function(t,e){var n,o,i,r,l;for(n=this.getInlineBlocks(),o=0,i=n.length;o<i;o++)l=n[o],t&&l.tagName.toLowerCase()!==t?(r=document.createElement(t),m.util.applyStyle(r,e),r.appendChild(m.util.extractChildNodes(l)),m.util.replaceElement(l,r),this.startContainer===l&&this.setStart(r,this.startOffset),this.endContainer===l&&this.setEnd(r,this.endOffset)):m.util.applyStyle(l,e);return this.clearCache(),this.select()},t.prototype.clearBlockStyle=function(t,e){},t.prototype.getInlineBlocks=function(){var t,e,n;if(t=[],n=m.util.getInlineBlock(this.startContainer)){for(t.push(n),e=m.util.getInlineBlock(this.endContainer);n!==e&&(n=null!=n?n.nextSibling:void 0);)m.util.isInlineBlock(n)&&t.push(n);if(!n)throw new Error("range error(Range:getInlineBlocks)")}return t},t.prototype.isCrossLine=function(){var t;if(this.startContainer!==this.endContainer&&(t=m.util.getCommonAncestor(this.startContainer,this.endContainer),t.tagName&&"body"===t.tagName.toLowerCase()))return!0},t.prototype.select=i.ie9below?function(){var t,e,n,o,i,r,l,s,a;return a=this.document.body.createTextRange(),t=m.util.getCommonAncestor(this.startContainer,this.endContainer),1===this.startContainer.nodeType?((s=this.startContainer.childNodes[this.startOffset])?1===s.nodeType?(a.moveToElementText(s),l=m.util.getTextIndex(s,t)):(a.moveToElementText(this.startContainer),i=m.util.getTextIndex(s),a.moveStart("character",i)):(a.moveToElementText(this.startContainer),l=m.util.getTextIndex(this.startContainer,t)),a.collapse(!0)):(a.moveToElementText(this.startContainer.parentNode),i=m.util.getTextIndex(this.startContainer,this.startContainer.parentNode)+this.startOffset,a.moveStart("character",i),a.collapse(!0),l=m.util.getTextIndex(this.startContainer,t)+this.startOffset),e=1===this.endContainer.nodeType&&(n=this.endContainer.childNodes[this.endOffset])?m.util.getTextIndex(n,t):m.util.getTextIndex(this.endContainer,t)+this.endOffset,o=e-l,"body"===(null!=(r=t.tagName)?r.toLowerCase():void 0)&&(o+=this.getInlineBlocks().length-1),a.moveEnd("character",o),a.select()}:function(){var t,e,n;return n=m.util.getWindow(this.document),e=n.getSelection(),e.removeAllRanges(),t=this.document.createRange(),t.setStart(this.startContainer,this.startOffset),t.setEnd(this.endContainer,this.endOffset),e.addRange(t),m.util.focus(this.document)},t.prototype.clearCache=function(){return this._cache={}},t}()},{}],4:[function(t,e,n){var o,i;t("./Range"),o=function(t,e){var n,o,i,r,l,s,a,d,c,u,h,f,p,m,g,y,v,C,b,N,E;if(t=t.duplicate(),t.collapse(e),g=t.parentElement(),N=t.duplicate(),!g.hasChildNodes())return{container:g,offset:0};for(o=null;!o;)if(1===g.nodeType)if(g.children.length)for(y=g.children,a=s=0,f=y.length;s<f;a=++s){switch(i=y[a],N.moveToElementText(i),n=!0,N.compareEndPoints("StartToStart",t)){case-1:a===g.children.length-1?(g=i.nextSibling,n=!0):n=!1;break;case 1:a>0&&(u=g.children[a-1])?(N.moveToElementText(u),N.collapse(!1),r=N.compareEndPoints("StartToStart",t),g=r<=0?i.previousSibling:u):g=i.previousSibling;break;case 0:o={container:i,offset:0},n=!0}if(n)break}else g=g.childNodes[0];else{for(E=[g],b=g;3===(null!=(v=b=b.previousSibling)?v.nodeType:void 0);)E.unshift(b);for(b=g;3===(null!=(C=b=b.nextSibling)?C.nodeType:void 0);)E.push(b);for((h=E[0].previousSibling)?(N.moveToElementText(h),N.collapse(!1)):(N.moveToElementText(g.parentNode),N.collapse(!0)),N.setEndPoint("EndToStart",t),l=N.text.length,c=0,p=E.length;c<p;c++)if(d=E[c],m=l,(l-=d.nodeValue.length)<0){g=d;break}o={container:g,offset:m}}return o},i=function(t,e){var n,i;return i=o(t,!0),n=o(t,!1),e.setStart(i.container,i.offset),e.setEnd(n.container,n.offset)},dom.Selection=function(){function t(t){this.document=t||document,this.browser=BME.util.browser}return t.prototype.getRange=function(){var t,e,n,o;if(this.cache_range)return this.cache_range;if(o=new dom.Range(this.document),this.browser.ie9below)try{e=this.getIeRange(),i(e,o)}catch(e){t=e,console.log(t),o=null}else try{n=this.getNative().getRangeAt(0),o.setStart(n.startContainer,n.startOffset),o.setEnd(n.endContainer,n.endOffset)}catch(t){(e=this.cache_ieRange)&&i(e,o)}return this.cache_range=this.back_range=o},t.prototype.getNative=function(){var t;return t=this.browser.ie9below?this.document.selection:dom.util.getWindow(this.document).getSelection()},t.prototype.getIeRange=function(){return this.cache_ieRange||this.getNative().createRange()},t.prototype.cacheRange=function(t){if(t)return this.cache_range=t},t.prototype.cacheIeRange=function(t){if(t)return this.cache_ieRange=t},t.prototype.clear=function(){return this.cache_range=null,this.cache_ieRange=null},t}()},{"./Range":3}],5:[function(t,e,n){var o=[].slice;dom.util={extend:function(t,e,n){var o,i;null==n&&(n=!0);for(o in e)i=e[o],!n&&t.hasOwnProperty(o)||(t[o]=i);return t},union:function(t,e){var n,o,i;o={};for(n in t)i=t[n],e.hasOwnProperty(n)&&e[n]===i&&(o[n]=i);return o},clone:function(t){var e,n,o;e={};for(n in t)o=t[n],"object"==typeof o?e[n]=arguments.callee(o):e[n]=o;return e},include:function(t,e){var n,o;if("object"==typeof t){for(n in e)if(o=e[n],t[n]!==o)return!1;return!0}},isEqualObject:function(t,e){var n,o;for(n in t)if(o=t[n],e[n]!==o)return!1;for(n in e)if(o=e[n],t[n]!==o)return!1;return!0},isEmptyObject:function(t){var e,n;for(e in t)if(n=t[e],t.hasOwnProperty(e))return!1;return!0},getValue:function(t,e){var n,o,i,r,l;for(i=e.split("."),l=t,n=0,r=i.length;n<r;n++)if(o=i[n],!(l=l[o]))return;return l},ie8hack:function(t){if(t.Array.prototype.indexOf||(t.Array.prototype.indexOf=function(t){var e,n,o,i,r;for(r=this,n=o=0,i=r.length;o<i;n=++o)if(e=r[n],e===t)return n;return-1}),!t.Array.prototype.some)return t.Array.prototype.some=function(t){var e,n,o,i,r;for(r=this,n=o=0,i=r.length;o<i;n=++o)if(e=r[n],t(e))return!0}},focus:function(t){return t.body.focus()},getIndex:function(t,e){var n,o,i,r,l,s;for(l=t.parentNode,s=e?l.childNodes:l.children,n=i=0,r=s.length;i<r;n=++i)if(o=s[n],o===t)return n},getIndexPath:function(t,e){var n;for(n=[];t!==e;){if(9===t.nodeType)throw console.log(t),console.log(e),console.log(arguments.callee.caller),new Error("error:ele is not a child of root");n.unshift(dom.util.getIndex(t,!0)),t=t.parentNode}return n},getDocument:function(t){return t.ownerDocument},getWindow:function(t){return t.defaultView||t.parentWindow},getChildren:function(t){var e,n,o,i,r;if(BME.util.browser.ie&&11===t.nodeType)for(n=[],r=t.childNodes,o=0,i=r.length;o<i;o++)e=r[o],1===e.nodeType&&n.push(e);else n=t.children;return n},getInlineBlock:function(t){return $(t).closest(dom.util.inlineBlockTag.join(","))[0]},getCommonAncestor:function(t,e,n){var o,i,r,l,s,a,d,c,u,h;if(n){if(u=dom.util.getInlineBlock(t),o=dom.util.getInlineBlock(e),u!==o)throw new Error("elements not in the same line")}else u=dom.util.getDocument(t).body;for(c=dom.util.getIndexPath(t,u),d=dom.util.getIndexPath(e,u),s=Math.min(c.length,d.length),h=[],r=-1;++r<s&&c[r]===d[r];)h.push(c[r]);for(i=u,l=0,a=h.length;l<a;l++)r=h[l],i=i.childNodes[r];return 3===i.nodeType&&(i=i.parentNode),i},getAllChilds:function(t,e,n){var o,i,r,l;for(null==n&&(n=[]),l=e?t.childNodes:dom.util.getChildren(t),i=0,r=l.length;i<r;i++)o=l[i],n.push(o),1===o.nodeType&&arguments.callee.call(null,o,e,n);return n},contains:function(t,e){var n;for(n=e;n=n.parentNode;)if(n===t)return!0;return!1},removeNode:function(t){return t.parentNode.removeChild(t)},removeParent:function(t){var e;return e=dom.util.extractChildNodes(t),dom.util.replaceElement(t,e)},removeAllChild:function(t){var e,n,o;for(e=0,n=t.childNodes.length,o=[];e++<n;)o.push(t.removeChild(t.childNodes[0]));return o},appendInTop:function(t,e){var n;return(n=e.childNodes[0])?e.insertBefore(t,n):e.appendChild(t)},insertAfter:function(t,e){var n,o;return o=t.parentNode,(n=t.nextSibling)?o.insertBefore(e,n):o.appendChild(e)},extractChildNodes:function(t){var e,n,o;for(e=document.createDocumentFragment(),n=0,o=t.childNodes.length;n++<o;)e.appendChild(t.childNodes[0]);return e},replaceElement:function(t,e){var n,o;return o=t.parentNode,n=t.nextSibling,o.removeChild(t),n?o.insertBefore(e,n):o.appendChild(e)},transformElement:function(t,e){var n,o,i;for(i=document.createElement(e),i.style.cssText=t.style.cssText,o=t.childNodes.length,n=0;n++<o;)i.appendChild(t.childNodes[0]);return dom.util.replaceElement(t,i)},mergeNode:function(t,e,n){var o,i;return 1===e.nodeType&&(o=dom.util.extractChildNodes(e),dom.util.removeNode(e)),1===t.nodeType?n?dom.util.appendInTop(o,t):t.appendChild(o):(i=e.nodeValue,dom.util.removeNode(e),n?t.nodeValue=i+t.nodeValue:t.nodeValue+=i)},mergeNodes:function(){var t,e,n,i;if(n=1<=arguments.length?o.call(arguments,0):[],!(n.length<2)){for(t=0,e=n[0],i=[];++t<n.length;)i.push(dom.util.mergeNode(e,n[t]));return i}},baseTag:["span","p"],styleTag:["b","strong","em","i","h1","h2","h3","h4","h5","h6","ol"],inlineBlockTag:["p","h1","h2","h3","h4","h5","h6"],blockTag:["p","div","h1","h2","h3","h4","h5","h6"],formatStyle:function(t,e){var n;return"*"===e?"*":(n=dom.util.extend({},e),t&&dom.util.styleTag.indexOf(t)>-1&&(n[t]=!0),n)},getTagnameFromStyle:function(t){var e,n;for(e in t)if(n=t[e],n===!0)return e},isBlock:function(t){var e;if("string"==typeof t?e=t.toLowerCase():t&&t.tagName&&(e=t.tagName.toLowerCase()),dom.util.blockTag.indexOf(e)>-1)return!0},isInlineBlock:function(t){if(t.tagName&&dom.util.inlineBlockTag.indexOf(t.tagName.toLowerCase())>-1)return!0},isStyleNode:function(t){var e,n;return n=dom.util.baseTag.concat(dom.util.styleTag),n.indexOf(null!=(e=t.tagName)?e.toLowerCase():void 0)>-1},getStyle:function(t){var e,n,o,i,r,l,s,a,d,c;if(s={},1!==t.nodeType)return s;for(a=(null!=(l=t.style.cssText)?l.split(";"):void 0)||[],n=0,i=a.length;n<i;n++)e=a[n],r=e.split(":"),o=$.trim(r[0]).toLowerCase(),c=$.trim(r[1]),o&&c&&(s[o]=c);return d=t.tagName.toLowerCase(),dom.util.styleTag.indexOf(d)>-1&&(s[d]=!0),s},getInlineStyle:function(t,e){var n,o,i;for(i={};e&&t!==e||!e&&!dom.util.isBlock(t)&&"body"!==(null!=(o=t.tagName)?o.toLowerCase():void 0);)if(n=dom.util.getStyle(t),dom.util.extend(i,n,!1),!(t=t.parentNode))try{throw new Error("node is not child of ancestor(getInlineStyle)")}catch(t){return{}}return i},getNodeStyle:function(t,e){var n,o;if(3===t.nodeType)return{};for(o=e?{}:dom.util.getStyle(t);1===t.childNodes.length&&(t=t.childNodes[0]);)n=dom.util.getStyle(t),dom.util.extend(o,n);return o},copyStyle:function(t,e){var n;if(n=t.style.cssText)return e.style.cssText=n},applyStyle:function(t,e){var n,o,i;n=[];for(o in e)i=e[o],"boolean"!=typeof i&&n.push(o+": "+i);return t.style.cssText=n.join(";")},addStyle:function(t,e){var n,o,i;if("object"==typeof e){o=[];for(n in e)i=e[n],o.push(t.style[n]=i);return o}},removeStyle:function(t,e){var n,o,i;if(dom.util.isStyleNode(t)){if(o=dom.util.getStyle(t),dom.util.isEqualObject(o,e))return dom.util.removeParent(t);for(n in e)i=e[n],"*"!==i&&o[n]!==i||delete o[n];return dom.util.isEmptyObject(o)?dom.util.removeParent(t):dom.util.applyStyle(t,o)}},isEqualStyle:function(t,e){return 3===t.nodeType&&3===e.nodeType||!!dom.util.isStyleNode(t)&&(t.tagName===e.tagName&&!!dom.util.isEqualObject(dom.util.getStyle(t),dom.util.getStyle(e)))},cloneStyleNode:function(t){var e;return e=document.createElement(t.tagName.toLowerCase()),dom.util.copyStyle(t,e),e},getClosestStyleNode:function(t,e){var n;if(!t.nodeType)throw new Error("node is not instance of Node(getClosestStyleNode)");if("*"===e)return dom.util.getInlineBlock(t);
for(;9!==t.nodeType;){if(n=dom.util.getStyle(t),dom.util.include(n,e))return t;t=t.parentNode}},isEmptyNode:function(t){var e;if(e=dom.util.getEndTextNode(t,!0),!e||""===e.nodeValue)return!0},getImmediateChild:function(t,e){var n,o;return o=dom.util.getIndexPath(t,e),n=e.childNodes[o[0]]},getEndTextNode:function(t,e){var n,o,i,r;if(3===t.nodeType)return t;if(e)for(o=-1,i=t.childNodes.length;++o<i;){if(n=t.childNodes[o],3===n.nodeType)return n;if(r=arguments.callee(n,e))return r}else for(o=t.childNodes.length;--o>-1;){if(n=t.childNodes[o],3===n.nodeType)return n;if(r=arguments.callee(n,e))return r}},getTextLength:function(t){var e,n,o,i,r;if(o=0,3===t.nodeType)o=t.nodeValue.length;else if("img"===t.tagName.toLowerCase())o=1;else for(r=t.childNodes,n=0,i=r.length;n<i;n++)e=r[n],o+=3===e.nodeType?e.nodeValue.length:arguments.callee(e);return o},getTextIndex:function(t,e){var n,o,i,r,l,s;if(t===e)return 0;for(l=t.parentNode,i=0,s=l.childNodes,o=0,r=s.length;o<r&&(n=s[o],n!==t);o++)i+=3===n.nodeType?n.nodeValue.length:dom.util.getTextLength(n);return e&&l!==e&&(i+=arguments.callee(l,e)),i},getFullText:function(t){var e,n,o,i,r;for(r="",n=dom.util.getAllChilds(t,!0),o=0,i=n.length;o<i;o++)e=n[o],3===e.nodeType&&(r+=e.nodeValue);return r}}},{}],6:[function(t,e,n){var o;o=t("../plugin/Finder"),$.extend(BME.util,{browser:function(){var t,e,n;switch(n=navigator.userAgent.toLowerCase(),t={},!0){case!!(e=/msie\s(\d+)\./.exec(n)):t.ie=!0,t.version=parseInt(e[1]);break;case/trident\//.test(n):t.ie=!0,t.version=11;break;case!!(e=/edge\/(\d+)\./.exec(n)):t.edge=!0,t.version=parseInt(e[1]);break;case window.opera&&opera.version:t.opera=!0;break;case/applewebkit/.test(n):t.webkit=!0;break;case"Gecko"===navigator.product:t.gecko=!0}return t.ie&&t.version<9&&(t.ie9below=!0),t}(),loadCss:function(t,e){var n,o,i,r,l;for(null==e&&(e=window),t instanceof Array||(t=[t]),l=[],o=0,i=t.length;o<i;o++)n=t[o],"string"==typeof n?(r=document.createElement("link"),r.rel="stylesheet",r.type="text/css",r.href=t,l.push($("head")[0].appendChild(r))):l.push(void 0);return l},throwError:function(t){var e;throw this.browser.ie9below&&(e=arguments.callee.caller,console.log(e),console.log("--------->"),console.log(e.caller)),new Error(t)},Finder:o,Modal:function(t){var e;return e=$('<div class="'+(t.className||"")+'">\n\n</div>')}})},{"../plugin/Finder":9}],7:[function(t,e,n){window.BME=window.BME||{},window.dom=window.dom||{},BME.ui={},BME.tool={},BME.util={},$.extend(BME,{version:"1.0.0",code:"cola",testMode:!1}),t("./core/util"),t("./core/dom.util"),t("./core/Editor"),dom.util.ie8hack(window),BME.testMode&&BME.util.browser.ie9below&&(window.console={log:function(t){return alert(t)}})},{"./core/Editor":1,"./core/dom.util":5,"./core/util":6}],8:[function(t,e,n){BME.default_option={toolbars:[{name:"default",tools:["bold","underline","italic","contentType","fontsize","textAlign","img"]}],links:[],scripts:[],upload:{}}},{}],9:[function(t,e,n){var o;o=function(){function t(e,n){return this instanceof t?(this.o=e,this.l=[],void(n&&this.find(n))):new t(e,n)}return t.prototype.find=function(t){var e,n,o,i,r,l,s,a;if(arguments[1]?(l=arguments[1],s=arguments[2]):(this.keyword=t,l=this.o,s=[]),l instanceof Array)for(o=n=0,r=l.length;n<r;o=++n)switch(a=l[o],e=s.concat([o]),Object.prototype.toString.call(a)){case"[object String]":case"[object Number]":(a+"").indexOf(t)>-1&&this.log(this.format(e)+": "+a);break;case"[object Array]":case"[object Object]":if(this.l.indexOf(a)>-1)break;this.l.push(a),this.find(t,a,e)}else for(i in l)switch(a=l[i],e=s.concat([i]),(i+"").indexOf(t)>-1&&this.log(this.format(e)),Object.prototype.toString.call(a)){case"[object String]":case"[object Number]":(a+"").indexOf(t)>-1&&this.log(this.format(e)+": "+a);break;case"[object Array]":case"[object Object]":if(this.l.indexOf(a)>-1)break;this.l.push(a),this.find(t,a,e)}return arguments[1]||(this.l=[]),this},t.prototype.format=function(t){var e,n,o,i;for(e="",n=0,i=t.length;n<i;n++)o=t[n],"string"==typeof o?e+=o+".":"number"==typeof o&&e.replace(/\.?$/,"["+o+"].");return e=e.replace(/\.?$/,"")},t.prototype.log=function(t){var e,n,o,i;if(t)return o="#00a0e9",n=[],i=new RegExp(""+this.keyword,"g"),e=t.replace(i,function(t){return n.push("color: "+o),n.push("color: inherit"),"%c"+t+"%c"}),n.unshift(e),console.log.apply(console,n)},e.exports={Finder:t},t}()},{}],10:[function(t,e,n){var o,i,r;i=BME.util.browser,r=function(t){var e,n,i,r,l,s,a,d,c,u;return e=new $.Deferred,l=t.input,c=t.url,s=t.responseKey,a=1e3*t.timeout||1e4,"function"!=typeof window.FormData||t.iframe?(n=$(l).closest("form")[0],n.action=c,n.target="upload_iframe_"+ +new Date,r=document.createElement("iframe"),r.name=n.target,r.hidden=!0,document.body.appendChild(r),r.onload=function(){var t,n,i,l;try{l=r.contentWindow.document.body.innerHTML;try{i=JSON.parse(l),n=dom.util.getValue(i,s),e.resolve({code:o.SUCCESS,url:n})}catch(n){t=n,e.reject({code:o.CONTENT_ERROR,msg:"parse json error",text:t.message})}}catch(n){t=n,e.reject({code:o.IFRAME_CROSS_DOMAIN,msg:t.message})}return clearTimeout(d),document.body.removeChild(r)},r.onerror=function(){return e.reject({code:o.UNKOWN_ERROR}),clearTimeout(d),document.body.removeChild(r)},d=setTimeout(function(){return r.onload=null,r.onerror=null,document.body.removeChild(r),e.reject({code:o.TIMEOUT})},a),n.submit()):(i=new FormData,i.append(l.name,file),u=new XMLHttpRequest,u.timeout=a,u.onreadystatechange=function(){var t,n,i;if(4===u.readyState){if(200!==u.status)return u.status?e.reject({code:o.RESPONSE_NOT_200,status:u.status,text:u.responseText}):e.reject({code:o.TIMEOUT});try{return i=JSON.parse(u.responseText),n=dom.util.getValue(i,s),e.resolve({code:o.SUCCESS,url:n})}catch(n){return t=n,e.reject({code:o.RESPONSE_NOT_200,msg:"parse json error",text:u.responseText})}}},u.open("post",c),u.send(i)),e},o=r.ERROR_CODE={SUCCESS:0,CONTENT_ERROR:1,MIME_NOT_ACCEPT:2,SIZE_OVERFLOW:3,RESPONSE_NOT_200:4,IFRAME_CROSS_DOMAIN:5,TIMEOUT:6,UNKOWN_ERROR:9},e.exports=r},{}],11:[function(t,e,n){var o,i=function(t,e){function n(){this.constructor=t}for(var o in e)r.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;o=function(t,e){return(t?'<i class="editor-icon editor-icon-'+t+'">':"")+"</i>\n"+(e||"")},BME.tool.Tool=function(t){function e(t){var e,n,i,r,l,s,a,d,c,u,h;switch($.extend(this,t),h=this,n=this.owner_editor,this.className="tool-"+this.name,this.type){case"button":d=dom.util.formatStyle(this.tagName,this.style),e=function(t){return function(e){var n;return n=e.queryInlineStyle(),dom.util.include(n,d)?(e.clearInlineStyle(t.tagName,t.style),t.$el.removeClass("on")):(e.applyInlineStyle(t.tagName,t.style),t.$el.addClass("on"))}}(this),n.registerCommand(this.name,e),this.cmd=this.name,n.on("selectionchange",function(t){return function(e){var n;return n=e.queryInlineStyle(),dom.util.include(n,d)?t.$el.addClass("on"):t.$el.removeClass("on")}}(this));break;case"select":for(u=this.options,l=r=0,a=u.length;r<a;l=++r)s=u[l],s.default&&(this.default_option=s,this.default_index=l),null==s.content&&(s.content=o(s.icon));switch(this.target){case"block":c="queryBlockStyle",i="applyBlockStyle";break;default:c="queryInlineStyle",i="applyInlineStyle"}e=function(t){return function(e,n){var o,r,l;return l=e[c](),o=dom.util.formatStyle(n.tagName,n.style),dom.util.isEmptyObject(o)||!dom.util.include(l,o)?(e[i](n.tagName,n.style),r=t.options[n.option],t.$el.find("dd").removeClass("on"),t.$el.find("span").html(r.content),t.$el.find("dd").eq(n.option).addClass("on")):e.select()}}(this),n.registerCommand(this.name,e),this.cmd=this.name,n.on("selectionchange",function(t){return function(e){var n,o,i,r,a,d;for(a=e[c](),t.$el.find("dd").removeClass("on"),d=t.options,l=o=0,i=d.length;o<i;l=++o)if(s=d[l],n=dom.util.formatStyle(t.tagName||s.tagName,s.style),!dom.util.isEmptyObject(n)&&dom.util.include(a,n)){t.$el.find("span").html(s.content),t.$el.find("dd").eq(l).addClass("on"),r=!0;break}if(!r)return t.$el.find("dd").eq(t.default_index).addClass("on"),t.$el.find("span").html(t.default_option.content)}}(this));break;case"pop":console.log}n.once("ready:"+this.owner_toolbar.id,function(t){return function(){return t.$el=$("#"+t.owner_toolbar.id+" ."+t.className),t.bindEvent()}}(this))}return i(e,t),e.prototype.template=function(t){var e,n,i,r,l,s,a;switch(a="<"+t+' class="tool tool-'+this.type+" "+this.className+'" data-cmd="'+this.cmd+'">',this.type){case"button":a=a.replace(this.className,this.className+" tool-cmd"),a+=o(this.icon,this.content);break;case"select":for(a+="<div><span>"+this.default_option.content+"</span></div><dl>",s=this.options,i=n=0,l=s.length;n<l;i=++n)r=s[i],e=JSON.stringify({tagName:this.tagName||r.tagName,style:r.style,option:i}),a+='<dd class="tool-cmd option-'+i+(i===this.default_index?" option-default on":"")+"\" data-data='"+e+"'>"+r.content+"</dd>";a+="</dl>";break;case"pop":console.log;break;default:a+=o(this.icon,this.content)}return a+="</"+t+">"},e.prototype.bindEvent=function(){var t,e,n,o,i,r,l,s;switch(r=this,t=this.owner_editor,l=this.owner_toolbar,this.type){case"select":console.log;break;case"pop":console.log}o=this.events,i=[];for(e in o)s=o[e],n=e.split(" "),i.push(this.$el.on(n[0],n[1],function(e){return function(n){var o;return o=t.selection.getRange(),s.call(e,n,o)}}(this)));return i},e}(BME.ui.UIBase)},{}],12:[function(t,e,n){var o,i=function(t,e){function n(){this.constructor=t}for(var o in e)r.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;o=0,BME.tool.Toolbar=function(t){function e(t){$.extend(this,t),this.id="toolbar_"+o++,this.Tool=BME.tool[this.Tool||"Tool"],this.loadTools(),this.owner_editor.once("ready:editorui",function(t){return function(){return t.$el=$("#"+t.id),t.bindEvents(),t.owner_editor.trigger("ready:"+t.id)}}(this))}return i(e,t),e.prototype.loadTools=function(){var t,e,n,o,i,r,l;for(l=[],this.tool_map=[],o=this.tools||[],e=0,n=o.length;e<n;e++)if(r=o[e],t=BME.tool[r]){if(this.tool_map[r])throw new Error("tool "+r+" repeat in toolbar-"+this.name);i=new this.Tool($.extend(t,{name:r,owner_toolbar:this,owner_editor:this.owner_editor})),this.tool_map[r]=i,l.push(i)}return this.tools=l},e.prototype.template=function(){var t,e,n,o,i;for(i=[],n=this.tools,t=0,e=n.length;t<e;t++)o=n[t],i.push(o.renderHTML("li"));return i=i.join(""),'<div class="toolbar toolbar-'+this.name+'" id="'+this.id+'">\n    <ul>\n        '+i+"\n    </ul>\n</div>"},e.prototype.bindEvents=function(){var t,e;return e=this,t=this.owner_editor,this.$el.on("click",".tool-cmd",function(){var e,n,o;return e=$(this).closest(".tool"),n=e.data("cmd"),o=$(this).data("data"),t.execCommand(n,o)}).on("click",".tool-select",function(){var t;return t=$(this),t.hasClass("on")?t.removeClass("on"):t.addClass("on")}),t.bindGlobal(function(t){return $(t.document).on("click",function(t){var n;return n=$(t.target||t.srcElement).closest(".tool-select")[0],e.$el.find(".tool-select.on").each(function(){if(this!==n)return $(this).removeClass("on")})})})},e}(BME.ui.UIBase)},{}],13:[function(t,e,n){BME.tool.contentType={type:"select",target:"block",options:[{content:"大标题",tagName:"h1"},{content:"小标题",tagName:"h3"},{content:"正文&nbsp;&nbsp;&nbsp;&nbsp;",tagName:"p","default":!0}]},BME.tool.textAlign={type:"select",target:"block",options:[{icon:"left",style:{"text-align":"left"},"default":!0},{icon:"center",style:{"text-align":"center"}},{icon:"right",style:{"text-align":"right"}}]}},{}],14:[function(t,e,n){BME.tool.commands={insertUneditableBlock:function(t,e){var n;return n=$(e)[0],n.className+=" uneditable",n.contentEditable="false",t.insertNode(n),n}}},{}],15:[function(t,e,n){BME.tool.bold={type:"button",tagName:"b"},BME.tool.underline={type:"button",style:{"text-decoration":"underline"}},BME.tool.italic={type:"button",tagName:"em"},BME.tool.fontsize={type:"select",options:[{content:"12px",style:{"font-size":"12px"}},{content:"13px",style:{"font-size":"13px"}},{content:"14px",style:{"font-size":"14px"}},{content:"16px",style:{"font-size":"16px"},"default":!0},{content:"18px",style:{"font-size":"18px"}},{content:"20px",style:{"font-size":"20px"}}]}},{}],16:[function(t,e,n){var o;o=t("../plugin/fileUpload"),BME.tool.img={type:"custom",icon:"img",content:'<form enctype="multipart/form-data" method="post"><input type="file" name="file"></form>',events:{"change input":function(t,e){var n,i,r,l,s,a,d,c;return r=this.owner_editor,a=t.target||t.srcElement,s=$(a).closest("form")[0],i=["jpeg","png","gif"],n=!0,(l=null!=(d=a.files)?d[0]:void 0)&&(c=l.type,n=i.some(function(t){return c.indexOf(t)>-1})),n&&o({input:a,url:r.option.upload.url,responseKey:r.option.upload.key,iframe:!0}).then(function(t){return function(t){var e;return e=t.url,r.execCommand("insertUneditableBlock",'<div><img style="width: 100%;display: block;" src="'+e+'"></div>')}}(this),function(t){switch(console.log(t),t.code){case o.ERROR_CODE.CONTENT_ERROR:return console.log(t.text)}}),s.reset()}}}},{"../plugin/fileUpload":10}],17:[function(t,e,n){t("./Tool"),t("./Toolbar"),t("./commands"),t("./font"),t("./block"),t("./img")},{"./Tool":11,"./Toolbar":12,"./block":13,"./commands":14,"./font":15,"./img":16}],18:[function(t,e,n){var o=[].slice;BME.ui.UIBase=function(){function t(){}return t.prototype.renderHTML=function(){var t,e,n;return t=1<=arguments.length?o.call(arguments,0):[],n="function"==typeof this.template?this.template.apply(this,t):this.template,e=n},t}()},{}],19:[function(t,e,n){var o=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;BME.ui.Editor=function(t){function e(t){this.editor=t,this.option=this.editor.option}return o(e,t),e.prototype.template=function(){var t,e,n,o,i,r;for(r="",o=this.editor.toolbars||[],e=0,n=o.length;e<n;e++)i=o[e],r+=i.renderHTML();return t=r+"\n "+(this.option.hasTitle?'<div class="title"><input type="text" placeholder="在这里输入标题" value='+(this.option.title||"")+"></div>":"")+'\n<div class="content">\n    <div class="iframe-holder"></div>\n</div>'},e}(BME.ui.UIBase)},{}]},{},[7]);

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/