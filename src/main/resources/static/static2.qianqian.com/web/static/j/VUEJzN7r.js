require(["core/utils","widget/toast/toast","tmpl/huodong/ticket/infoTopLeft","tmpl/huodong/ticket/infoTopRight","tmpl/huodong/ticket/infoBottomLeft","domain_config"],function(utils,toastPlugin,topLeftTmpl,topRightTmpl,bottomLeftTmpl,domainConfig){var $topLeftTmpl=$("#topLeftTmpl"),$topRightTmpl=$("#topRightTmpl"),$bottomLeftTmpl=$("#bottomLeftTmpl");var bdShare=function(tag,shareParam){window._bd_share_config={common:{onBeforeClick:function(t,e){e=$.extend(e,shareParam);return e},onAfterClick:function(t){}},share:[{tag:tag,bdSize:24}]};window._bd_share_main=false;with(document)0[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion="+~(-new Date/36e5)]};var shareFormat=function(t,e){var i=(new Date).getTime();t=t*1e3;e=e*1e3;if(i<t){return"在千千音乐+正在抢票中，快来一起参与吧！"}else if(i>e){return"报名活动已结束，快来围观获奖名单！"}else{if(utils.dateFormat(t,"yyyy-MM-dd")==utils.dateFormat(i,"yyyy-MM-dd")){return"在千千音乐今天"+utils.dateFormat(t,"hh:mm")+"开始报名，快来一起参与吧！"}else{return"在千千音乐距离报名还有"+Math.floor((t-i)/(24*3600*1e3))+"天，快来一起参与吧！"}}};var formEvent=function(){var t=$("#joinForm"),e=$("#phone",t),i=$("#code",t),o=$("#rule",t);var n=function(){var t=e.val(),i=e.siblings(".error-tip");if($.trim(t)===""){e.addClass("error");i.html("请填写手机号").show();return false}var o=new RegExp(/^1[34578]\d{9}$/);if(!t.match(o)){e.addClass("error");i.html("手机号不合法").show();return false}e.removeClass("error");return true},a=function(t){var t=i.val(),e=i.siblings(".error-tip");if($.trim(t)===""){i.addClass("error");e.html("请填写验证码").show();return false}var o=new RegExp(/^[0-9]{6}$/);if(!t.match(o)){i.addClass("error");e.html("验证码不合法").show();return false}i.removeClass("error");return true},r=function(){var t=o.parent(".input-checkbox");if(!o.is(":checked")){t.addClass("error");return false}t.removeClass("error");return true};t.on("focus",".input-text",function(t){var e=$(this),i=e.siblings(".error-tip");i.hide()}).on("click",".vcode-hook",function(t){if(!n()){return}var i=$(this);phone=e.val();utils.tingApi("baidu.ting.sms.sendVerifyCode",{product:"music",tid:"smsTpl:4e76bf91-fa2f-4f34-a670-5e3a387fe122",receiver:utils.base64Encode(phone),num:6}).always(function(){var t=null,e=60;i.hide();i.after('<span class="code-btn code-wait">重发 '+e+"s</span>");var o=i.next(".code-wait");t=setInterval(function(){e--;if(e<=0){clearInterval(t);i.show();o.remove()}else{o.html("重发 "+e+"s")}},1e3)})}).on("click",".join-hook",function(t){var o=$(this);if(!n()||!a()||!r()){return}utils.tingApi("baidu.ting.active.piaoJoin",{activity_id:activityId,name:nickName,phone:e.val(),code:i.val()}).done(function(t){if(t.result.status==2){toastPlugin.show({data:{cls:"succ",text:"报名成功"},callback:function(){window.location.reload()}})}else{toastPlugin.show({data:{cls:"fail",text:"报名失败，"+t.result.status_desc}})}}).fail(function(t){var e="报名失败，请稍后再试";switch(t.error_code){case 22452:e="未获取到登陆状态";break;case 22654:e="验证码次数超限";break;case 22656:e="验证码失效";break}toastPlugin.show({data:{cls:"fail",text:e}})})}).on("click",".vip-btn",function(t){if(ting.userInfo){tpay=new ting.tPay({type:"vip"});tpay.load()}else{ting.passport.checkLogin(function(){})}})};utils.tingApi("http://static2.qianqian.com/web/static/j/baidu.ting.active.piao",{activity_id:activityId}).done(function(t){$topLeftTmpl.html(topLeftTmpl({item:t.result}));$bottomLeftTmpl.html(bottomLeftTmpl({info:t.result}));$.getScript(domainConfig.host+"/cms/common/bmEditor/template/main.js");var e=t.result.title+shareFormat(t.result.join_start,t.result.join_end);bdShare("share_ticket",{bdText:e,bdDesc:e,bdUrl:domainConfig.host+"/cms/webview/ticket2017/info.html?aid="+activityId,bdPic:t.result.pic_url});$topRightTmpl.html(topRightTmpl({info:t.result,isLogin:nickName===""?false:true,nickName:nickName}));require(["page/uuser/friend"]);formEvent();$(".common-loading").remove()});$bottomLeftTmpl.on("click",".winner-hook",function(t){var e=$(this);var i=$(".winner-list .winner-list-hidden");if(e.hasClass("close")){e.removeClass("close");e.find("b").html("展开");i.css("max-height","130px")}else{e.addClass("close");e.find("b").html("收起");i.css("max-height","none")}});$topRightTmpl.on("click",".login-hook",function(t){ting.passport.login()});$(window).on("scroll",function(){var t=$topRightTmpl.find(".top-right");if($("body").scrollTop()>=$topRightTmpl.offset().top){t.addClass("fix-top")}else{t.removeClass("fix-top")}})});

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/