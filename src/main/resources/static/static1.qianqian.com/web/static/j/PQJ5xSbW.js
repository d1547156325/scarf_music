(function(t){t.widget("ting.autoComplete",{options:{},_create:function(){var e=this;e.widgetEventPrefix="auto.";e.sugInput=t(".s_ipt_wr input");e.sugResult=t(".sug-result");e.sugType="search";e.keyword="";e._dataCache={};e.classStyle={FIRST_ITEM:"first-item",LAST_ITEM:"last-item",OVER:"over",CI:"ci"};e.keyMgr={DOWN:40,UP:38,ESC:27,ENTER:13};e.currentItem=null;e.selectEventInterval=150;e._lastSelectTime=null;e._focusing=false;e.logTime=0;e.num=0;e.timeId=null;e.loadPic=t("#loading-pic");e.addInputEventListener();e.DefaultCdPic="../../../../static3.qianqian.com/web/static/i/3eSIcTg8.png"/*tpa=http://static3.qianqian.com/web/static/i/3eSIcTg8.png*/;e.DefaultAvatarPic="../../../../static2.qianqian.com/web/static/i/ixDq1LKy.png"/*tpa=http://static2.qianqian.com/web/static/i/ixDq1LKy.png*/},addInputEventListener:function(){var e=this;e.sugInput.bind("blur",function(){if(!e._focusing){e.hide()}});e.sugInput.bind("focus input propertychange",function(t){if(e.timeId===null){e.timeId=setTimeout(function(){e.textChangeHandler(t)},50)}});e.sugInput.bind("keydown",function(t){if(t.keyCode!=40&&t.keyCode!=38&&t.keyCode!=27&&t.keyCode!=13){return}var s=(new Date).valueOf();var i=parseInt(s-e._lastSelectTime,10)||0;if(i>=e.selectEventInterval){e._lastSelectTime=s;e.keySelectHandler(t)}});e.sugResult.bind("mouseenter",function(t){e._focusing=true});e.sugResult.bind("mouseleave",function(t){e.currentItem=null;e._focusing=false});e.sugResult.bind("mousedown",function(s){var i=s.target,a=i.nodeName.toUpperCase(),n="",r=null;if(a!="A"){r=t(i).parents("a:first").get(0);if(r&&t(r,e.sugResult)){i=r}else{return}}var l=t(i).parents("dl:first").attr("class")||"sug-people";var u=l.match(/sug-(\w+)/),o;if(u){o=u[1];e.channelName=o;if(o=="people"){n="clicklog"}else{n="suggestionlog"}}e._trigger(n,null,e);return})},handleResponse:function(e){var s=this;var i=s.format(e);s.sugResult.html(i);t(".music-icon-hook",s.sugResult).musicIcon({hasTip:false});t(".music-icon-hook .list-micon",s.sugResult).bind("click",function(){var e=t(this).parent().data("log")||{};e.act=t(this).data("action");ting.logger.plogClick("clicksearch",e)});s.mouseOverHandler();s.mouseOutHandler();s.currentItem=null;s.loadPic.css("display","none");ting.logger.log("exposure",{expoitem:"sug",sub:s.sugType});this.show()},handleReady:function(t){var e=this;e._dataCache[e.keyword||"remlist"]=t;e.handleResponse(t)},textChangeHandler:function(e){var s=this;s.timeId=null;var i=s.sugInput.val();if(s.keyword==t.trim(i)&&s.keyword!=i){return}s.keyword=t.trim(i);s.logTime=(new Date).valueOf();s.loadPic.css("display","block");var a=s._dataCache[s.keyword||"remlist"];if(a!==undefined){s.handleResponse(a)}else{s._dataCache={};s._trigger("change",e,s)}},keySelectHandler:function(e){var s=window.event?event.keyCode:e.which;var i=0;var a=this.currentItem;var n=null;switch(s){case this.keyMgr.UP:e.preventDefault();i--;break;case this.keyMgr.DOWN:e.preventDefault();i++;break;case this.keyMgr.ESC:this.sugInput.blur();this.hide();break;case this.keyMgr.ENTER:e.preventDefault();var r=this.currentItem;if(r){this.sugInput.blur();var l=this.currentItem.parents("dl:first").attr("class");var u=l.match(/sug-(\w+)/),o;if(u){o=u[1];this.channelName=o}else{return}this._trigger("suggestionlog",null,this);location.href=t("a",r).attr("href");return}else{if(!t.trim(this.sugInput.val())){return null}else{this.sugInput.blur();this._trigger("commonlog",null,this);var c=this;setTimeout(function(){c.element.submit()},500)}}break;default:break}if(i){if(i==1){if(a){n=a.nextAll("dd").eq(0);if(!n.length){if(!a.parent().nextAll("dl").length){n=t("dd:first",this.sugResult)}else{n=a.parent().nextAll("dl").eq(0).children("dd:first")}}}else{n=t("dd:first",this.sugResult)}}else if(i==-1){if(a){n=a.prevAll("dd").eq(0);if(!n.length){if(!a.parent().prevAll("dl").length){n=t("dd:last",this.sugResult)}else{n=a.parent().prevAll("dl").eq(0).children("dd:last")}}}else{n=t("dd:last",this.sugResult)}}if(a){t("a",a).removeClass("over")}if(n.length){t("a",n).addClass("over");this.currentItem=n}else{this.currentItem=null}}},mouseOverHandler:function(){var e=this;t("dd",e.sugResult).bind("mouseenter",function(s){t("a",e.sugResult).removeClass("over");e.currentItem=t(this);t(this).children("a").addClass("over")})},mouseOutHandler:function(){var e=this;t("dd",e.sugResult).bind("mouseleave",function(s){t(this).children("a").removeClass("over");e.currentItem=null})},toKeyWord:function(t){if(!this.keyword){return t}else{var e=this.keyword.toLowerCase();var s=t.toLowerCase().indexOf(e);var i=e.length;if(this.keyword&&s>=0){return t.substring(0,s)+'<span class="'+this.classStyle.CI+'">'+t.substring(s,s+i)+"</span>"+t.substring(s+i)}else{return t}}},toContent:function(t,e,s,i){if(!t.length){return}var a=this;var i=i||"search";var n=['<dl data-module="'+i+'" class = "sug-'+e+' clearfix"><dt class = "sug-title clearfix">'+s+"</dt>"];var r=0;var l=a.DefaultCdPic;var u=a.DefaultAvatarPic;var o=315;if(i=="search"){switch(e){case"artist":if(t.length<3){r=t.length}else{r=3}break;case"song":if(t.length<9-a.num){r=t.length}else{r=9-a.num}break;case"album":if(t.length<2){r=t.length}else{r=2}break;default:break}}else{r=t.length}for(var c=0;c<r;c++){a.num++;var d=t[c];if(r===1){n.push('<dd class = "'+a.classStyle.FIRST_ITEM+" "+a.classStyle.LAST_ITEM+'">')}else{if(c===0){n.push('<dd class = "'+a.classStyle.FIRST_ITEM+'">')}else if(c==r-1){n.push('<dd class = "'+a.classStyle.LAST_ITEM+'">')}else{n.push("<dd>")}}switch(e){case"artist":if(!!d.artistpic){u=d.artistpic}else{u=a.DefaultAvatarPic}if(Number(d.yyr_artist)==1&&Number(d.is_skip_yyr)==1){var g="_blank"}else{var g="_self"}n.push('<a target="'+g+'" href="http://static1.qianqian.com/artist/%27+d.artistid+%27?pst=sug"><img width="40px" height="40px" src="'+u+'" alt="'+d.artistname+'" /><span>'+a.toKeyWord(ting.cutString.cutStr(d.artistname,o-60,true,14))+"</span></a>"+a.musicIconHtml(d.artistid,"artist")+"</dd>");break;case"song":var h=ting.cutString.getP(d.songname,14),m="",f="",p=0;if(a.sugType=="recommend"){f='<img width="40px" height="40px" src="'+(d.songpic||a.DefaultCdPic)+'" />';p=58;o=o-p}if(Number(d.yyr_artist)==1&&Number(d.is_skip_yyr)==1){var v="_blank";var y="http://y.taihe.com/song/"+d.yyr_song_id+"?pst=sug"}else{var v="_self";var y="/song/"+songidUrl+"?pst=sug"}if(h>=o-38){m='<a target="'+v+'" href='+y+">"+f+'<span class="songname">'+a.toKeyWord(ting.cutString.cutStr(d.songname,o-17,true,14))+"</span></a>"+a.musicIconHtml(d.songid,"song")+"</dd>"}else if(h<o-38&&h>=o-53){m='<a target="'+v+'" href='+y+">"+f+'<span class="songname">'+a.toKeyWord(d.songname)+'</span><span class="artistname">-...</span></a>'+a.musicIconHtml(d.songid,"song")+"</dd>"}else if(h<o-53){var b=o-h-24;m='<a target="'+v+'" href='+y+">"+f+'<span class="songname">'+a.toKeyWord(d.songname)+'</span><span class="artistname"><i class="h-line">-</i>'+a.toKeyWord(ting.cutString.cutStr(d.artistname,b,true,14))+"</span></a>"+a.musicIconHtml(d.songid,"song")+"</dd>"}n.push(m);break;case"album":if(!!d.artistpic){l=d.artistpic}else{l=a.DefaultCdPic}n.push('<a href="http://static1.qianqian.com/album/%27+d.albumid+%27?pst=sug"><div class = "borderdiv"><span class="sidepic"></span><img width="40px" height="40px" src="'+l+'" alt="'+d.albumname+'" /></div><div>《'+a.toKeyWord(ting.cutString.cutStr(d.albumname,o-80,true,14))+'》</div><div class="artistname album-artist-name">'+a.toKeyWord(ting.cutString.cutStr(d.artistname,o-70,true,14))+"</div></a>"+a.musicIconHtml(d.albumid,"album")+"</dd>");break;case"mv":n.push('<a href="http://static1.qianqian.com/playmv/%27+d.mvid+%27?pst=sug">'+a.toKeyWord(ting.cutString.cutStr(d.mvname,o,true,14))+"</a></dd>");break;case"playlist":o=o-58;n.push('<a href="http://static1.qianqian.com/songlist/%27+d.playlistid+%27?pst=sug"> <img width="40px" height="40px" src="'+(d.playlistpic||a.DefaultCdPic)+'" /> <span class="songname">'+a.toKeyWord(ting.cutString.cutStr(d.playlistname,o,true,14))+"</span></a>"+a.musicIconHtml(d.songids.replace(/,/g,"_"),"song")+"</dd>");break;default:break}}n.push("</dl>");return n.join("")},musicIconHtml:function(t,e){var s='<span class="music-icon-hook" data-log="{&quot;page&quot;:&quot;suglog&quot;,&quot;pos&quot;:&quot;sug_'+e+'&quot;}" data-musicicon="{&quot;id&quot;:&quot;'+t+"&quot;,&quot;type&quot;:&quot;"+e+'&quot;,&quot;iconStr&quot;:&quot;play add&quot;,&quot;moduleName&quot;:&quot;sugIcon&quot;}">'+'<a class="list-micon icon-play" data-action="play" title="播放" href="#"></a>'+'<i class="module-line music-icon-line"></i>'+'<a class="list-micon icon-add" data-action="add" title="添加" href="#"></a>'+"</span>";return s},format:function(e){this.num=0;var s=e.Pro,e=e.data,i={artist:"",album:"",song:""},a="",n;var r=t.browser.msie&&t.browser.version=="6.0";if(!e){return}this.sugType="search";if(e.artist){i.artist=this.toContent(e.artist,"artist","歌手")||""}if(e.album){i.album=this.toContent(e.album,"album","专辑")||""}if(e.song){i.song=this.toContent(e.song,"song","歌曲")||""}if(e.list){this.sugType="recommend";n="<h2>大家正在搜</h2>";if(e.list.song){i.rmdlist=n+this.toContent(e.list.song,"song","歌曲","hot")||""}if(e.list.artist){i.rmdartist=this.toContent(e.list.artist,"artist","歌手","hot")||""}if(e.list.mv){i.rmdmv=this.toContent(e.list.mv,"mv","MV","hot")||""}if(e.list.playlist){i.rmdplaylist=this.toContent(e.list.playlist,"playlist","歌单","hot")||""}}if(e.recommend){n="<h2>猜你喜欢</h2>";i.recommend=n+this.toContent(e.recommend.song,"song","歌曲","individuation")||""}var l=r?'<iframe src="about:blank" frameborder="0"></iframe>':"";if(s){for(var u=0;u<s.length;u++){a+=i[s[u]]}}else{for(var o in i){a+=i[o]}}return l+'<div class = "shadowleft"><div class="shadowright"><div class="'+(this.sugType=="recommend"?"rmd-layer":"")+'">'+a+"</div></div></div>"},show:function(){this.sugResult.show()},hide:function(){this.sugResult.hide()},destroy:function(){this.sugInput.unbind();this.sugResult.unbind()}})})(jQuery);

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/