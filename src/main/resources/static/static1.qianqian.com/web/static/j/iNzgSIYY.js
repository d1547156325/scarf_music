(function(e,i){var t={add:"icon-add",collect:"icon-collect",download:"icon-download",play:"icon-play",playlist:"icon-playlist",recommend:"icon-recommend",songword:"icon-songword",subscribe:"icon-subscribe",send:"icon-send",jump:"icon-jump",needvip:"icon-needvip"};function o(e){var i=document.createElement("div");i.innerHTML=e;try{return i.childNodes[0].nodeValue}catch(t){return e}}function n(e,i){ting.showTip({$tar:e,type:"needgoldvip",cancelEvent:"blur",reason:i})}e.widget("ting.musicIcon",{options:{songId:null,hasTip:true,songName:null},_create:function(){var i=this,o=i.element,n=i.options,s=o.data("musicicon")?o.data("musicicon"):"",a=(o.data("musicicon")?o.data("musicicon").iconStr:n.iconStr)||"",l=a.replace(/^\s+/,""),c=l.split(" "),r,g,p;if(c.length<=1){for(p in t){c.push(p)}}i.icons={};for(var d=0,u=c.length;d<u;d+=1){g=c[d];if(g=="play"&&s.is_jump){g="jump"}if(g=="play"&&s.playFee){g="needvip"}r=t[g];if(r){i.icons["$"+g]=e("."+r,i.element)}}i._initEvent()},log:function(e){var i=window.location.pathname.split("/"),t=i[2]=="collection"?"select":i[1]||"home";ting.logger.log("singleDown",{source:t,sid:e})},_initEvent:function(){var i=this,t=i.element,s=i.icons;var a=t.data("musicicon")?t.data("musicicon"):"",l={moduleName:a.moduleName||"",searchValue:a.searchValue||"",id:a.id||"",mediaType:1,albumId:a.albumId||"",siPresaleFlag:a.siPresaleFlag||"",resourceTypeExt:a.pay_type||"",songPic:a.songPic||"",songTitle:a.songTitle||"",songPublishTime:a.songPublishTime||""};if(s.$play){s.$play.bind("click",function(t){var n=a.type||i.options.type,c="playSong";var r={page:ting.logger.getPage(),pos:"play_song",songcount:1};switch(n){case"song":c="playSong";break;case"album":c="playAlbum";break;case"diy":c="playDiy";break;case"artist":c="playArtist";break}if(l.resourceTypeExt&&(l.resourceTypeExt==3||l.resourceTypeExt==4)){ting.checkSellResourse(l.id,l.albumId,function(e){l.isPay=e;ting.media[c](o(a.id||i.options.id),l);if(l.isPay!=1||l.siPresaleFlag==1){g("notTip")}else{g()}});r.song_title=l.songTitle;r.song_id=l.id;r.isPay=2}else{ting.media[c](o(a.id||i.options.id),l);g()}function g(o){o=o||"";if(i.options.hasTip){if(n=="song"&&(a.kr_top=="1"||a.kr_top=="2")){var l=e("#krPlayTip");if(!l.length){l=e("<div>",{id:"krPlayTip","class":"kr-play-tip",html:'<span class="tip-arrow"></span><a target="_blank" href="http://static1.qianqian.com/king/top">King榜</a>打榜歌曲，<a target="_blank" href="http://static1.qianqian.com/king/legal#listen-rule">有效试听</a>可提升排名'}).appendTo("body");e(document).bind("mousedown",function(i){if(e.contains(e("#krPlayTip")[0],i.target)){return false}e("#krPlayTip").hide()})}l.attr("style","left:"+(s.$play.offset().left-(l.outerWidth()-s.$play.outerWidth())/2)+"px;"+"top:"+(s.$play.offset().top+s.$play.outerHeight()+8)+"px");l.show()}else{if(o!="notTip"){e(t.target).tip().tip("tipup",{msg:"已开始播放",iconClass:"tip-success"})}}}}if(ting&&ting.logger&&ting.logger.plogClick){ting.logger.plogClick("play_"+n);ting.logger.log("play",r)}if(ting.browser.isSpecial()){ting.browser.add2box("play")}return false})}if(s.$needvip){s.$needvip.bind("click",function(t){var s=e(this);var c=a.id||i.options.id,r=r||"";ting.checkSellResourse(c,r,function(e){var t=e;if(BDUS&&BDUS.vipState!="gold"&&t!=1){n(s,"pay_listen")}else{var c=a.type||i.options.type;var r="playSong";switch(c){case"song":r="playSong";break;case"album":r="playAlbum";break;case"diy":r="playDiy";break;case"artist":r="playArtist";break}ting.media[r](o(a.id||i.options.id),l)}})})}if(s.$recommend){s.$recommend.bind("tip.confirm",function(e,t){var o=a||i.options;o.description=t._textarea.val();ting.connect.recommend(null,o,function(e){s.$recommend.tip({contentType:"text",showTime:1e3,button:null}).tip("tipup",{msg:"推荐成功",iconClass:"tip-success"})},function(e){s.$recommend.tip({contentType:"text",showTime:1e3,button:null}).tip("tipup",{msg:e.errorMessage||"推荐失败",iconClass:"tip-error"})})}).bind("tip.cancel",function(e,i){if(i._textarea.val()){i._textarea.val("");i.textareaCheck();return false}else{return true}});s.$recommend.bind("click",function(e){ting.passport.checkLogin(function(){},function(){},function(){},function(){},{ref:"pop_web",operation:true});return false})}if(s.$collect){s.$collect.tip();var c={page:ting.logger.getPage(),pos:"collect_song",songcount:1};s.$collect.bind("click",function(o){var r=Number(t.data("musicicon").yyr_song_id),g=Number(t.data("musicicon").id);if(r){if(!ting.userInfo){ting.passport.checkLogin(function(){});return false}e.ajax({url:"http://y.taihe.com/data/song/favorite/add",type:"POST",dataType:"jsonp",data:{songId:g,from:"play"}}).done(function(i){if(i.errorCode!=22e3){if(i.errorCode==22322){e(s.$collect).tip("tipup",{msg:"歌曲已被保存",iconClass:"tip-error"});return false}var t=e('<div style="text-align: left;">您需要访问 <a target="_blank" href="http://y.baidu.com/">太合音乐人</a>平台，完成音乐收藏。</div>');t.dialog({className:"dialog-message",showBtn:true,confirm:{btn:"",close:true,callback:function(){window.open("http://y.taihe.com/song/"+r+"?buy="+r)},text:"立即去收藏"},cancel:false,destroy:true,title:"&nbsp;",width:360,showBg:true}).dialog("show")}else{e(s.$collect).tip("tipup",{msg:"已保存到我的收藏",iconClass:"tip-success"})}});return false}if(a.pay_type&&a.pay_type==="1"){var g=a.id,p=encodeURIComponent(window.location.pathname);if(/^\d+$/.test(g)){link="/song/"+g+"/collect?resource=kingfav&__o="+p}window.open(link,"","height=435,width=785,status=no,toolbar=no,menubar=no,location=no");ting.logger.plogClick("fav_music",g);return false}if(l.resourceTypeExt&&(l.resourceTypeExt==3||l.resourceTypeExt==4)){ting.checkSellResourse(l.id,l.albumId,function(e){l.isPay=e;if(l.isPay==1&&l.siPresaleFlag==0){y(l)}else{ting.media.collectSong(l.id,l)}c.song_title=l.songTitle;c.song_id=l.id;c.isPay=2});return false}else{var d=e(this);if(d.hasClass("song-collect-vip")){var u=a.id||i.options.id,f=f||"";ting.checkSellResourse(u,f,function(e){var i=e;if(BDUS&&BDUS.vipState!="gold"&&i!=1){n(d,"pay_listen")}else{y()}})}else{y()}}function y(t){if(!t){var t={isPay:""}}ting.connect.collect(null,{ids:a.id||i.options.id,type:a.type||i.options.type},function(i){e(s.$collect).tip("tipup",{msg:"已保存到我的收藏",iconClass:"tip-success"});if(ting&&ting.logger){c.state=1;ting.logger.log("collect",c)}if(ting.browser.isSpecial()){ting.browser.add2box("collect")}ting.media.collectSong(a.id)},function(i){var t="tip-error";switch(i.errorCode){case 22322:t="tip-warning";i.errTip="歌曲已被保存";break;case 22331:i.errTip="云空间已满，去<a href ='http://yinyueyun.baidu.com/' target = '_blank'>整理云空间</a>吧！";break;case 22232:i.errTip="对不起，千千音乐只能在中国内地提供服务";break;default:i.errTip="操作失败，请稍候再试";break}var o={msg:i.errTip?i.errTip:"操作失败",iconClass:t};if(i.errorCode=22331){o.showTime=5e3}if(ting&&ting.logger){c.state=i.errorCode;ting.logger.log("collect",c)}e(s.$collect).tip("tipup",o)})}return false})}if(s.$subscribe){s.$subscribe.tip();s.$subscribe.bind("click",function(t){ting.connect.collect(null,{ids:a.id||i.options.id,type:a.type||i.options.type},function(i){e(s.$subscribe).tip("tipup",{msg:"已收录",iconClass:"tip-success"});ting.media.collectSong(a.id)},function(i){if(i.errorCode=="22322"){e(s.$subscribe).tip("tipup",{msg:"该自选辑已被收录",iconClass:"tip-error"})}else{e(s.$subscribe).tip("tipup",{msg:i.errorMessage||"收录失败",iconClass:"tip-error"})}});return false})}if(s.$add){s.$add.bind("click",function(t){var s=a.type||i.options.type,c="playSong";var r={page:ting.logger.getPage(),pos:"add_song",songcount:1};switch(s){case"song":c="addSong";break;case"album":c="addAlbum";break;case"diy":c="addDiy";break;case"artist":c="addArtist";break}if(l.resourceTypeExt&&(l.resourceTypeExt==3||l.resourceTypeExt==4)){ting.checkSellResourse(l.id,l.albumId,function(e){l.isPay=e;ting.media[c](o(a.id||i.options.id),l);if(l.isPay!=1||l.siPresaleFlag==1){u("notTip")}else{u()}});r.song_title=l.songTitle;r.song_id=l.id;r.isPay=2;r.operation="click_add_icon"}else{var g=e(this);if(g.hasClass("song-add-vip")){var p=a.id||i.options.id,d=d||"";ting.checkSellResourse(p,d,function(e){var t=e;if(BDUS&&BDUS.vipState!="gold"&&t!=1){n(g,"pay_listen")}else{ting.media[c](o(a.id||i.options.id),l);u()}})}else{ting.media[c](o(a.id||i.options.id),l);u()}}function u(o){if(ting&&ting.logger&&ting.logger.plogClick){ting.logger.log("siteToBox",r);ting.logger.plogClick("add_"+s)}if(i.options.hasTip){if(o!="notTip"){e(t.target).tip().tip("tipup",{msg:"添加成功！",iconClass:"tip-success"})}}}if(ting.browser.isSpecial()){ting.browser.add2box("play")}return false})}if(s.$download){document.cookie="checkStatus=true";s.$download.bind("click",function(o){var n=e(this);l.clientUrlPos="web_danqu";var s=Number(t.data("musicicon").yyr_song_id);var c={page:ting.logger.getPage(),pos:"download_song",songcount:1};if(s){if(!ting.userInfo){ting.passport.checkLogin(function(){});return false}function r(e){var i=document.cookie,t=i.split("; ");for(var o=0;o<t.length;o++){var n=t[o].split("=");if(e==n[0]){return n[1]}}return""}if(r("checkStatus")=="true"){var g,p=e('<div style="font-size:14px; text-align: left; margin:0 0 20px 21px;">即将在&nbsp<span id="countTime"></span>秒&nbsp后为您跳转到&nbsp<a href="http://y.baidu.com/">“太合音乐人”</a>&nbsp平台，获取音乐下载。<div style="margin-top:7px; height:14px;"><input id="checkbox" type="checkbox" style="margin:0; padding:0; width:12px; height:12px; cursor:pointer;"><label for="checkbox" style="font-size:12px; color:#a0a0a0; margin-left:6px; cursor:pointer;">不再提示</label></div></div>');p.dialog({className:"dialog-message",showBtn:true,cancel:{btn:"",close:true,callback:function(){clearInterval(g);window.open("http://y.taihe.com/song/"+s+"?buy="+s)},text:"立即去下载"},destroy:true,title:"去音乐人下载",width:480,showBg:true}).dialog("show");e("#checkbox")[0].onclick=function(){document.cookie="checkStatus="+!this.checked};window.onbeforeunload=function(){document.cookie="checkStatus=true;"};function d(i){var t=i,o=e("#countTime")[0];g=setInterval(function(){o.innerHTML=--t;if(t==0){clearInterval(g);location.href="http://y.taihe.com/song/"+s+"?buy="+s}},1e3);o.innerHTML=t;e(".dialog-box .close")[0].addEventListener("click",function(){clearInterval(g)})}d(10)}else{var s=Number(t.data("musicicon").yyr_song_id);window.open("http://y.taihe.com/song/"+s+"?buy="+s)}return false}if(l.resourceTypeExt&&(l.resourceTypeExt==3||l.resourceTypeExt==4)){ting.checkSellResourse(l.id,l.albumId,function(e){l.isPay=e;ting.media.downloadSong(a.id||i.options.id,"","","",l)});c.song_title=l.songTitle;c.song_id=l.id;c.isPay=2}else{if(n.hasClass("song-down-vip")){var u=a.id||i.options.id,f=f||"";ting.checkSellResourse(u,f,function(e){var t=e;if(BDUS&&BDUS.vipState!="gold"&&t!=1){ting.media.downloadSong(a.id||i.options.id,"","","",l,t)}else{ting.media.downloadSong(a.id||i.options.id,"","","",l)}})}else{ting.media.downloadSong(a.id||i.options.id,"","","",l)}}i.log(a.id||i.options.id);if(ting&&ting.logger&&ting.logger.plogClick){ting.logger.plogClick("down_song");ting.logger.log("download",c)}return false})}if(s.$songword){s.$songword.bind("click",function(e){ting.media.lyric(a.id||i.options.id);return false})}if(s.$jump){s.$jump.bind("click",function(i){var t=e(this).data("provider");var o={page:"pcweb_music",pos:"skip_button",sub:"cooperate_"+t};ting.logger.log("click",o)})}if(s.$send){s.$send.sendByClient({songId:a.id||i.options.id}).on("click",function(e){e.preventDefault();if(l.resourceTypeExt&&(l.resourceTypeExt==3||l.resourceTypeExt==4)){ting.checkSellResourse(l.id,l.albumId,function(e){l.isPay=e;if(l.isPay!=1||l.siPresaleFlag==1){ting.media.checkToSellPage(l)}else{s.$send.sendByClient("down");ting.logger.log("click",{page:ting.logger.getPage(),pos:"to_app",songid:a.id})}})}else{s.$send.sendByClient("down");ting.logger.log("click",{page:ting.logger.getPage(),pos:"to_app",songid:a.id})}})}}});e(function(){e(".music-icon-hook").musicIcon()})})(jQuery);

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/