define(["core/utils","widget/pop_window/pop_window","widget/toast/toast","widget/upload_image/upload_image"],function(e,t,r,l){var a=$(".cut-control-tip"),i=$(".edit-list"),s=$(".column-num"),o=$(".edit-desc"),n=$(".edit-name"),d=40,c=200,u=$(".edit-list-total"),m=$(".column-title-tip"),f=$(".desc-text"),g=$(".column-edit-submit"),h=$(".edit-cover-preview"),p=[],v={status:false,errText:""},T={status:true,errText:""},b={uploadImg:{},preview:280,previewMini:160,mix:500,allowUpload:true},_="",w=true,C=true,x={};init=function(){var e=n.val().length;s.html(d-e);f.html(c-o.val().length);var t=$(".upload-image").data("initdata").url||"../../../../static2.qianqian.com/web/static/images/default/songlist_default_150.png"/*tpa=http://static2.qianqian.com/web/static/images/default/songlist_default_150.png*/||"";var r;if(e>0){r="修改封面图"}else{r="添加封面图"}x={initImageUrl:t,defaultImageUrl:"../../../../static2.qianqian.com/web/static/images/default/songlist_default_150.png"/*tpa=http://static2.qianqian.com/web/static/images/default/songlist_default_150.png*/,editBtnText:r,width:240,left:660,top:35,tips:"支持 jpg  png  gif 格式，建议尺寸大于500＊500，文件小于10M"};l.create(x)};loadToastTmpl=function(e,t,l){r.show({innerSelect:".toast-tmpl",data:{cls:e,text:t},callback:l})};o.keyup(function(){checkcolumnDesc()});o.focus(function(){$(this).attr("placeholder","")});o.blur(function(){checkcolumnDesc()});checkcolumnDesc=function(){var e=o;var t=e.val();if(t.length>c){e.addClass("red-border");f.html(c-t.length).addClass("c-red");T.status=false;T.errText="专栏简介不能超过200字"}else{T.status=true;e.removeClass("red-border");f.html(c-t.length).removeClass("c-red")}};n.keyup(function(){var e=n.val();if(e.length>d){n.addClass("red-border");s.html(d-e.length);n.addClass("red-border");m.html("专栏名需在 "+d+" 个字以内");v.status=false;v.errText="专栏名需在 "+d+" 个字以内"}else{n.removeClass("red-border");s.html(d-e.length);n.removeClass("red-border");m.html("");v.status=true}});n.blur(function(){checkcolumnTitle()});checkcolumnTitle=function(){var e=n.val();if(!e||$.trim(e)==""){n.addClass("red-border");m.html("专栏名不能为空");v.status=false;v.errText="专栏名不能为空";return false}if(e.length>d){n.addClass("red-border");s.html(d-e.length);n.addClass("red-border");m.html("专栏名需在 "+d+" 个字以内");v.status=false;v.errText="专栏名需在 "+d+" 个字以内"}else{n.removeClass("red-border");s.html(d-e.length);n.removeClass("red-border");m.html("");v.status=true}};n.focus(function(){m.html("");n.removeClass("red-border")});g.click(function(){var t=$(this);var r=t.data("columnid");var l="";checkcolumnTitle();if(!v.status){v.errText=v.errText?v.errText:"专栏名不能为空";loadToastTmpl("fail",v.errText);return false}if(!T.status){loadToastTmpl("fail",T.errText);return false}if(r){l="baidu.ting.ugccolumn.upColumn"}else{l="baidu.ting.ugccolumn.addColumn"}var a={column_title:n.val(),column_content:o.val(),columnid:r};var i=$(".edit-cover-preview");if(x.defaultImageUrl!==i.attr("src")){a.column_pic=i.attr("src")}if(h.attr("src")!==h.attr("data-initpic")){a.column_pic=h.attr("src")}e.tingApi(l,a).done(function(e){if(e.error_code==22e3){loadToastTmpl("succ","保存成功!");var t=setTimeout(function(){window.location.href="http://static1.qianqian.com/column/manage"},1500)}}).fail(function(e){var t="";if(e.error_code==22231){if(e.error_msg=="title"){t="专栏名称含有敏感内容!";m.html("专栏名称含有敏感内容，换一个吧");n.addClass("red-border")}if(e.error_msg=="desc"){t="专栏简介含有敏感内容!"}t="内容含有敏感内容!"}else{t="专栏信息保存失败!"}loadToastTmpl("fail",t)})});init()});

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/