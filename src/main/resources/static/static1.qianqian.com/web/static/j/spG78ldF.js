define(["core/utils","tmpl/dynamic/addFriendTmpl","tmpl/dynamic/addFriendStarTmpl","tmpl/dynamic/addFriendWeiboTmpl","tmpl/dynamic/addFriendWeiboVisitTmpl","widget/toast/toast","widget/pop_window/pop_window","bind/sina","page/uuser/friend"],function(i,e,n,d,a,t,o,s,r){var l={},f=$(".music-body"),c={},u=0,b="artist",g=function(){addFriendPop=o.create({title:"添加好友",closeCallback:function(){window.location.reload();return true}});o.hide(addFriendPop)},p=function(d){$(".add-friend-inside").html("").addClass("loading");i.tingApi("baidu.ting.recommend.getRecUserList",{size:50,rectype:d||0,is_random:0}).done(function(i){if(i&&i.result.userList){$(".add-friend-nav a").removeClass("add-friend-active");if(d==1){$(".add-friend-inside").append(e({list:i.result.userList})).removeClass("loading");$(".add-friend-daren").addClass("add-friend-active")}else{$(".add-friend-inside").append(n({list:i.result.userList})).removeClass("loading");$(".add-friend-star").addClass("add-friend-active")}o.setContent(addFriendPop,$(".add-friend-box").show())}o.show(addFriendPop);r.bindEvent()}).fail(function(){o.show(addFriendPop);w("fail","没有获取到数据，请重试")})},w=function(i,e,n){t.show({innerSelect:".toast-tmpl",data:{cls:i,text:e},callback:n})},m=function(){if(ting&&ting.userInfo){var e=ting.userInfo.nickName}u=0;$(".add-friend-inside").html("").addClass("loading");i.tingApi("baidu.ting.ugccenter.getUserBaseInfo",{nickname:e,withcount:0}).done(function(i){if(i&&i.result&&i.result.weibo_info.weibo_flag==1){l=i.result.weibo_info;v()}else if(i&&i.result&&i.result.weibo_info.weibo_flag==0){l=i.result.weibo_info;$(".add-friend-inside").removeClass("loading").append('<div class="tobind-weibo"><img src="../../../../static0.qianqian.com/web/static/i/54QgaLUN.png"/*tpa=http://static0.qianqian.com/web/static/i/54QgaLUN.png*/ alt="" /><a href="http://static1.qianqian.com/user/bind" target="_blank" class="bind-weibo-btn">绑定微博</a></div>')}$(".add-friend-nav a").removeClass("add-friend-active");$(".add-friend-weibo").addClass("add-friend-active")}).fail(function(){$(".add-friend-inside").removeClass("loading");w("fail","获取用户信息失败，请重试")})},v=function(){if(!(l.weiboid&&l.weibotoken)){return false}$(".add-friend-inside").html("");i.tingApi("baidu.ting.ugccenter.matchUserWeibo",{weiboid:l.weiboid,access_token:l.weibotoken}).done(function(i){if(i&&i.result){if(i.result.exist_telno_info){$(".add-friend-inside").append(d({list:i.result.exist_telno_info}))}if(i.result.nonexist_telno_info){visitWeiboFriend=i.result.nonexist_telno_info;_()}$(".add-friend-nav a").removeClass("add-friend-active");$(".add-friend-weibo").addClass("add-friend-active");r.bindEvent()}$(".add-friend-inside").removeClass("loading")}).fail(function(){$(".add-friend-inside").removeClass("loading").append('<span class="add-friend-weibo-fail">匹配失败，<a href="javascript:void()" class="add-friend-weibo-fail-btn">再试一次</a></span>')})},h=function(){totalheight=parseFloat($(".add-friend-inside").height()+$(".add-friend-inside").scrollTop());if($(".add-friend-inside")[0].scrollHeight-100<=totalheight){$(".add-friend-inside").unbind("scroll");_()}},_=function(){if(u>=visitWeiboFriend.length){return false}else if(u>=0){u=u+20}c=visitWeiboFriend.slice(u-20,u);$(".add-friend-inside").append(a({list:c}));$(".visit-list .visit-weibo-friend").each(function(i){var e=$(this);s.weiboPublish(e.data("weiboid"),e.data("weibonick"))});$(".add-friend-inside").bind("scroll",function(){h()})};f.on("click",".add-friend-star",function(){p(0);b="artist"}).on("click",".add-friend-daren",function(){p(1);b="user"}).on("click",".add-friend-weibo",function(){m();b="friend"}).on("click",".add-friend-weibo-fail-btn",function(){m()}).on("click",".bind-weibo-btn",function(){window.location.reload()}).on("click",".add-friend-box .follow-hook",function(){if(ting&&ting.logger){ting.logger.log("click",{page:"dynamicmainpage",pos:$(".add-friend-box").data("addfriendtype")||"frommore",sub:b})}}).on("click",".recomment-user .follow-hook",function(){if(ting&&ting.logger){ting.logger.log("click",{page:"friendrecom",pos:"dianji"})}});g();return{getDaren:function(i){p(i)}}});

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/