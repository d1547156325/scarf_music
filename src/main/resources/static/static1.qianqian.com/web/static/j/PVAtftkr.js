define(["core/utils","widget/pop_window/pop_window","widget/toast/toast","widget/upload_image/upload_image"],function(e,t,i,a){var s=$(".spec-save"),l=$(".spec-preview"),c=$(".spec-publish"),r=$(".save-tip"),o=$("#editor"),n=o.data("specid")||0,d=o.data("columnid")||0,p=0,u=0,f="",g=false;var m=function(){editor=new BME.Editor("editor",editor_config);if(n){g=true;var t={specialid:n};e.tingApi("baidu.ting.ugcspecial.getSpecialInfo",t).done(function(e){if(e.error_code==22e3&&e.result){u=e.result.specialInfo&&e.result.specialInfo.status;if(u){clearInterval(f);r.html('<strong class="tip-time" style="font-style:normal;" >该专题已发布在线，请编辑、预览后手动点击保存或发布</strong> ').removeClass("save-tip-error")}editor.setTitle(e.result.specialInfo.special_title);try{editor.setContent(decodeURIComponent(e.result.specialInfo.special_content))}catch(t){editor.setContent(e.result.specialInfo.special_content)}$(".submit-box").show()}}).fail(function(){w("fail","没有获取到专题信息，请重试!")});_()}else{g=false;$(".submit-box").show();b()}$("#editor .title input").addClass("spec-title");$(".spec-left-bg").show();$(".spec-edit-loading").hide();$("#editor").on("keyup",".spec-title",function(){if($(this).val().length>0&&!g){_()}else{}});var i=$(".upload-image").data("initdata").url||"../../../../static2.qianqian.com/web/static/images/default/songlist_default_150.png"/*tpa=http://static2.qianqian.com/web/static/images/default/songlist_default_150.png*/||"";var s=n?"修改封面图":"添加封面图";columnOptions={initImageUrl:i,defaultImageUrl:"../../../../static2.qianqian.com/web/static/images/default/songlist_default_150.png"/*tpa=http://static2.qianqian.com/web/static/images/default/songlist_default_150.png*/,editBtnText:s,width:120,left:0,top:0,tips:"支持 jpg  png  gif 格式，建议尺寸大于500＊500，文件小于10M"};a.create(columnOptions);f=setInterval(function(){h({saveType:"auto"})},1e4)},v=function(){if(editor.getTitle().length==0){w("fail","专题名称不能为空");return false}editor.preview()},b=function(){g=false;s.addClass("spec-save-disable");l.addClass("spec-preview-disable");c.addClass("spec-publish-disable");s.off("click");c.off("click");l.off("click")},_=function(){g=true;s.removeClass("spec-save-disable");l.removeClass("spec-preview-disable");c.removeClass("spec-publish-disable");s.on("click",h);c.on("click",h);l.on("click",v)},w=function(e,t,a){i.show({innerSelect:".toast-tmpl",data:{cls:e,text:t},callback:a})},h=function(t){var i=t||{};var a=$(this),s=window.editor||{},l="";if(!s){return false}var c=s.getContent();c=c.replace(/<!-[.\s\S]*?-->/g,"");var o={columnid:d,special_title:s.getTitle(),special_content:encodeURIComponent(c),msg_users:"",status:p};if(o.special_title.length>40){w("fail","专题名称需要在40个字符以内哦");return false}if(o.special_title.length==0){w("fail","专题名称不能为空");return false}var g=$(".edit-cover-preview");if(columnOptions.defaultImageUrl!==g.attr("src")){o.special_pic=g.attr("src")}if(a.data("status")||u){p=o.status=a.data("status")||u}if(n){o.specialid=n;l="baidu.ting.ugcspecial.upSpecial"}else{l="baidu.ting.ugcspecial.addSpecial"}e.tingApi(l,o,{type:"POST"}).done(function(e){if(e.error_code==22e3){if(e.specialid){n=e.specialid}if(o.status){if(i&&i.saveType!=="auto"){w("succ","发布成功!");clearInterval(f);r.html('<strong class="tip-time" style="font-style:normal;">该专题已发布在线，请编辑、预览后手动点击保存或发布</strong> ').removeClass("save-tip-error")}$.ajax({url:"/h5pc/spec_detail?id="+o.specialid+"&columnid="+o.columnid+"&dotype=2",type:"GET",timeout:3e4,success:function(e){if(e){var e=JSON.parse(e);if(e.error=="22002"){}else{}}}});var t=setTimeout(function(){window.open("/h5pc/spec_detail?id="+n+"&columnid="+d)},1500)}else{var a="";if(i&&i.saveType!=="auto"){w("succ","保存成功!")}else{a="自动"}r.html('今天 <em class="tip-time">'+k()+"</em> "+a+"保存成功").removeClass("save-tip-error")}}}).fail(function(e){if(o.status){var t="发布失败"}else{if(i&&i.saveType==="auto"){clearInterval(f)}else{var t="保存失败"}}switch(e.error_code){case 22231:if(e&&e.filter_word){t=e.filter_word+" 为敏感内容，换一个吧"};break;case 22001:t="操作失败";break;case 22005:t="数据异常";break;case 22009:t="无权限操作";break;case 22231:t="内容含有黄反或敏感信息，请审查";break;case 22716:t="用户被封禁，没有权限";break;case 22903:t="没找到这个专题";break;case 23113:case 23115:t="字数超限，请重新编辑";break;case 23114:t="标题重复，请确认";break;case 22452:t="还没有登录哦";break;case 22716:t="你的账户被封禁，请联系客服处理！";break;default:t="操作失败，请稍后重试!";break}w("fail",t);r.html('错误信息： <em class="tip-time">'+k()+"</em> "+t+", 联系管理员").addClass("save-tip-error")})},k=function(){var e=new Date;var t=e.getHours();var i=Number(e.getMinutes())>9?e.getMinutes():"0"+e.getMinutes();var a=Number(e.getSeconds())>9?e.getSeconds():"0"+e.getSeconds();return t+":"+i+":"+a};m()});

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/