(function(t,e){t.widget("ting.tab",{options:{tabList:".tab-list li",contentList:".ui-tab-content",tabActiveClass:"ui-tab-active",eventType:"click",eventOut:"mouseout",showType:"show",showSpeed:200,callBackStartEvent:null,callBackHideEvent:null,callBackShowEvent:null,delay:null},_create:function(){this.index=0},_switchTab:function(e){var i=this,n=i.options;$me=i.element;t(n.tabList+"."+n.tabActiveClass,$me).removeClass(n.tabActiveClass);e.self.addClass(n.tabActiveClass);i._showContent(e.index);if(ting&&ting.logger&&ting.logger.plogClick){ting.logger.setSub(e.index);ting.logger.plogClick("tab")}},_init:function(){var e=this,i=e.options,n=e.element;e.widgetEventPrefix="tab.",e.disableArr=[],$me=e.element;if(t(i.tabList,$me).length>0){t(i.tabList,$me).each(function(n){var o=null;t(this).bind(i.eventType,function(){var a=t(i.tabList+"."+i.tabActiveClass,$me).index()||0;e.index=n;var s={self:t(this),index:n,oldIndex:a},r=s.self.attr("class")?s.self.attr("class"):"";if(t.inArray(s.index,e.disableArr)==-1&&r.indexOf(i.tabActiveClass)==-1){if(i.callBackStartEvent){i.callBackStartEvent(s.index,$me,a)}if(i.eventType=="mouseover"){if(i.delay){o=setTimeout(function(){e._switchTab(s)},i.delay)}else{e._switchTab(s)}}else{e._switchTab(s)}}return false});if(i.eventOut&&i.eventType=="mouseover"&&i.delay){t(this).bind(i.eventOut,function(){clearTimeout(o)})}})}},_showContent:function(e){var i=this,n=i.options;$me=i.element;switch(n.showType){case"show":t(n.contentList+":visible",$me).stop(true,true).hide();if(n.callBackHideEvent){n.callBackHideEvent(e)}t(n.contentList,$me).eq(e).stop(true,true).show();if(n.callBackShowEvent){n.callBackShowEvent(e)}break;case"fade":t(n.contentList+":visible",$me).stop(true,true).fadeOut(n.showSpeed,function(){if(n.callBackHideEvent){n.callBackHideEvent(e)}t(n.contentList,$me).eq(e).stop(true,true).fadeIn(function(){if(n.callBackShowEvent){n.callBackShowEvent(e)}})});break;case"slide":t(n.contentList+":visible",$me).stop(true,true).slideUp(n.showSpeed,function(){if(n.callBackHideEvent){n.callBackHideEvent(e)}t(n.contentList,$me).eq(e).stop(true,true).slideDown(function(){if(n.callBackShowEvent){n.callBackShowEvent(e)}})});break}},triggleTab:function(e){var i=this,n=i.options,o=i.element;t(n.tabList,o).eq(e).trigger(n.eventType)},getIndex:function(){return this.index},_bindEvent:function(){},destroy:function(){}})})(jQuery);(function(){var t=$(".lossell-wrap").data("page");$(".lossell-wrap .lossell-list li").each(function(){$(this).live("click",function(){ting.logger.log("click",{page:t,pos:"songlist_link"})})});var e=0,i=false;$("#updateLosssell").bind("click",function(){var t=$(".lossell-list"),n=$(".lossell-list:visible");n.hide();++e;if(e>=t.length){e=0;i=true}$(t[e]).show();return false})})();(function($,undefined){var supportCanvas="getContext"in document.createElement("canvas");var focusID="#focus-hook";var _NEXT=_ul=0;var PREV=NEXT=INDEX=LEN=0;var autoMove,keepMove,hoverDelay,isRotate=false,needTrans=false,_this;$.widget("ting.anyfocus",{options:{effect:"z3d|slide|y3d|x3d",speed:"1000",delay:"1000",interTime:"3000",callback:function(){}},_create:function(){this.prevBtn=$(".prev , .page-prev",focusID);this.nextBtn=$(".next , .page-next",focusID);this.arrow=$(".arrow",focusID);this.list=$("li",focusID);this.ul=$("ul.list",focusID);this.loading=$(".loading",focusID);this.listW=this.list.outerWidth();_this=this;_this.widgetEventPrefix="anyfocus.";this.prevBtn.click(function(t){if(_this.sliding)return false;_this.Event=t;_this.stop();_this._prev("slide");_this._run();return false});this.nextBtn.click(function(t){if(_this.sliding)return false;_this.Event=t;_this.stop();_this._next("slide");_this._run();return false});if(needTrans){$(".arrowp").hover(function(){var t=$(this).hasClass("prevp")?_this.nextBtn:_this.prevBtn;hoverDelay=setTimeout(function(){if($.browser.webkit){t.removeClass("rerotate").addClass("rotate")}else{_this._trans(t,180)}isRotate=true},300)},function(){var t=$(this).hasClass("prevp")?_this.nextBtn:_this.prevBtn;clearTimeout(hoverDelay);if(isRotate){if($.browser.webkit){t.removeClass("rotate").addClass("rerotate")}else{_this._trans(t,-180)}isRotate=false}})}_this.ul.css({width:_this.listW*3,left:-_this.listW});_this.list.css({left:_this.listW});_this.loading.hide();this.options.callback&&this.options.callback();_this.list.eq(0).css("display","block")},_init:function(){LEN=_this.list.size();if(LEN<2)return false;_this.list.hover(function(){_this.stop()},function(){_this._run()});var t=end=now=0;_this._run()},_switch:function(t,e){if(LEN<2)return false;var i=this;var n=i.list.eq(NEXT);var o=i.list.eq(PREV);var a=i.list.eq(INDEX);var s=this.options.effect.split("|");var r=null;var l=$("img",n),c=this.listW;org_src=l.attr("org_src");if(org_src){l.attr("src",org_src);l.removeAttr("org_src")}if(t=="slide"){r="slide"}else{r=s[Math.ceil(10*Math.random()%s.length)-1]||"slide"}if(r=="fade"){n.fadeIn("slow");ting.LL.add($(".lazyload",n));o.fadeOut()}else if(r=="x3d"&&$.browser.webkit){n.fadeIn("slow");o.addClass("x3d").fadeOut("slow",function(){o.removeClass("x3d")})}else if(r=="y3d"&&$.browser.webkit){n.fadeIn("slow");o.addClass("y3d").fadeOut("slow",function(){o.removeClass("y3d")})}else if(r=="z3d"&&$.browser.webkit){n.fadeIn("slow");o.addClass("z3d").fadeOut("slow",function(){o.removeClass("z3d")})}else if(r=="z3dzoom"&&$.browser.webkit){n.addClass("z3dzoom").fadeIn("slow",function(){o.fadeOut("slow",function(){n.removeClass("z3dzoom")})})}else if(supportCanvas&&r=="mosaic"){var u=[9,5,8,6,1,2,7,3,4];$(focusID).append('<canvas id="canvas" height="230" width="'+c+'">');$(focusID).append('<canvas id="canvas-mask" height="230" width="'+c+'">');var p=document.getElementById("canvas").getContext("2d");var d=document.getElementById("canvas-mask").getContext("2d");d.clearRect(0,0,i.listW,230);var f=new Image;f.src=$("img:first",o).attr("src");d.drawImage(f,0,0,i.listW,230);var h=new Image;h.src=$("img:first",n).attr("src");p.drawImage(h,0,0,i.listW,230);var g=3;var m=i.listW/g;var v=230/g;for(var y in u){d.clearRect((u[y]-1)%g*m,Math.floor((u[y]-1)/g)*v,m,v)}}else if(r=="bounce"){n.css({left:_NEXT,display:"block"});var w=0,b=-c,_=_ul+c,x=90;var k=function(){ul.css({left:Math.ceil(i._easeOutb(w,b,_,x))});if(w<x){w++;var t=setTimeout(function(){k()},10)}else{ul.css({left:-c});n.css({left:c,zIndex:10});o.css({left:c,display:"none",zIndex:0})}};k()}else{n.css({left:_NEXT,display:"block"});ting.LL.add($(".lazyload",n));i.sliding=true;i.ul.animate({left:_ul},i.options.speed,"swing",function(){i.ul.css({left:-c});n.css({left:c,zIndex:10});o.css({left:c,display:"none",zIndex:0});i.sliding=false})}i._trigger("runafter",i.Event,{index:INDEX});return false},_next:function(t){NEXT=INDEX+1;PREV=INDEX;NEXT=LEN===NEXT?0:NEXT;INDEX=NEXT;_NEXT=this.listW*2;_ul=-_NEXT;_this._switch(t);return false},switchTo:function(t,e){NEXT=t;PREV=INDEX;NEXT=LEN===NEXT?0:NEXT;INDEX=NEXT;_NEXT=this.listW*2;_ul=-_NEXT;_this._switch(e);_this._run();return false},_prev:function(t){NEXT=INDEX-1;PREV=INDEX;NEXT=-1===NEXT?LEN-1:NEXT;_NEXT=_ul=0;INDEX=NEXT;_this._switch(t);return false},stop:function(){clearInterval(autoMove);clearTimeout(keepMove)},_run:function(){var t=this;keepMove=setTimeout(function(){autoMove=setInterval(function(){t._next("slide")},t.options.interTime)},t.options.delay)},_trans:function(elem,deg){var tranMove,i=_sin=_cos=0,setFilter=false;var elem=document.getElementById(elem.attr("id"));var width=elem.clientWidth,height=elem.clientHeight;clearInterval(tranMove);var tran=function(angle){if($.browser.msie){if(!setFilter){elem.style.filter='progid:DXImageTransform.Microsoft.Matrix(sizingmethod="auto expand")';setFilter=true}_cos=Math.cos(angle*Math.PI/180);_sin=Math.sin(angle*Math.PI/180);with(elem.filters.item(0)){M11=M22=_cos;M12=-(M21=_sin)}elem.style.top=(height-elem.offsetHeight)/2+104+"px";if($(elem).attr("id")=="prev")elem.style.left=(width-elem.offsetWidth)/2+5+"px";else elem.style.left=(width-elem.offsetWidth)/2+78+"px"}else{$(elem).css({"-moz-transform":"rotate("+angle+"deg)","-o-transform":"rotate("+angle+"deg)"})}};tranMove=setInterval(function(){if(deg>0){i+=15;tran(i)}else if(deg<0){deg+=15;tran(Math.abs(deg))}if(deg>0&&i>deg-1||deg==0&&deg<0){i=0;clearInterval(tranMove)}},25)},_easeOutb:function(t,e,i,n){if((t/=n)<1/2.75){return i*(7.5625*t*t)+e}else if(t<2/2.75){return i*(7.5625*(t-=1.5/2.75)*t+.75)+e}else if(t<2.5/2.75){return i*(7.5625*(t-=2.25/2.75)*t+.9375)+e}else{return i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}},_easeOutc:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},_easeOutq:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},_inArray:function(t,e,i){var n="",i=!!i;if(i){for(n in e)if(e[n]===t)return true}else{for(n in e)if(e[n]==t)return true}return false},destroy:function(){_this.prevBtn.unbind("click");_this.nextBtn.unbind("click");$.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);(function(t,e){t.widget("ting.roll",{options:{total:null,rollNum:0,screen:".page-list-wrap",rollList:".page-list",leftBtn:".page-prev",leftBtnDown:"page-prev-click",rightBtn:".page-next",rightBtnDown:"page-next-click",pageNav:".page-index",pageActive:".page-active",singleWidth:null,speed:"slow",callBack:function(){}},_create:function(){var e=this,i=e.options,n=e.element;e.widgetEventPrefix="roll.";e.rollInner=t(i.screen,n);e.rollList=t(i.rollList,n);e.leftBtn=t(i.leftBtn,n);e.rightBtn=t(i.rightBtn,n);e.itemNum=i.rollNum?Math.ceil(e.rollList.children().length/i.rollNum):e.rollList.children().length;e.rollLength=e.rollInner.width();e.pageNav=t(i.pageNav,n);e.containNum=i.singleWidth?Math.ceil(e.rollLength/i.singleWidth):1;e.currentNum=e.containNum;e.rolling=false;i.callBack(e);e.bindEvent()},ajaxload:function(){var e=this,i=e.options,n=e.element;var o={};o.start=t("li",e.rollList).length;o.size=15;t.get(i.ajaxUrl,o,function(i){var n=e.rollList.append(i.data.html);e.itemNum=t("li",e.rollList).length;new Function(i.data.js).call(n)},"json")},bindEvent:function(){var e=this,i=e.options,n=e.element,o=0,a={};t(i.leftBtn+","+i.rightBtn+","+i.pageNav,n).bind("click",function(s){if(e.rolling)return false;var r=0;var l=t(s.currentTarget).hasClass(i.pageNav.substr(1));var c=e.pageNav.index(t(s.target));if(s.currentTarget==e.leftBtn[0]){r=1;if(e.currentNum==e.containNum){return false}}else if(s.currentTarget==e.rightBtn[0]){r=-1;if(e.currentNum>=e.itemNum){return false}}else if(l){r=e.currentNum-1-c}e.rolling=true;o=l?-1*e.pageNav.index(t(s.target))*e.rollLength:r*e.rollLength;if(e.containNum>1&&i.singleWidth){if(e.itemNum-e.currentNum<e.containNum&&r<0||2*e.containNum>e.currentNum&&r>0){r=r*(e.itemNum%e.containNum)}else{r=r*e.containNum}o=r*i.singleWidth}a=l?{opacity:"hide"}:{left:"+="+o+"px"};e.rollList.animate(a,i.speed,function(){e.rolling=false;if(l){t(this).css({left:o+"px"}).show()}if(i.total&&i.ajaxUrl){if(e.currentNum>=e.itemNum&&e.itemNum<i.total){e.ajaxload()}}e.currentNum-=r;ting.LL.add(t(".lazyload",e.rollList.children()[e.currentNum-1]));if(t(i.pageNav,n).length){t(i.pageActive,n).removeClass(i.pageActive.substr(1));t(t(i.pageNav,n)[e.currentNum-1]).addClass(i.pageActive.substr(1))}});return false})}})})(jQuery);void function(t){t.widget("ting.albumCover",{options:{albumId:null},_create:function(){var e=this,i=e.element;var n=e.options;t(".play-icon",i).bind("click",function(o){if(t(this).find(".play-all").hasClass("play-all-disabled")){return}if(t(this).find("a").hasClass("play-all")){if(!e.albumAllSongState(i)){return}}var a=i;var s=i.data("albumdata"),r=s.id,l={moduleName:s.moduleName,searchValue:s.searchValue||"",mediaType:2,albumId:s.id||"",_aiPresaleFlag:s._aiPresaleFlag||"",resourceTypeExt:s.resourceTypeExt||"",albumPic:s.albumPic||"",albumTitle:s.albumTitle||"",albumPublishTime:s.albumPublishTime||""};var c=s.playIDs||"";var u=s.playFeeIDs||"";var p=c.length||0;var d=u.length||0;var f=s.ids||"";var c=s.playIDs||"";a.tip();var h={page:ting.logger.getPage(),pos:"play_album"};if(r||n.albumId){if(i.data("source")==="m"){if(!l.resourceTypeExt){t.when(t.ajax({type:"POST",dataType:"json",async:false,url:"/data/album/info?id="+l.albumId,data:""})).done(function(t){var e=t.data[l.albumId];l.resourceTypeExt=e.resource_type_ext;l.albumTitle=e.title;l.albumPic=e.pic_s180;g()})}else{g()}function g(){if(l.resourceTypeExt&&(l.resourceTypeExt==3||l.resourceTypeExt==4)){ting.checkSellResourse(l.id,l.albumId,function(t,e){l.isPay=e;ting.media.playAlbum(r||l.albumId,l);if(l.isPay!=1||l.siPresaleFlag==1||l._aiPresaleFlag==1){m("notTip")}else{}});h.album_title=l.albumTitle;h.album_id=l.albumId;h.isPay=3}else if(BDUS&&BDUS.vipState!="gold"){ting.checkSellResourse("",l.albumId,function(t,e){l.isPay=e;if(l.isPay!=1){if(p){if(d){ting.media.playSong(c,l);a.tip("tipup",{msg:"已自动过滤付费歌曲",iconClass:"tip-success"})}else{ting.media.playAlbum(r||l.albumId,l);a.tip("tipup",{msg:"已开始播放！",iconClass:"tip-success"})}}else{if(d){v(a,"pay_listen")}else{a.tip("tipup",{msg:"已开始播放！",iconClass:"tip-success"});ting.media.playAlbum(r||l.albumId,l)}}}else{ting.media.playAlbum(r||l.albumId,l);a.tip("tipup",{msg:"已开始播放！",iconClass:"tip-success"})}})}else{ting.media.playAlbum(r||l.albumId,l);m()}}}else{ting.media.playSong(s.songid,l);m()}function m(e){if(e=="notTip"){return false}t(o.target).tip().tip("tipup",{msg:"已开始播放",iconClass:"tip-success"})}var v=function(t,e){ting.showTip({$tar:t,type:"needgoldvip",cancelEvent:"blur",reason:e})};if(ting&&ting.logger&&ting.logger.plogClick){ting.logger.plogClick("play_album");ting.logger.log("play_album",h)}if(ting.browser.isSpecial()){ting.browser.add2box("play")}}});t(i).bind({mouseover:function(){i.find(".cover-layer").show()},mouseout:function(){i.find(".cover-layer").hide()}})},albumAllSongState:function(e){var i=0,n=0;if(t(".mod-song-info").length){i=t(e).parents(".mod-song-info").find(".song-item-hook").length;n=t(e).parents(".mod-song-info").find(".song-message-gray").length}if(i==n&&i!=0&&n!=0){require(["tmpl/common/pop_window/pop_cantNoMv"],function(e){var i=t("#pop-hui");i.html(e("因为版权保护问题这张专辑暂时无法播放，"));i.removeClass("pop-hui-dis")});return false}else{return true}}})}(jQuery);void function(t,e){t.widget("ting.commentItem",{options:{postId:0,userName:null,isMusician:false,userAvatar:null,userUrl:null,content:null,time:null,isPrivate:false,showDelete:false,template:'<div class="comment-item-block"><div class="comment-avatar-link"><span class="cover-img"><img class=" comment-avatar lazyload" src="//static4.qianqian.com/web/static/i/RwWwsrLV.gif" org_src="#{avatar|escape}" alt="#{name|escape}" /></span></div><div class="comment-item-main"><h6 class="comment-title clearfix"><span class="comment-time c9">#{time|escape}</span>#{name|escape}#{musician}<a class="comment-title-vip comment-vip-#{vip}" href="/home/vip/" target="_blank"></a></h6><div class="comment-content-panel"><div class="comment-btn-panel"><a class="comment-delete-btn comment-delete-hook" href="#"></a></div><p class="comment-content">#{content|escape|strip|nl2br}</p></div></div><div class="clearfix"></div></div><div class="module-dotted"></div>'},_create:function(){var e=this,i=e.element,n=e.options;e.widgetEventPrefix="commentitem.";i.append(t(t.filterFormat(n.template,{url:n.userUrl,avatar:n.userAvatar,content:n.content,time:n.time,name:n.userName?n.userName:"千千网友",vip:n.vip?n.vip:"normal",musician:n.isMusician?'<span class="icon-musician" title="歌手"></span>':""})))},_init:function(){var e=this,i=e.element,n=e.options;e.$deleteBtn=t(".comment-delete-hook",i);e.$replyBtn=t(".comment-reply-hook",i);if(n.showDelete){e.$deleteBtn.css("visibility","visible").tip({msg:"你确定要删除？",button:true}).click(function(){t(this).tip("tipup");return false}).bind("tip.confirm",function(){if(false!==e._trigger("befordelete",null,{postId:n.postId})){i.animate({height:"hide",opacity:"hide",paddingTop:"0px",paddingBottom:"0px"},"slow",function(){i.remove();e._trigger("afterdelete",null,{});e.destroy()})}})}e.$replyBtn.click(function(t){e._trigger("reply",null,{postId:n.postId,userName:n.userName});return false})}})}(jQuery);void function(t,e){var i=0,n=0;function o(){return i++}t.widget("ting.comment",{options:{inputHook:".comment-input-hook",submitHook:".comment-submit-hook",listHook:".comment-list-hook",promptHook:".comment-prompt-hook",blankString:"",loadingString:"",subjectId:null,subjectType:null,emptyMsg:null,postId:null,showDelete:false,pageSize:20,start:0,data:null,maxLength:500,bytePromptTpl:"已超出<strong>#{maxLength}</strong>个字",emptyPromptTpl:"留言内容不能为空",errorClass:"comment-error"},_create:function(){var t=this,e=t.element,i=t.options;t.widgetEventPrefix="comment.";t.$input=e.find(i.inputHook);t.$submit=e.find(i.submitHook).button();t.$list=e.find(i.listHook);t.$prompt=e.find(i.promptHook);t.blankString=t.$input.val()||i.blankString;t.loadingString=t.$list.html()||i.loadingString;t.pageSize=i.pageSize;t.pageNumber=i.pageNumber;t.inputReadonly=false;t.replyId=0;t.replyPre=null;t.start=0;t.counter=0},_init:function(){var t=this,e=t.options;t._initState();t._initEvent();t._initEventHandler();e.data?t._render(e.data):t.load(t.options.start)},readonly:function(t){if(t===e){return this.inputReadonly}else{this.inputReadonly=!!t;this.$submit.button(t?"disable":"enable");t?this.$input.attr("disabled","disabled"):this.$input.removeAttr("disabled")}},inputContent:function(i){if(i===e){return this.inputInitialized?this.$input.val():""}else{if(t.trim(i)){this.inputInitialized=true;this.$input.val(String(i))}else{this.inputInitialized=false;this.$input.val(this.blankString)}}},submit:function(i){var o=this,a=o.options;if(window.BDUS.status=="1"){t.ting.popup.messageFailed("您已被限制评论，如有任何问题，欢迎发送邮件到th_musichelp@taihe.com",3e3);return}if(i===e){i=this.inputContent()}i=String(i);if(o.readonly()||false===o._trigger("beforsubmit",null,{text:i})){o._trigger("submitfail",null,{text:i});return}o.readonly(true);ting.connect.addComment(null,t.extend({subjectId:a.subjectId,subjectType:a.subjectType,content:i},o.replyPre&&i.substr(0,o.replyPre.length)==o.replyPre?{replyId:o.replyId}:{}),function(t){setTimeout(function(){o.load(0);o.inputContent("");o.$input.blur()},n);o.replyId=0;o.replyPre=null;o._trigger("submitsuccess",null,null)},function(e){t.ting.popup.messageFailed(e.errorMessage);o.readonly(false);o._trigger("submitfail",null,null)},function(){o.readonly(false)})},reply:function(e,i){var n=this;n.inputContent("");n.$input.focus();n.inputContent(n.replyPre=t.format("回复#{name}：",{name:i}));n.replyId=e},_render:function(e){var i=this,n=i.options,o=e.length;i.$list.empty();t.each(e,function(e,a){a.showDelete=n.showDelete;i.$list.append(t('<li class="comment-item'+(e==o-1?" last-item":"")+'"></li>').commentItem(a).bind("commentitem.reply",function(t,e){i.reply(e.postId,e.userName)}).bind("commentitem.befordelete",function(e,o){ting.connect.deleteComment(null,{subjectId:n.subjectId,subjectType:n.subjectType,postId:o.postId},function(t){return function(e){t.commentItem("destroy").remove();if(!--i.counter){i._loaddelay(i.start)}}}(t(this)),function(e){t.ting.popup.messageFailed(e.errorMessage)});return false}))})},_loaddelay:function(t){var e=this;setTimeout(function(){e.load(t)},n)},load:function(t){var e=this,i=e.options;t=t||0;e.readonly(true);ting.connect.getCommentList({subjectId:i.subjectId,subjectType:i.subjectType,start:t,size:i.pageSize},null,function(n){size=i.pageSize;if(n.data.replyList.length){e._render(n.data.replyList);e.readonly(false);e._trigger("loadsuccess",null,{total:n.data.total,start:t,size:i.pageSize})}else if(t>0){e.load(Math.max(t-size,0))}else{e.readonly(false);e._trigger("loadsuccess",null,{total:0,start:0,size:i.pageSize})}},function(t){e.readonly(false);e._trigger("loadfail",null,null)})},_initState:function(){var t=this;t.inputContent("")},setInputColor:function(e){t(this.$input).css("color",e)},_initEvent:function(){var e=this;e.$input.bind("propertychange input",function(){var t=0;return function(){var i;if(e.inputInitialized){i=this.value;clearTimeout(t);t=setTimeout(function(){e._trigger("input",null,{text:i})},50)}}}()).focus(function(){if(!e.inputInitialized){e.$input.val("");e._trigger("active",null,null);e._setError(false)}e.inputInitialized=true}).blur(function(){if(!t.trim(e.$input.val())){e.inputContent("");e.inputInitialized=false;e._trigger("inactive",null,null)}}).keydown(function(t){if(t.ctrlKey&&13==t.keyCode){e.submit();return false}});e.$submit.bind("button.click",function(t){e.submit();return false});e.element.bind("comment.loadsuccess",function(t,i){e.start=i.start;e.counter=Math.min(i.total-i.start,i.size)});e.element.bind("comment.loadsuccess",function(i,n){if(!n.total){e.$list.empty().append(t('<li class="no-data">'+(e.options.emptyMsg||"暂时还没有人留言。")+"</li>"))}});e.element.bind("comment.loadsuccess",function(i,n){if(n.total){ting.LL&&ting.LL.add(t(".lazyload",e.$list))}})},_setError:function(t){var e=this,i=e.element,n=e.options;if(!t){e.$prompt.html("");e.$submit.button("enable");i.removeClass(n.errorClass)}else{e.$prompt.html(t);e.$submit.button("disable");i.addClass(n.errorClass)}},_initEventHandler:function(){var e=this,i=e.element,n=e.options;i.bind("comment.beforsubmit",function(i,o){if(!t.trim(o.text)){e._setError(n.emptyPromptTpl);return false}if(t.ting.byteLength(o.text)>>1>n.maxLength){e._setError(t.format(n.bytePromptTpl,{maxLength:n.maxLength}));return false}return true});i.bind("comment.input",function(i,o){e._setError(t.ting.byteLength(o.text)>>1>n.maxLength?t.format(n.bytePromptTpl,{maxLength:(t.ting.byteLength(o.text)>>1)-n.maxLength}):false)})}})}(jQuery);(function(t,e){var i="auto",n=1e3,o=0,a={},s=0,r=0,l,c,u=0,p={pass:"pass-message",error:"error-message",info:"info-message",warning:"warning-message"};t.widget("ting.popup",{options:{visible:false,width:i,height:i,x:i,y:i,mask:true},_create:function(){var e=this,i=e.element,n=e.options;e.widgetEventPrefix="popup.";e.$popupDiv=t(['<div class="popup-wrapper">','<div class="popup popup-content-hook">',"</div>",'<div class="popup-footer">',"</div>","</div>"].join(""));t(".popup-content-hook",e.$popupDiv).append(i);t("body").append(e.$popupDiv)},_init:function(){var t=this,e=t.element,i=t.options;t.size(i.width,i.height);t.position(i.x,i.y);t.visible(!!i.visible)},visible:function(t){var i;if(e===t){return this._visible}else{if(this._visible==!!t)return;i=t?"show":"hide";if(false!==this._trigger("befor"+i,null,null)){this.options.mask&&(t?this.maskId=h():this.maskId!=e&&h(this.maskId));t?this.$popupDiv.show():this.$popupDiv.hide();this._visible=!!t;this._trigger("after"+i,null,null)}}},size:function(t,n){if(e===t){return{width:this._width,height:this._height}}else if(e===n){if(t==i){n=i}else{n=t.height;t=t.width}}t=t==i?this.$popupDiv.width():t;n=n==i?this.$popupDiv.height():n;this.$popupDiv.css({width:t,height:n});this._width=t;this._height=n},position:function(n,o){var a;if(e===n){return{x:this._x,y:this._y}}else if(e===o){if(n==i){o=i}else{o=n.y;n=n.x}}if(n==i||o==i){a=this.size()}n=n==i?Math.max(t(document).scrollLeft()+(t(window).width()-a.width>>1),0):n;o=o==i?Math.max(t(document).scrollTop()+(t(window).height()-a.height>>1),0):o;this.$popupDiv.css({top:o,left:n});this._x=n;this._y=o}});function d(){l&&l.css({width:Math.max(t(document).width(),t(window).width()),height:Math.max(t(document).height(),t(window).height())})}function f(e){l=l||t('<div class="popup-mask"></div>').appendTo(t("body"));d();l.toggle(e);r!=2&&e?t(window).bind("scroll",d):t(window).unbind("scroll",d);r=e?2:1}function h(t){if(e==t){a[o]=true;s++;f(true);return o++}else{a[t]&&--s||f(false);delete a[t]}}function g(){var e=t(['<div class="popup-message">','<span class="popup-icon"></span>','<span class="popup-text"></span>',"</div>"].join(""));e.$text=t(".popup-text",e);e.className="";return e.popup()}t.extend(t.ting.popup,{message:function(t,e,o){c=c||g();c.$text.text(t);c.removeClass(c.className).addClass(c.className=p[e]||p.info);c.popup("visible",true).popup("position",i);clearTimeout(u);u=setTimeout(function(){c.popup("visible",false)},typeof o=="number"&&o>0?o:n)},messageOk:function(e,i){t.ting.popup.message(e,"pass",i)},messageFailed:function(e,i){t.ting.popup.message(e,"error",i)}})})(jQuery);(function(t,e){var i=t(".songlist-focus #focus-hook"),n=t(".songlist-focus .focus-cover"),o=t(".songlist-focus #prev"),a=t(".songlist-focus #next");i.anyfocus({effect:"slide",interTime:5e3,callback:function(){}});n.css("height","170px");o.hover(function(){t(this).addClass("prev-hover")},function(){t(this).removeClass("prev-hover")});a.hover(function(){t(this).addClass("next-hover")},function(){t(this).removeClass("next-hover")})})(jQuery);(function(t){t(".mv-list-huanyihuan .mv-list-wrapper ul").hide();var e=0;var i=t(".mv-list-huanyihuan .mv-list-wrapper ul").length;t(".mv-list-huanyihuan .mv-list-wrapper ul").eq(e).show();t(".mv-list-huanyihuan-title a").click(function(){e++;if(e==i)e=0;t(".mv-list-huanyihuan .mv-list-wrapper ul").hide();t(".mv-list-huanyihuan .mv-list-wrapper ul").eq(e).show()})})(jQuery);$.widget("ting.pageNavigator",{options:{total:0,size:0,start:0,show_total:0,focus_neighbor:0,hash:0},_init:function(){this.options.size=this.options.size||10;this.options.show_total=this.options.show_total||10;this.options.focus_neighbor=this.options.focus_neighbor||4;this.options.hash=this.options.hash||0;this.widgetEventPrefix="pagenavigator.";this._event(this);this.options.page=this._start2page(this.options.start,this.options.size)},_start2page:function(t,e){return parseInt(t/e)+1},_event:function(t){var e=t.element;$(".page-navigator-prev",e).click(t._click(t));$(".page-navigator-next",e).click(t._click(t));$(".page-navigator-number",e).click(t._click(t))},_click:function(t){return function(e){e.preventDefault();var i;if($(this).hasClass("page-navigator-prev")){i=t.options.page-1}else if($(this).hasClass("page-navigator-next")){i=t.options.page- -1}else{i=$(this).text()}t.setPage(i);t._trigger("pageChange",e,{size:t.options.size,page:i,start:(i-1)*t.options.size});if(t.options.hash){window.location.hash="";window.location.hash=t.options.hash}return false}},getTotal:function(){return this.options.total},setTotal:function(t){this.options.total=t;this._draw()},getPage:function(){return this.options.page},setPage:function(t){this.options.page=t;this._draw()},page_number_width:function(t){if((t+"").length<3){return"PNNW-S"}else{return"PNNW-D"}},setStart:function(t){this.setPage(this._start2page(t,this.options.size))},setParam:function(t){this.options.total=t.total||this.options.total;this.options.start=t.start||this.options.start;this.options.size=t.size||this.options.size;this.options.page=t.page||this.options.page;this._draw()},getParam:function(){return{total:this.options.total,start:this.options.start,size:this.options.size,page:this.options.page}},_draw:function(){var t=this._page_info(this.options),e=t.total_page,i=t.page,n=t.first,o=t.last,a=t.begin,s=t.end,r=this.element,l=[],c='<span class="page-navigator-dots">...</span>',u;r.text("");if(e<2){return false}if(this.options.total>this.options.size){r.addClass("page-navigator")}if(i==1){l.push('<span class="page-navigator-prev-disable"><</span>')}else{this.currentPage=i-1;l.push('<a class="page-navigator-prev" href="'+this.options.hash+'"><</a>')}if(n){this.currentPage=1;l.push('<a href="'+this.options.hash+'" class="page-navigator-number PNNW-S">1</a>');l.push(c)}for(var p=a;p<=s;p++){u=this.page_number_width(p);if(p==i){l.push('<span class="page-navigator-current '+u+'">'+p+"</span>")}else{this.currentPage=p;l.push('<a href="'+this.options.hash+'" class="page-navigator-number '+u+'">'+p+"</a>")}}if(o){this.currentPage=e;u=this.page_number_width(e);l.push(c);l.push('<a href="'+this.options.hash+'" class="page-navigator-number '+u+'">'+e+"</a>")}if(i==e){l.push('<span class="page-navigator-next-disable">></span>')}else{this.currentPage=i+1;l.push('<a class="page-navigator-next" href="'+this.options.hash+'">></a>')}r.append("<div class='page-cont'></div>");$(".page-cont",r).append("<div class='page-inner'></div>");$(".page-inner",r).html(l.join(""));this._event(this)},_focusNeighbor:function(t,e){var i=t+e,n=i.toString().length,o=n-3,a=e-(o>0?o:0);a=a<1?1:a;return a},_page_info:function(t){var e=t.total,i=t.size||10,n=t.page,o=t.show_total||10,a=t.focus_neighbor||4,s=parseInt(e/i),r,l,c,u;if(e%i!=0){s=s+1}if(n<1){n=1}if(n>s){n=s}n=parseInt(n);a=this._focusNeighbor(n,a);if(s<=o){c=1;u=s}else{c=n-a;u=n+a;r=true;l=true;if(c<3){c=1;u=o-1;r=false}else if(u>s-2){c=s-a*2;u=s;l=false}}return{total_page:s,page:n,first:r,last:l,begin:c,end:u}}});(function(t,e){t.widget("ting.floatLayer",{options:{positionType:"absolute",autoShow:false,animation:false,animationType:"fadeAnimate",animationTime:500,maskColor:"#999",maskOpacity:.6,maskZIndex:12e3,layerZIndex:12001,intervalIE6:50,autoHideTime:3e3,autoHide:false},animationList:["fadeAnimate"],_create:function(){var e=this,i=e.options;e.layer=e.getLayer();e.mask=e.getMask();t(e.mask).bgiframe();e.locateLayer();e.layer.bind("showFloatLayer",function(){e.show();if(i.autoHide){setTimeout(function(){e.hide()},i.autoHideTime)}});e.layer.bind("hideFloatLayer",function(){e.hide()});if(i.autoShow){e.show()}},getLayer:function(){return this.element},getMask:function(){var e=this,i=e.options,n=null,o=e.getDocumentScales();if(t.ting.floatLayer.mask){t.ting.floatLayer.mask.css({width:o.width,height:o.height});return t.ting.floatLayer.mask}else{n=t("<div class='float-layer-mask'></div>").css({position:"absolute",display:"none",top:0,left:0,width:o.width,height:o.height,backgroundColor:i.maskColor,opacity:i.maskOpacity,zIndex:i.maskZIndex});t(document.body).append(n);t.ting.floatLayer.mask=n;return n}},getWindowScales:function(){return{width:t(window).width(),height:t(window).height()}},getDocumentScales:function(){var t=document,e=document.body,i=t.documentElement,n=t.compatMode=="BackCompat"?e:i;return{width:Math.max(i.scrollWidth,e.scrollWidth,n.clientWidth),height:Math.max(i.scrollHeight,e.scrollHeight,n.clientHeight)}},getLayerDimensions:function(){var t=this,e=t.element;return{width:e.width(),height:e.height()}},calculateLayerPosition:function(){var e=this,i=e.options,n=e.element,o=e.getWindowScales(),a=e.getLayerDimensions(),s=e.getDocumentScales(),r=(o.width-a.width)/2,l=(o.height-a.height)/2,c=t(document).scrollTop(),u=20;r=r>0?r:0;if(i.positionType=="absolute"){l=l>0?l:0;l=l+c;l=l+a.height>s.height?s.height-a.height-u:l;if(l<0){l=0;n.css({overflowY:"scroll",height:s.height-u})}}else if(i.positionType=="fixed"){l=l>0?l:0;if(l+a.height>o.height){l=0;n.css({overflowY:"scroll",height:o.height})}}else{l=0}return{offsetX:r,offsetY:l}},locateLayer:function(){var e=this,i=e.options,n=e.element,o=e.calculateLayerPosition();n.addClass("float-layer").css({position:i.positionType,display:"none",top:o.offsetY,left:o.offsetX,zIndex:i.layerZIndex});if(t.browser.msie&&t.browser.version=="6.0"&&i.positionType=="fixed"){n.css({position:"absolute"});clearInterval(t.ting.floatLayer.timer);t.ting.floatLayer.timer=setInterval(function(){var e=t(document).scrollTop()+o.offsetY;n.css({top:e})},i.intervalIE6)}return true},show:function(){var t=this;t.showMask();t.showLayer()},hide:function(){var t=this;t.hideMask();t.hideLayer()},showLayer:function(){var e=this,i=e.options,n=e.element;e.locateLayer();t(".active-float-layer").removeClass("active-float-layer").addClass("hiding-float-layer");n.removeClass("inactive-float-layer hiding-float-layer").addClass("active-float-layer");if(i.animation){t(".hiding-float-layer").each(function(){e.animate(this,"hide")});e.animate(n,"show")}else{t(".hiding-float-layer").hide();n.show()}t(".hiding-float-layer").removeClass("hiding-float-layer").addClass("inactive-float-layer")},hideLayer:function(){var t=this,e=t.options,i=t.element.removeClass("active-float-layer").addClass("inactive-float-layer");e.animation?t.animate(i,"hide"):i.hide()},showMask:function(){var t=this,e=t.options,i=t.getMask();if(i.hasClass("on")){return}i.addClass("on");e.animation?t.animate(i,"show","mask"):i.show()},hideMask:function(){var t=this,e=t.options,i=t.getMask();i.removeClass("on");
e.animation?t.animate(i,"hide","mask"):i.hide()},hideAll:function(){var e=this,i=e.options,n=e.getMask();t(".float-layer").each(function(){t(this).removeClass("active-float-layer").addClass("inactive-float-layer");e.animate(this,"hide")});e.hideMask()},animate:function(e,i,n){var o=this,a=o.options;if(!t.inArray(a.animationType,o.animationList)){a.animationType=o.animationList[0]}o[a.animationType].call(o,e,i,n)},fadeAnimate:function(e,i,n){var o=this,a=o.options,s=0,r;r=n=="mask"?a.maskOpacity:1;if(i==="show"){t(e).css({opacity:s}).show().animate({opacity:r},{duration:a.animationTime})}else if(i==="hide"){t(e).animate({opacity:s},{duration:a.animationTime,complete:function(){t(this).hide();t(this).css({opacity:r})}})}}})})(jQuery);(function(t,e){t.widget("ting.tooltip",{options:{str:"",preant:"body",spacing:5,timeout:300,pos:"bottom"},_create:function(){var e=this,i=e.options,n=e.element;e.tip=t('<i class="tips"><i class="triangle-bg"></i><i class="triangle"></i>'+i.str+"</i>");e.tip=t('<div class="tool-tip '+i.pos+'">'+'<i class="triangle-t"></i>'+'<i class="triangle-b"></i>'+'<div class="tl">'+'<div class="inner" style="width:auto;">'+i.str+"</div>"+"</div>"+'<div class="tr"></div>'+'<div class="bl"></div>'+"</div>");setTimeout(function(){e._setPos()},50);e.widgetEventPrefix="tooltip.";t(i.preant).append(e.tip)},show:function(){var t=this,e=t.element,i=t.options;t._bindEvent()},hide:function(){var t=this,e=t.element,i=t.options;t.tip.hide()},remove:function(){var t=this,e=t.element,i=t.options;t.tip.hide();t._removeEvent()},_setPos:function(){var t=this,e=t.element,i=t.options;t.tip.css({left:e.offset().left-t.tip.outerWidth(true)/2+e.outerWidth(true)/2+"px",top:i.pos==="bottom"?e.offset().top-t.tip.height()-16-i.spacing:e.offset().top+t.tip.height()+10+i.spacing})},_bindEvent:function(){var t=this,e=t.element,i=t.options,n=null;e.hover(function(){n&&window.clearTimeout(n);t._setPos();t.tip.show()},function(){n=window.setTimeout(function(){t.tip.hide()},i.timeout)});t.tip.hover(function(){window.clearTimeout(n);t.tip.show()},function(){t.tip.hide()})},_removeEvent:function(){var t=this,e=t.element,i=t.options;e.unbind()}})})(jQuery);(function(t,e){t.fn.collectPlaylist=function(e){var i=this,n=t(i).data("playlist"),e=e||{},o=n?n.ids.split(",").length:0;t(i).tip();if(t(i).data("collected")){t(i).tip("tipup",{msg:"已收藏为歌单",iconClass:"tip-success"});return}function a(i,a){var s={page:ting.logger.getPage(),listid:n.listid,pos:"collect_list",songcount:o,listname:n.title};s=t.extend(s,a,e.log||{});if(ting&&ting.logger){ting.logger.log(i,s)}}a("click");var s={moduleName:n.moduleName,ids:n.ids||"",mediaType:2,albumId:n.listid||"",_aiPresaleFlag:n._aiPresaleFlag||"",resourceTypeExt:n.resourceTypeExt||"",albumPic:n.albumPic||"",albumTitle:n.albumTitle||"",albumPublishTime:n.albumPublishTime||""};var r={page:ting.logger.getPage(),pos:"collect_playList"};if(s.resourceTypeExt&&(s.resourceTypeExt==3||s.resourceTypeExt==4)){r.album_title=s.albumTitle;r.album_id=s.albumId;r.isPay=3;ting.checkSellResourse(s.id,s.albumId,function(t,e){s.isPay=e;if(s.isPay!=1||s.siPresaleFlag==1||s._aiPresaleFlag==1){ting.media.collectPlaylist(s.albumId,s)}else{l()}})}else{l()}function l(){ting.connect.collectPlaylist(null,n,function(e){t(i).data("collected",true);if(e.data.illegal==1){var o=t("<p>你选中的歌曲部分需要进行付费，暂时不支持批量操作。<br/>你可以对单曲进行付费收藏到云。</p>");o.dialog({className:"dialog-message",showBtn:true,confirm:{btn:"",close:true,callback:function(){},text:"知道了"},cancel:false,destroy:true,title:"&nbsp;",width:360,showBg:true}).dialog("show")}else{t(i).tip("tipup",{msg:"已收藏为歌单",iconClass:"tip-success"})}r.state=1;a("collect",r);ting.media.collectPlaylist(e.data.listId,{listTitle:n.title})},function(e){ting.DM=".baidu.com";if(location.host.indexOf("taihe.com")!=-1){ting.DM=".taihe.com"}else if(location.host.indexOf("qianqian.com")!=-1){ting.DM=".qianqian.com"}var n="tip-error";switch(e.errorCode){case 22331:e.errTip="云空间已满，去<a href ='http://yinyueyun.baidu.com/' target = '_blank'>整理云空间</a>吧！";break;case 22677:e.errTip="歌单数量已达上限，去<a href ='//play"+ting.DM+"/' target = '_blank'>音乐盒整理</a>吧！";break;case 22232:e.errTip="对不起，千千音乐只能在中国内地提供服务";break;default:e.errTip="操作失败，请稍候再试";break}var o={msg:e.errTip?e.errTip:"操作失败",iconClass:n};if(e.errorCode=22331){o.showTime=5e3}else{o.showTime=1e3}r.state=e.errorCode;a("collect",r);t(i).tip("tipup",o)})}}})(jQuery);(function(t,e){t.widget("ting.songCollection",{options:{tag:""},_create:function(){var t=this,e=t.element;this.$list=e.find(".col-list .song-list");this.$foldBtn=e.find(".col-list-all");this.$cover=e.find(".cover-img");this.$collect=e.find(".col-collect");this.$play=e.find(".col-play,.play-list-all");t._initEvent()},_initEvent:function(){var e=this,i=e.element;e.$foldBtn.bind("click",function(){var i=t.ting.songCollection.$upWidget;if(i&&!t.contains(i[0],e.$foldBtn[0])){t.ting.songCollection.$upWidget.songCollection("foldList")}e.foldList();return false});i.find(".cover-link,.title-link").bind("click",function(){var t=e.$collect.data("playlist"),i=t.listid,n=e.element.index(),o=e.element.parent().index(),a={page:"c_songlist_i",tag:e.options.tag,listid:t.listid,pos:this.className,col:n,row:o};if(ting&&ting.logger){ting.logger.log("click",a)}});e.$collect.bind("click",function(){var t=e.element.index(),i=e.element.parent().index();e.$collect.collectPlaylist({log:{page:"c_songlist_i",tag:e.options.tag,col:t,row:i}});return false});e.$play.bind("click",function(){var i=e.$collect.data("playlist").ids,n=e.$collect.data("playlist"),o=n.listid,a=e.element.index(),s=e.element.parent().index(),r={page:"c_songlist_i",tag:e.options.tag,listid:n.listid,pos:"play_songlist",col:a,row:s};if(i){i=i.split(",");ting.media.playSong(i,n);t.ajax({url:"/data/music/songlist/listen?playlistId="+o+"&t="+new Date*1});if(ting&&ting.logger){ting.logger.log("click",r)}t(this).tip().tip("tipup",{msg:"已开始播放！",iconClass:"tip-success"})}return false})},foldList:function(){if(this.$list.hasClass("fold-list")){this.$list.removeClass("fold-list").addClass("testttt");this.$foldBtn.text("收起").addClass("fold-up").removeClass("fold-down");t.ting.songCollection.$upWidget=this.element}else{this.$list.addClass("fold-list");this.$foldBtn.text("全部").addClass("fold-down").removeClass("fold-up");this.$upWidget=null}}})})(jQuery);(function(){var t=false,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(i){var n=this.prototype;t=true;var o=new this;t=false;for(var a in i){o[a]=typeof i[a]=="function"&&typeof n[a]=="function"&&e.test(i[a])?function(t,e){return function(){var i=this._super;this._super=n[t];var o=e.apply(this,arguments);this._super=i;return o}}(a,i[a]):i[a]}function s(){if(!t&&this.init)this.init.apply(this,arguments)}s.prototype=o;s.prototype.constructor=s;s.extend=arguments.callee;return s}})();(function(t){Porthole={trace:function(e){if(t["console"]!==undefined){}else{}},error:function(e){if(t["console"]!==undefined){t.console.error("Porthole: "+e)}}};Porthole.WindowProxy=function(){};Porthole.WindowProxy.prototype={post:function(t,e){},addEventListener:function(t,e){},removeEventListener:function(t){}};Porthole.WindowProxyBase=Class.extend({init:function(e){if(e===undefined){e=""}this.targetWindowName=e;this.origin=t.location.protocol+"//"+t.location.host;this.eventListeners=[]},getTargetWindowName:function(){return this.targetWindowName},getOrigin:function(){return this.origin},post:function(e,i){if(i===undefined){i="*"}this.dispatchMessage({data:e,sourceOrigin:this.getOrigin(),targetOrigin:i,sourceWindowName:t.name,targetWindowName:this.getTargetWindowName()})},addEventListener:function(t){this.eventListeners.push(t);return t},removeEventListener:function(t){var e;for(var i=0,n=this.eventListeners.length;i<n;i++){if(this.eventListeners[i]===t){e=i}}this.eventListeners.splice(e,1)},dispatchEvent:function(t){var e;for(e=0;e<this.eventListeners.length;e++){try{this.eventListeners[e](t)}catch(i){}}},createIFrameProxy:function(){var t=document.createElement("iframe");t.setAttribute("id",this.proxyIFrameName);t.setAttribute("name",this.proxyIFrameName);t.setAttribute("src",this.proxyIFrameLocation);t.setAttribute("frameBorder","1");t.setAttribute("scrolling","no");t.setAttribute("width",30);t.setAttribute("height",30);t.setAttribute("style","position: absolute; left: 0; top: -100px;");if(t.style.setAttribute){t.style.setAttribute("cssText","position: absolute; left: 0; top: -100px;")}document.body.appendChild(t);return t},refreshIframe:function(t){this.proxyIFrameElement.src=this.proxyIFrameLocation}});Porthole.WindowProxyLegacy=Porthole.WindowProxyBase.extend({init:function(t,e){this._super(e);if(t!==null){this.proxyIFrameLocation=t;this.proxyIFrameName=this.targetWindowName+"ProxyIFrame";this.proxyIFrameElement=this.createIFrameProxy()}else{this.proxyIFrameElement=null;throw new Error("proxyIFrameUrl can't be null")}},getTargetWindow:function(){return Porthole.WindowProxy.getTargetWindow(this.targetWindowName)},splitString:function(t){var e=2e3,i=0,n=[],o=t.length;while(i<o){n.push(t.substr(i,e));i+=e}return n},dispatchLock:false,dispatchMessage:function(e){if(this.dispatchLock){return}this.dispatchLock=true;var i=t.encodeURIComponent;if(this.proxyIFrameElement){var n=i(Porthole.WindowProxy.serialize(e)),n=this.splitString(n);var o=n.length,a=this;for(var s in n){(function(t){setTimeout(function(){var s={end:t==o-1,data:n[t],sourceOrigin:e.sourceOrigin,targetOrigin:e.targetOrigin,sourceWindowName:e.sourceWindowName,targetWindowName:e.targetWindowName};var r=a.proxyIFrameLocation+"#"+i(Porthole.WindowProxy.serialize(s));a.proxyIFrameElement.setAttribute("src",r);a.proxyIFrameElement.width=a.proxyIFrameElement.width<=50?100:50;if(s.end){a.dispatchLock=false}},t*100)})(s)}}}});Porthole.WindowProxyHTML5=Porthole.WindowProxyBase.extend({init:function(t,e){this._super(e);if(e){this.proxyIFrameLocation=t;this.proxyIFrameName=this.targetWindowName;this.proxyIFrameElement=this.createIFrameProxy()}this.eventListenerCallback=null},getTargetWindow:function(){if(this.targetWindowName){return frames[this.targetWindowName]}else{return parent}},dispatchMessage:function(t){this.getTargetWindow().postMessage(Porthole.WindowProxy.serialize(t),t.targetOrigin)},addEventListener:function(e){if(this.eventListeners.length===0){var i=this;this.eventListenerCallback=function(t){i.eventListener(i,t)};t.addEventListener("message",this.eventListenerCallback,false)}return this._super(e)},removeEventListener:function(e){this._super(e);if(this.eventListeners.length===0){t.removeEventListener("message",this.eventListenerCallback);this.eventListenerCallback=null}},eventListener:function(t,e){var i=Porthole.WindowProxy.unserialize(e.data);if(i&&(t.targetWindowName==""||i.sourceWindowName==t.targetWindowName)){t.dispatchEvent(new Porthole.MessageEvent(i.data,e.origin,t))}}});if(typeof t.postMessage!=="function"){Porthole.trace("Using legacy browser support");Porthole.WindowProxy=Porthole.WindowProxyLegacy.extend({})}else{Porthole.trace("Using built-in browser support");Porthole.WindowProxy=Porthole.WindowProxyHTML5.extend({})}Porthole.WindowProxy.serialize=function(t){if(typeof JSON==="undefined"){throw new Error("Porthole serialization depends on JSON!")}return JSON.stringify(t)};Porthole.WindowProxy.unserialize=function(t){if(typeof JSON==="undefined"){throw new Error("Porthole unserialization dependens on JSON!")}try{var e=JSON.parse(t)}catch(i){return false}return e};Porthole.WindowProxy.getTargetWindow=function(t){if(t===""){return top}return self};Porthole.MessageEvent=function e(t,i,n){this.data=t;this.origin=i;this.source=n};Porthole.WindowProxyDispatcher={data:[],windowProxy:null,joinString:function(){var e=t.decodeURIComponent,i=Porthole.WindowProxy.unserialize(e(document.location.hash.substr(1))),n=Porthole.WindowProxyDispatcher;if(!n.windowProxy){var o=Porthole.WindowProxy.getTargetWindow(i.targetWindowName);n.windowProxy=n.findWindowProxyObjectInWindow(o,i.sourceWindowName)}n.data.push(i.data);if(i.end){n.forwardMessageEvent()}},forwardMessageEvent:function(e){var i,n=t.decodeURIComponent,o,a,s=Porthole.WindowProxyDispatcher;i=s.data.join("");s.data=[];if(i.length>0){try{i=Porthole.WindowProxy.unserialize(n(i))}catch(r){return}a=s.windowProxy;if(a){if(a.origin===i.targetOrigin||i.targetOrigin==="*"){a.dispatchEvent(new Porthole.MessageEvent(i.data,i.sourceOrigin,a))}else{Porthole.error("Target origin "+a.origin+" does not match desired target of "+i.targetOrigin)}}else{Porthole.error("Could not find window proxy object on the target window")}}},findWindowProxyObjectInWindow:function(t,e){var i;if(t.RuntimeObject){t=t.RuntimeObject()}if(t){for(i in t){if(t.hasOwnProperty(i)){if(t[i]!==null&&typeof t[i]==="object"&&t[i]instanceof t.Porthole.WindowProxy){return t[i]}}}}return null},start:function(){if(t.addEventListener){t.addEventListener("resize",Porthole.WindowProxyDispatcher.joinString,false)}else if(document.body.attachEvent){t.attachEvent("onresize",Porthole.WindowProxyDispatcher.joinString)}else{Porthole.error("Cannot attach resize event")}}}})(this);var openApp=openApp||{};(function(t,e,i){function n(t){var e=document.createElement("div");e.innerHTML=t;try{return e.childNodes[0].nodeValue}catch(i){return t}}var o=t(document);t.extend(i,{trigger:function(t,e){o.trigger(t,e)},on:function(t,e){o.on(t,e)}});var a=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,r=/(msie) ([\w.]+)/,l=/(mozilla)(?:.*? rv:([\w.]+))?/,c=function(t){t=t.toLowerCase();var e=a.exec(t)||s.exec(t)||r.exec(t)||t.indexOf("compatible")<0&&l.exec(t)||[];var i={browser:e[1]||"",version:e[2]||"0"};if(i.browser==="webkit"){if(t.indexOf("maxthon")>-1){i.browser="maxthon"}else if(t.indexOf("lbbrowser")>-1){i.browser="lbbrowser"}else if(t.indexOf("bidubrowser")>-1){i.browser="bidubrowser"}}return i},u=c(navigator.userAgent);var p=null,d=null,f="baidumusic",h=f+"://music.qianqian.com",g=null,m=function(i){if(g===null){g=document.createElement("iframe");g.style.display="none";document.body.appendChild(g)}var n=false,o=t(e);e.focus();o.on("blur.openapp",function(t){o.off("blur.openapp");n=true;p=true;i(p)});setTimeout(function(){o.off("blur.openapp");if(!n){p=false;i(p)}},7e3);g.src=h},v=function(t,i){if(!i){var n=e.open("","","width=0,height=0");try{g=n.document.createElement("iframe")}catch(o){alert("窗口被拦截，请放行！");return}g.src=h;n.document.body.appendChild(g);setTimeout(function(){try{var e=n.location.href;p=true}catch(i){p=false}if(p){n.setTimeout("window.close()",100)}else{n.close()}d=p;t(p)},100)}else{if(d){location.href=h}t(d)}},y=function(t){if(g===null){g=document.createElement("iframe");g.style.display="none";document.body.appendChild(g)}try{g.contentWindow.location.href=h;p=true}catch(e){if(e.name==="NS_ERROR_UNKNOWN_PROTOCOL"){p=false}}t(p)},w=function(i){var n=false,o=t(e);o.on("blur.openapp",function(t){o.off("blur.openapp");n=true;p=true;i(p)});e.focus();setTimeout(function(){o.off("blur.openapp");if(!n){p=false;i(p)}},5e3);location.href=h},b=function(t){if(g===null){g=document.createElement("iframe");g.style.display="none";document.body.appendChild(g)}g.src=h;p=null;t(true)},_=function(){switch(u.browser){case"msie":if(parseInt(u.version,10)<7){return function(t){t=t||function(){};m(t)}}else{return function(t,e){t=t||function(){};v(t,e)}}break;case"webkit":return function(t){t=t||function(){};w(t)};break;case"mozilla":return function(t){t=t||function(){};y(t)};break;default:return function(t){t=t||function(){};b(t)};break}}();t.extend(i,{getStatus:function(){return p},setStatus:function(t){t=t===undefined?null:t;if(t!==p){i.trigger("status:change",t)}p=t}});var x={targetHost:"http://127.0.0.1:5277",proxyPath:"/static/html/web_pc_proxy.html",iframeName:"postFrame",timeout:4e3,times:5},k={get:{browser:u.browser,version:u.version,from:location.hostname},post:null},P=false,T=function(t){if(u.browser==="msie"&&parseInt(u.version,10)>6&&!P){P=true;_(t)}else{t()}},I=function(e,n,o){var a={},s=E(n.callback),r=null,l=arguments;n.callback=s;n.data=n.data||{};if(!n.data.post){a.post=t.extend({},n.data)}a=t.extend(k,a);a.method=e;a.type=n.type||"post";var c=function(t){Porthole.trace("index",t);if(t.origin===x.targetHost){clearTimeout(r);var e=t.data;Porthole.trace(e.errorCode);if(e.errorCode===200){i.setStatus(true);s.success(e.data);i.trigger("openapp:success")}else{if(!o){i.trigger("openapp:error",l)}else{s.error(e.data)}}s.complete(e.data)}windowProxy.removeEventListener(arguments.callee)};windowProxy.addEventListener(c);var u=encodeURIComponent(JSON.stringify(a)),p=Math.ceil(u.length/2e3*100*1.25)+1500;r=setTimeout(function(){windowProxy.removeEventListener(c);r=null;Porthole.trace("timeout");if(!o){i.trigger("openapp:error",l)}else{s.error()}},p);windowProxy.post(a)},E=function(e){var i={success:function(){},error:function(){},complete:function(){}};if(typeof e==="function"){i=t.extend(i,{success:e})}else if(e===Object(e)){i=t.extend(i,e)}return i},N=function(t,e){var n=i.getStatus(),o=e.callback;if(n===null){_(function(n){if(n){L(function(n){if(n){I(t,e)}else{o.error();o.complete();i.trigger("openapp:unstart",e.settings)}})}else{o.error();o.complete();i.trigger("openapp:uninstall",e.settings)}},true)}else{if(n){I(t,e)}else{o.error();o.complete();i.trigger("openapp:uninstall",e.settings)}}},L=function(t){var e=null,n=M.opts.times,o=function(){Porthole.trace(n);I("getClientInfo",{data:{v:+new Date},callback:{success:function(e){i.setStatus(true);t(true)},error:function(){if(--n){windowProxy.refreshIframe();setTimeout(o,1e3)}else{t(false)}}},type:"get"},true)};o()},C=function(){i.on("openapp:error",function(t,e,n){i.setStatus(null);N(e,n)});i.on("openapp:uninstall",function(){i.setStatus(null);P=false})},$=function(){var e={download:{type:"click",data:{pos:"downbypc"}},success:{type:"exposure",data:{expoitem:"openedpc"}},uninstall:{type:"exposure",data:{expoitem:"downclient"}}};t.each(e,function(t,e){i.on("openapp:"+t,function(){e.data.page=ting.logger.getPage();ting.logger.log(e.type,e.data)})})},W=function(e,i){ting.connect.getSong({song_id:e.songIds,rate:e.rate||128},null,function(e){e=e.data;var o=[];t.each(e.songList,function(t,e){o.push({song_id:e.songId,song_title:n(e.songName),song_artist:n(e.artistName),file_id:e.fileId,file_url:e.songLink,file_size:e.size,file_hash:e.hash,file_bit_rate:e.rate,file_extension:e.format,duration:e.time*1e3,album_image_url:e.songPic,lyric_url:e.lrcLink,copy_type:e.copyType,album_id:e.albumId,album_name:n(e.albumName)})});i({total:e.songList.length,songlist:o})})},S=navigator.platform.toLowerCase().indexOf("win")>-1,z=function(t,e,n){M.getClientInfo(null,function(o){o=JSON.parse(o);var a=o.client_info.version_num;if(a>=t){n()}else{e.complete();i.trigger("openapp:update")}})},M={init:function(e){M.opts=t.extend(x,e);windowProxy=new Porthole.WindowProxy(M.opts.targetHost+"/proxy.html?proxyPath="+M.opts.proxyPath,M.opts.iframeName);C();$();return M},getClientInfo:function(t,e){T(function(){I("getClientInfo",{data:t,callback:e,type:"get"})})},dowloadSong:function(t,e,n){if(!S){i.trigger("openapp:platformerror");e.error();e.complete();return}i.trigger("openapp:download");n=n||W;T(function(){z(150995456,e,function(){if(t.songlist){I("addDownloadTask",{data:t,callback:e})}else{n(t,function(t){I("addDownloadTask",{data:t,callback:e})})}})})},playSong:function(t,e,n){if(!S){i.trigger("openapp:platformerror");e.error();e.complete();return}n=n||W;var o=t.listName,a=t.checkVersion;T(function(){if(a){z(134349312,function(){n(t,function(t){t.play_now=1;t.playlist_name=o;I("addSongList",{data:t,callback:e})})})}else{n(t,function(t){t.play_now=1;t.playlist_name=o;I("addSongList",{data:t,callback:e})})}})},addSong:function(t,e,n,o){if(!S){i.trigger("openapp:platformerror");e.error();e.complete();return}n=n||W;var a=t.listName,s=t.checkVersion;T(function(){if(s){z(134349312,function(){n(t,function(t){t.play_now=0;t.playlist_name=a;I("addSongList",{data:t,callback:e,settings:o})})})}else{n(t,function(t){t.play_now=0;t.playlist_name=a;I("addSongList",{data:t,callback:e,settings:o})})}})},manualLaunch:function(){_(function(t){if(t){L(function(t){if(!t){i.trigger("openapp:unstart")}})}else{i.trigger("openapp:uninstall")}})}};t.extend(i,M)})(jQuery,window,openApp);var ting=ting||{};(function(){var t=false;ting.openApp={init:function(e){if(t){return}e=e||{};var i="//download.qianqian.com/channel/1/web_xiangqingad";var n=e.appUrl||i,o=$('<div>千千音乐自启动失败，请手动启动客户端。<br />如果没有安装新版本，请<a class="openapp-downurl" href="'+n+'">点击这里</a>下载。</div>'),a=$("<div>您需要安装新版本的客户端，请安装启动后再试。</div>"),s=$("<div>该功能暂只支持Windows系统。</div>"),r=$("<div>检测到您安装的版本较低，建议您升级最新版进行批量下载</div>");openApp.init();openApp.on("openapp:unstart",function(t,e){openApp.trigger("uninstall:hideloading");e=e||{};var i=e.appUrl||n;o.find(".openapp-downurl").attr("href",i);o.dialog({title:"启动失败",width:400,className:"openapp-dialog",showBtn:true,confirm:{text:"立即启动",callback:function(){openApp.manualLaunch()},close:true}});o.dialog("show")});openApp.on("openapp:uninstall",function(t,e){openApp.trigger("uninstall:hideloading");e=e||{};var i=e.appUrl||n;a.dialog({title:"未安装",width:400,className:"openapp-dialog",showBtn:true,confirm:{text:"确定",callback:function(){},close:true},cancel:null});a.dialog("show");location.href=i;ting.logger.log("click",{page:"dpc_panel",pos:"downclient"})});openApp.on("openapp:platformerror",function(){s.dialog({title:"系统不支持",width:400,className:"openapp-dialog",showBtn:true,confirm:{text:"确定",callback:function(){},close:true},cancel:null});s.dialog("show")});openApp.on("openapp:update",function(t,e){e=e||{};var i=e.appUrl||n;r.dialog({title:"更新提示",width:400,className:"openapp-dialog",showBtn:true,confirm:{text:"立即下载最新版",callback:function(){location.href=i},close:true},cancel:null});r.dialog("show")});t=true}}})();

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/