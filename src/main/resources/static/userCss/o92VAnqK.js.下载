(function(t){t.widget("ting.autoComplete",{options:{},_create:function(){var e=this;e.widgetEventPrefix="auto.";e.sugInput=t(".s_ipt_wr input");e.sugResult=t(".sug-result");e.sugType="search";e.keyword="";e._dataCache={};e.sugSpan=t(".s_ipt_wr");e.classStyle={FIRST_ITEM:"first-item",LAST_ITEM:"last-item",OVER:"over",CI:"ci"};e.keyMgr={DOWN:40,UP:38,ESC:27,ENTER:13};e.currentItem=null;e.selectEventInterval=150;e._lastSelectTime=null;e._focusing=false;e.logTime=0;e.num=0;e.timeId=null;e.loadPic=t("#loading-pic");e.addInputEventListener();e.DefaultCdPic="//static3.qianqian.com/web/static/i/3eSIcTg8.png";e.DefaultAvatarPic="//static2.qianqian.com/web/static/i/ixDq1LKy.png"},addInputEventListener:function(){if(t(".urank-module").length<1){var e=this;e.sugInput.bind("blur",function(){if(!e._focusing){if(e.sugSpan&&e.sugSpan.hasClass("s_ipt_wr_active_border")){e.sugSpan.removeClass("s_ipt_wr_active_border")}e.hide()}});e.sugInput.bind("focus input propertychange",function(t){if(e.timeId===null){e.sugSpan.addClass("s_ipt_wr_active_border");e.timeId=setTimeout(function(){e.textChangeHandler(t)},50)}});e.sugInput.bind("keydown",function(t){if(t.keyCode!=40&&t.keyCode!=38&&t.keyCode!=27&&t.keyCode!=13){return}var s=(new Date).valueOf();var a=parseInt(s-e._lastSelectTime,10)||0;if(a>=e.selectEventInterval){e._lastSelectTime=s;e.keySelectHandler(t)}});e.sugResult.bind("mouseenter",function(t){e._focusing=true});e.sugResult.bind("mouseleave",function(t){e.currentItem=null;e._focusing=false});e.sugResult.bind("mousedown",function(s){var a=s.target,i=a.nodeName.toUpperCase(),n="",r=null;if(i!="A"){r=t(a).parents("a:first").get(0);if(r&&t(r,e.sugResult)){a=r}else{return}}var l=t(a).parents("dl:first").attr("class")||"sug-people";var o=l.match(/sug-(\w+)/),u;if(o){u=o[1];e.channelName=u;if(u=="people"){n="clicklog"}else{n="suggestionlog"}}e._trigger(n,null,e);return})}},handleResponse:function(e){var s=this;var a=s.format(e);s.sugResult.html(a);ting.DM=".baidu.com";if(location.host.indexOf("taihe.com")!=-1){ting.DM=".taihe.com"}else if(location.host.indexOf("qianqian.com")!=-1){ting.DM=".qianqian.com"}if(s.sugInput.val()&&"音乐盒".indexOf(s.sugInput.val())!=-1)var i='<dl data-module="search" class="sug-artist clearfix">'+'<dt class="sug-title clearfix">链接</dt>'+'<dd class="first-item">'+'<a href="//play'+ting.DM+'" class="">'+'<img width="40px" height="40px" src="//static1.qianqian.com/web/static/i/mBwqO2fj.png" alt="音乐盒"><span>音乐盒</span>'+"</a></dd>"+"</dl>";s.sugResult.find(".shadowright").prepend(i);require(["require/music_icon"],function(){t(".music-icon-hook",s.sugResult).musicIcon({hasTip:false})});t(".music-icon-hook .list-micon",s.sugResult).bind("click",function(){var e=t(this).parent().data("log")||{};e.act=t(this).data("action");ting.logger.plogClick("clicksearch",e)});var n="";var r="";var l="";t(".sug-album .hot-sale-album").hover(function(){n=t(this);l=n.data("id");r=t("#album-"+l).attr("href");t("#album-"+l).attr("href","javascript:void(0)")},function(){t("#album-"+l).attr("href",r)}).bind("click",function(t){ting.media.sellAlbum(n,t)});t(".music-icon-hook .list-micon.icon-needvip").bind("click",function(){var e=t(this);var s=e.parents(".music-icon-hook").data("musicicon");var a={};var i=function(t){var e=document.createElement("div");e.innerHTML=t;try{return e.childNodes[0].nodeValue}catch(s){return t}};if(BDUS&&BDUS.vipState!="gold"){ting.showTip({$tar:e,type:"needgoldvip",cancelEvent:"blur",reason:"pay_listen"})}else{var n=s.type;var r="playSong";switch(n){case"song":r="playSong";break;case"album":r="playAlbum";break;case"diy":r="playDiy";break;case"artist":r="playArtist";break}ting.media[r](i(s.id),a)}});s.mouseOverHandler();s.mouseOutHandler();s.currentItem=null;s.loadPic.css("display","none");ting.logger.log("exposure",{expoitem:"sug",sub:s.sugType});this.show()},handleReady:function(t){var e=this;e._dataCache[e.keyword||"remlist"]=t;e.handleResponse(t)},textChangeHandler:function(e){var s=this;s.timeId=null;var a=s.sugInput.val();if(s.keyword==t.trim(a)&&s.keyword!=a){return}s.keyword=t.trim(a);s.logTime=(new Date).valueOf();s.loadPic.css("display","block");var i=s._dataCache[s.keyword||"remlist"];if(i!==undefined){s.handleResponse(i)}else{s._dataCache={};s._trigger("change",e,s)}},keySelectHandler:function(e){var s=window.event?event.keyCode:e.which;var a=0;var i=this.currentItem;var n=null;switch(s){case this.keyMgr.UP:e.preventDefault();a--;break;case this.keyMgr.DOWN:e.preventDefault();a++;break;case this.keyMgr.ESC:this.sugInput.blur();this.hide();break;case this.keyMgr.ENTER:e.preventDefault();var r=this.currentItem;if(t(".urank-module").length<1){if(r){this.sugInput.blur();var l=this.currentItem.parents("dl:first").attr("class");var o=l.match(/sug-(\w+)/),u;if(o){u=o[1];this.channelName=u}else{return}this._trigger("suggestionlog",null,this);location.href=t("a",r).attr("href");ting.sugControl=false;return}else{if(!t.trim(this.sugInput.val())){return null}else{this.sugInput.blur();this._trigger("commonlog",null,this);var c=this;setTimeout(function(){c.element.submit()},500)}}break}default:break}if(a){if(a==1){if(i){n=i.nextAll("dd").eq(0);if(!n.length){if(!i.parent().nextAll("dl").length){n=t("dd:first",this.sugResult)}else{n=i.parent().nextAll("dl").eq(0).children("dd:first")}}}else{n=t("dd:first",this.sugResult)}}else if(a==-1){if(i){n=i.prevAll("dd").eq(0);if(!n.length){if(!i.parent().prevAll("dl").length){n=t("dd:last",this.sugResult)}else{n=i.parent().prevAll("dl").eq(0).children("dd:last")}}}else{n=t("dd:last",this.sugResult)}}if(i){t("a",i).removeClass("over")}if(n.length){t("a",n).addClass("over");this.currentItem=n}else{this.currentItem=null}}},mouseOverHandler:function(){var e=this;t("dd",e.sugResult).bind("mouseenter",function(s){t("a",e.sugResult).removeClass("over");e.currentItem=t(this);t(this).children("a").addClass("over")})},mouseOutHandler:function(){var e=this;t("dd",e.sugResult).bind("mouseleave",function(s){t(this).children("a").removeClass("over");e.currentItem=null})},toKeyWord:function(t){if(!this.keyword){return t}else{var e=this.keyword.toLowerCase();var s=t.toLowerCase().indexOf(e);var a=e.length;if(this.keyword&&s>=0){return'<span class="keyword-contain">'+t.substring(0,s)+'<span class="'+this.classStyle.CI+'">'+t.substring(s,s+a)+"</span>"+t.substring(s+a)+"</span>"}else{return t}}},toContent:function(t,e,s,a){var i=function(t){if(t%2==1)return{isPlay:true,isCollect:true};var e=window.thirdConf,s=t.toString(2),a=s.length,i={};for(var n=0;n<a;n++){if(s[n]==1){var r=a-n-1;if(e[r].pc.is_play){i.isPlay=e[r].pc.is_play;i.isCollect=e[r].pc.is_collect;break}}}return i};if(!t.length){return}var n=this;var a=a||"search";var r=['<dl data-module="'+a+'" class = "sug-'+e+' clearfix"><dt class = "sug-title clearfix">'+s+"</dt>"];var l=0;var o=n.DefaultCdPic;var u=n.DefaultAvatarPic;var c=315;if(a=="search"){switch(e){case"artist":if(t.length<3){l=t.length}else{l=3}break;case"song":if(t.length<9-n.num){l=t.length}else{l=9-n.num}break;case"album":if(t.length<2){l=t.length}else{l=2}break;default:break}}else{l=t.length}for(var d=0;d<l;d++){n.num++;var g=t[d];var m=!(g.resource_type==2&&(g.copy_type==0||g.copy_type==2));var f="set-gray";if(l===1){r.push('<dd class = "'+n.classStyle.FIRST_ITEM+" "+n.classStyle.LAST_ITEM+'">')}else{if(d===0){r.push('<dd class = "'+n.classStyle.FIRST_ITEM+'">')}else if(d==l-1){r.push('<dd class = "'+n.classStyle.LAST_ITEM+'">')}else{r.push("<dd>")}}if(g.resource_provider){g.filter=i(g.resource_provider)}else{g.filter={isPlay:true,isCollect:true,playFee:g.playFee}}if(g.bitrate_fee){g.feeData=JSON.parse(g.bitrate_fee);if(g.feeData[0]&&g.feeData[0]=="-1|-1"){g.filter.playFee=true}else{g.filter.playFee=false}}else{g.filter.playFee=false}switch(e){case"artist":if(!!g.artistpic){u=g.artistpic}else{u=n.DefaultAvatarPic}if(Number(g.yyr_artist)==1&&Number(g.is_skip_yyr)==1){var p="_blank"}else{var p="_self"}r.push('<a target="'+p+'" class="'+(!m?f:"")+'" href="/artist/'+g.artistid+'?pst=sug"><img width="32px" height="32px" src="'+u+'" alt="'+g.artistname+'" /><span>'+n.toKeyWord(ting.cutString.cutStr(g.artistname,c-60,true,14))+"</span>"+n.yyrIconHtml(g.yyr_artist)+"</a>"+(m?n.musicIconHtml(g.artistid,"artist",g.filter):"")+"</dd>");break;case"song":var h=ting.cutString.getP(g.songname,14),v="",y="",_="",b=0;if(n.sugType=="recommend"){_='<img width="32px" height="32px" src="'+(g.songpic||n.DefaultCdPic)+'" />';b=58;c=c-b}if(g.info&&g.info!=""){y='<i class="info"> - '+g.info+"</i>"}var I=g.songid;if(Number(g.yyr_artist)==1&&Number(g.is_skip_yyr)==1){var k="_blank";var q="http://y.taihe.com/song/"+g.yyr_song_id+"?pst=sug"}else{var k="_self";var q="/song/"+I+"?pst=sug"}var w=1;if(h>=c-38){v='<a target="'+k+'" class="'+(!m?f:"")+'" href='+q+">"+_+'<span class="songname">'+n.toKeyWord(ting.cutString.cutStr(g.songname,c-17,true,14))+n.yyrIconHtml(g.yyr_artist)+n.mvIconHtml(g.songid,g.has_mv)+"</span></a>"+(m?n.musicIconHtml(g.songid,"song",g.filter,g.resource_type_ext,w):"")+"</dd>"}else if(h<c-38&&h>=c-53){v='<a target="'+k+'" class="'+(!m?f:"")+'" href='+q+">"+_+'<span class="songname">'+n.toKeyWord(g.songname)+'</span><span class="artistname">-...'+n.yyrIconHtml(g.yyr_artist)+"</span></a>"+(m?n.musicIconHtml(g.songid,"song",g.filter,g.resource_type_ext,w):"")+n.mvIconHtml(g.songid,g.has_mv)+"</dd>"}else if(h<c-53){var S=c-h-24;if(_===""){v='<a target="'+k+'" class="no-pic '+(!m?f:"")+'" href='+q+'><span class="songname">'+n.toKeyWord(g.songname)+'</span><span class="artistname"><i class="h-line">-</i>'+n.toKeyWord(ting.cutString.cutStr(g.artistname,S,true,14))+n.yyrIconHtml(g.yyr_artist)+y+"</span></a>"+(m?n.musicIconHtml(g.songid,"song",g.filter,g.resource_type_ext,w):"")+n.mvIconHtml(g.songid,g.has_mv)+"</dd>"}else{v='<a target="'+k+'" class="'+(!m?f:"")+'" href='+q+">"+_+'<span class="songname">'+n.toKeyWord(g.songname)+'</span><span class="artistname"><i class="h-line">-</i>'+n.toKeyWord(ting.cutString.cutStr(g.artistname,S,true,14))+n.yyrIconHtml(g.yyr_artist)+y+"</span></a>"+(m?n.musicIconHtml(g.songid,"song",g.filter,g.resource_type_ext,w):"")+n.mvIconHtml(g.songid,g.has_mv)+"</dd>"}}r.push(v);break;case"album":if(!!g.artistpic){o=g.artistpic}else{o=n.DefaultCdPic}var C="";var w=2;if(g.resource_type_ext==3||g.resource_type_ext==4){C='<span class="hot-sale-album" data-id="'+g.albumid+'">热卖中</span>'};r.push('<a class="'+(!m?f:"")+'" href="/album/'+g.albumid+'?pst=sug" id="album-'+g.albumid+'"><div class = "borderdiv"><span class="sidepic"></span><img width="32px" height="32px" src="'+o+'" alt="'+g.albumname+'" /></div><div>《'+n.toKeyWord(ting.cutString.cutStr(g.albumname,c-80,true,14))+"》"+C+'</div><div class="artistname album-artist-name">'+n.toKeyWord(ting.cutString.cutStr(g.artistname,c-70,true,14))+n.yyrIconHtml(g.yyr_artist)+"</div></a>"+(m?n.musicIconHtml(g.albumid,"album",g.filter,g.resource_type_ext,w):"")+"</dd>");break;case"mv":r.push('<a class="'+(!m?f:"")+'" href="/playmv/'+g.mvid+'?pst=sug">'+n.toKeyWord(ting.cutString.cutStr(g.mvname,c,true,14))+"</a></dd>");break;case"playlist":c=c-58;r.push('<a class="'+(!m?f:"")+'" href="/songlist/'+g.playlistid+'?pst=sug"> <img width="32px" height="32px" src="'+(g.playlistpic||n.DefaultCdPic)+'" /> <span class="songname">'+n.toKeyWord(ting.cutString.cutStr(g.playlistname,c,true,14))+"</span>"+n.yyrIconHtml(g.yyr_artist)+"</a>"+(m?n.musicIconHtml(g.songids.replace(/,/g,"_"),"song",g.filter):"")+"</dd>");break;default:break}}r.push("</dl>");return r.join("")},musicIconHtml:function(t,e,s,a,i){var n='<a class="list-micon icon-play" data-action="play" title="播放" href="#"></a>';var r='<a class="list-micon icon-needvip" data-action="play" title="播放" href="#"><span class="icon-text">VIP</span></a>';var l='<i class="module-line music-icon-line"></i>';var o='<a class="list-micon icon-add" data-action="add" title="添加" href="#"></a>';var u='<span class="music-icon-hook" data-log="{&quot;page&quot;:&quot;suglog&quot;,&quot;pos&quot;:&quot;sug_'+e+'&quot;}" data-musicicon="{&quot;id&quot;:&quot;'+t+"&quot;,&quot;resourceTypeExt&quot;:&quot;"+a+"&quot;,&quot;mediaType&quot;:&quot;"+i+"&quot;,&quot;type&quot;:&quot;"+e+"&quot;,&quot;iconStr&quot;:&quot;play add&quot;,&quot;moduleName&quot;:&quot;sugIcon&quot;,&quot;playFee&quot;:"+s.playFee+'}">';if(s){if(s.playFee){u+=r}else{if(s.isPlay){u+=n;if(s.isCollect){u+=l+o}}else{if(s.isCollect){u+=o}}}}else{u+=n+l+o}u+="</span>";return u},yyrIconHtml:function(t){if(t!=undefined&&t!="0"&&t!=0){var e='<span class="yyr-icon-hook"></span>'}else e="";return e},mvIconHtml:function(t,e){if(e!="0"&&e!=0&&e!=undefined){var s='<span class="mv-icon-hook">'+'<a href="/mv/'+t+'"></a>'+"</span>"}else s="";return s},format:function(e){this.num=0;var s=e.Pro,e=e.data,a={artist:"",album:"",song:""},i="",n;var r=t.browser.msie&&t.browser.version=="6.0";if(!e){return}this.sugType="search";if(e.artist){a.artist=this.toContent(e.artist,"artist","歌手")||""}if(e.album){a.album=this.toContent(e.album,"album","专辑")||""}if(e.song){a.song=this.toContent(e.song,"song","歌曲")||""}if(e.list){this.sugType="recommend";n="<h2>大家正在搜</h2>";if(e.list.song){a.rmdlist=n+this.toContent(e.list.song,"song","歌曲","hot")||""}if(e.list.artist){a.rmdartist=this.toContent(e.list.artist,"artist","歌手","hot")||""}if(e.list.mv){a.rmdmv=this.toContent(e.list.mv,"mv","MV","hot")||""}if(e.list.playlist){a.rmdplaylist=this.toContent(e.list.playlist,"playlist","歌单","hot")||""}}if(e.recommend){n="<h2>猜你喜欢</h2>";a.recommend=n+this.toContent(e.recommend.song,"song","歌曲","individuation")||""}var l=r?'<iframe src="about:blank" frameborder="0"></iframe>':"";if(s){for(var o=0;o<s.length;o++){i+=a[s[o]]}}else{for(var u in a){i+=a[u]}}return l+'<div class = "shadowleft"><div class="shadowright"><div class="'+(this.sugType=="recommend"?"rmd-layer":"")+'">'+i+"</div></div></div>"},show:function(){this.sugResult.show()},hide:function(){this.sugResult.hide()},destroy:function(){this.sugInput.unbind();this.sugResult.unbind()}})})(jQuery);

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/