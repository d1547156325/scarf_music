(function(e,t){if(typeof define==="function"&&define.amd){define(["plugin/aes","plugin/jquery.md5"],t)}else if(typeof module!=="undefined"&&module.exports){module.exports=t()}else{e.WebChat=t()}})(this,function(){window.WebSocket=window.WebSocket||window.MozWebSocket;if(!window.WebSocket){function e(e){var t={debug:false,automaticOpen:true,httpInterval:1e3,openSuccess:function(){},openError:function(){},closeSuccess:function(){},closeError:function(){},successCallBack:function(){},errorCallback:function(){}};if(!e){e={}}for(var n in t){if(typeof e[n]!=="undefined"){this[n]=e[n]}else{this[n]=t[n]}}this.url="//pollingmusic.qianqian.com:8728/push/pst/webjr";this.appid=1;var o=this;this.onopen=function(){var e={data:{protol:"1",appid:this.appid,action:"online"}};o._ajax(e).done(function(e){o.openSuccess(e)}).fail(function(e){o.openError(e)})};this.sentMessage=function(e){var t=e.msg,n=e.dst_uid,r=e.serverid,a=e.type||"1";var i={content:t,dst_uid:n,serverid:r,random_id:+new Date};var c=JSON.stringify(i);var s={data:{appid:this.appid,protol:"2",type:a,msg:c}};o._ajax(s).done(function(e){var t=e.error_code;if(t==22e3){o.successCallBack(e)}}).fail(function(e){o.errorCallback(e)});return i.random_id};this.markRead=function(e){var t=$.extend({serverid:"10002"},e);var n=JSON.stringify(t);var r={protol:"2",appid:this.appid,type:1,msg:n};o._ajax(r).done(function(e){var t=e.error_code;if(t==22e3){o.successCallBack(e)}}).fail(function(e){o.errorCallback(e)})};this._ajax=function(e){var t=e.type?e.type:"get";var n=aesEncrypt(JSON.stringify(e.data))||{};var r=e.beforeSendFun?e.beforeSendFun:"";var a=e.errorFun?e.errorFun:"";var i=e.callback?e.callback:"jsonpCallback";return $.ajax({type:t,url:o.url,dataType:"jsonp",jsonp:"callback",data:n,jsonpCallback:i,beforeSend:r,error:a,timeout:2e3})};this.getMessage=function(){var e={data:{appid:o.appid,protol:"3",type:"1"}};o._ajax(e).done(function(e){var e=$.parseJSON(aesDecrypt(e.param)),t=e.content,n=t.msg;try{n=$.parseJSON(n)}catch(r){}for(var a=0;a<t.msg_num;a++){o.successCallBack(n[a])}}).fail(function(e){o.errorCallback(e)})};this.getMessage();var r=null,a=0,i=function(){if(o.httpInterval==a){o.getMessage()}else{clearInterval(r);a=o.httpInterval;r=setInterval(i,a)}return};r=setInterval(i,o.httpInterval)}return e}else{function t(e){var n={debug:false,automaticOpen:true,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,binaryType:"blob",successCallBack:function(){},errorCallback:function(){}};if(!e){e={}}for(var o in n){if(typeof e[o]!=="undefined"){this[o]=e[o]}else{this[o]=n[o]}}if(!window.console){window.console={log:function(){},debug:function(){}}}if("https:"==document.location.protocol){this.url="wss://wssmusic.qianqian.com:9443"}else{this.url="ws://wsmusic.qianqian.com:9899"}this.reconnectAttempts=0;this.readyState=WebSocket.CONNECTING;this.protocol=null;this.appid=1;var r=this;var a;var i=false;var c=false;var s=document.createElement("div");var l=null;s.addEventListener("open",function(e){r.onopen(e)});s.addEventListener("close",function(e){r.onclose(e)});s.addEventListener("connecting",function(e){r.onconnecting(e)});s.addEventListener("message",function(e){r.onmessage(e)});s.addEventListener("error",function(e){r.onerror(e)});this.addEventListener=s.addEventListener.bind(s);this.removeEventListener=s.removeEventListener.bind(s);this.dispatchEvent=s.dispatchEvent.bind(s);function u(e,t){var n=document.createEvent("CustomEvent");n.initCustomEvent(e,false,false,t);return n}this.open=function(e){a=new WebSocket(r.url,l||[]);a.binaryType=this.binaryType;e=typeof e!="undefined"?e:false;if(e){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts){return}}else{s.dispatchEvent(u("connecting"));this.reconnectAttempts=0}if(r.debug||t.debugAll){console.debug("ReconnectingWebSocket","attempt-connect",r.url)}var n=a;var o=setTimeout(function(){if(r.debug||t.debugAll){console.debug("ReconnectingWebSocket","connection-timeout",r.url)}c=true;n.close();c=false},r.timeoutInterval);var p=setInterval(r.ping,5*60*1e3);a.onopen=function(n){clearTimeout(o);if(r.debug||t.debugAll){console.debug("ReconnectingWebSocket","onopen",r.url)}r.protocol=a.protocol;r.readyState=WebSocket.OPEN;r.reconnectAttempts=0;var i=u("open");i.isReconnect=e;e=false;s.dispatchEvent(i);var c={protol:"1",appid:r.appid,action:"online"};r.send(c)};a.onclose=function(n){clearTimeout(p);a=null;if(i){r.readyState=WebSocket.CLOSED;s.dispatchEvent(u("close"));var o={protol:"1",appid:r.appid,action:"offline"};r.send(o)}else{r.readyState=WebSocket.CONNECTING;var l=u("connecting");l.code=n.code;l.reason=n.reason;l.wasClean=n.wasClean;s.dispatchEvent(l);if(!e&&!c){if(r.debug||t.debugAll){console.debug("ReconnectingWebSocket","onclose",r.url)}s.dispatchEvent(u("close"))}var p=r.reconnectInterval*Math.pow(r.reconnectDecay,r.reconnectAttempts);setTimeout(function(){r.reconnectAttempts++;r.open(true)},p>r.maxReconnectInterval?r.maxReconnectInterval:p)}};a.onmessage=function(e){var n=u("message");n.data=e.data;s.dispatchEvent(n);var o=$.parseJSON(e.data);var a=aesDecrypt(o.param);if(r.debug||t.debugAll){console.debug("ReconnectingWebSocket","onmessage",r.url,e.data);console.debug("ReconnectingWebSocket","onmessage",r.url,a)}var i=$.parseJSON(a);r.successCallBack(i)};a.onerror=function(e){if(r.debug||t.debugAll){console.debug("ReconnectingWebSocket","onerror",r.url,e)}s.dispatchEvent(u("error"))}};if(this.automaticOpen==true){this.open(false)}this.send=function(e){if(a){dataStr=JSON.stringify(e);encodeDataStr=JSON.stringify(aesEncrypt(dataStr));if(r.debug||t.debugAll){console.debug("ReconnectingWebSocket","send",r.url,dataStr);console.debug("ReconnectingWebSocket","send",r.url,encodeDataStr)}try{return a.send(encodeDataStr)}catch(n){}}else{if(r.debug||t.debugAll){console.debug("INVALID_STATE_ERR : Pausing to reconnect websocket")}}};this.close=function(e,t){if(typeof e=="undefined"){e=1e3}i=true;if(a){a.close(e,t)}};this.refresh=function(){if(a){a.close()}};this.sentMessage=function(e){var n=e.msg,o=e.dst_uid,a=e.serverid,i=e.type||"1";if(this.debug&&(n==""||o==""||a=="")){if(r.debug||t.debugAll){console.log("params error")}return false}var c={content:n,dst_uid:o,serverid:a,random_id:+new Date};var s=JSON.stringify(c);var e={protol:"2",appid:r.appid,type:i,msg:s};r.send(e);return c.random_id};this.ping=function(){var e={protol:"3",appid:r.appid,action:"ping"};r.send(e)};this.markRead=function(e){var t=$.extend({serverid:"10002"},e);var n=JSON.stringify(t);var o={protol:"2",appid:r.appid,type:1,msg:n};r.send(o)}}t.prototype.onopen=function(e){};t.prototype.onclose=function(e){};t.prototype.onconnecting=function(e){};t.prototype.onmessage=function(e){};t.prototype.onerror=function(e){};t.debugAll=false;t.CONNECTING=WebSocket.CONNECTING;t.OPEN=WebSocket.OPEN;t.CLOSING=WebSocket.CLOSING;t.CLOSED=WebSocket.CLOSED;return t}});function jsonpCallback(){}var JSON=JSON||{};JSON.stringify=JSON.stringify||function(e){var t=typeof e;if(t!="object"||e===null){if(t=="string")e='"'+e+'"';return String(e)}else{var n,o,r=[],a=e&&e.constructor==Array;for(n in e){o=e[n];t=typeof o;if(t=="string")o='"'+o+'"';else if(t=="object"&&o!==null)o=JSON.stringify(o);r.push((a?"":'"'+n+'":')+String(o))}return(a?"[":"{")+String(r)+(a?"]":"}")}};function aesEncrypt(e){var t=$.md5("9a3c4e75da5e063c"),t=t.substr(8,16),n=t;var o={stringify:function(e){var t={ct:e.ciphertext.toString(CryptoJS.enc.Base64)};if(e.iv){t.iv=e.iv.toString()}if(e.salt){t.s=e.salt.toString()}return t},parse:function(e){var t=JSON.parse(e);var n=CryptoJS.lib.CipherParams.create({ciphertext:CryptoJS.enc.Base64.parse(t.ct)});if(t.iv){n.iv=CryptoJS.enc.Hex.parse(t.iv)}if(t.s){n.salt=CryptoJS.enc.Hex.parse(t.s)}return n}};var r=CryptoJS.enc.Utf8.parse(t);var n=CryptoJS.enc.Utf8.parse(t);var a=CryptoJS.AES.encrypt(e,r,{iv:n,blockSize:16,mode:CryptoJS.mode.CBC,format:o});var i=a.toString().ct;var c={param:i};return c}function aesDecrypt(e){var t=$.md5("9a3c4e75da5e063c"),t=t.substr(8,16);var n=CryptoJS.enc.Utf8.parse(t);var o=CryptoJS.enc.Utf8.parse(t);var r=CryptoJS.AES.decrypt(e,n,{iv:o,mode:CryptoJS.mode.CBC});return CryptoJS.enc.Utf8.stringify(r).toString()}

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/