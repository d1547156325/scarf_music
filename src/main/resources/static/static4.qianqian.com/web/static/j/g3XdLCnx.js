var AsyncDOM,CONFIG,DEBUG,Debugger,jQueryLoadModule,tools,util;CONFIG={DEBUG:true&&location.search.indexOf("AD")!==-1};DEBUG=CONFIG.DEBUG;if(CONFIG.DEBUG===true){CONFIG.bufferHeight=-30}tools={getAttribute:function(e){var t,n;n={};e=e.replace(/,\s*/g,",");t=/([\w]*)[\s]*=[\s]*([\w\/._,]*)/g;e.replace(t,function(e,t,r){return n[t]=r});return n},regJS:/<script([^>]*)>([\w\W]*?)<\/script>/g,filterJS:function(e){var t,n;t="";n=e.replace(this.regJS,function(e,n,r,o,i){t+=r;return""});return{remain:n,matched:t}},exec:function(e,t){return new Function(e).call(t)},_prepareHTML:function(e){var t,n;t=this.filterJS(e);return n={js:t.matched,dom:t.remain}},loadHtml:function(e,t){var n;n=this._prepareHTML(e);if(n.dom){if(n.dom.replace(/(^\s*)|(\s*$)/g,"").length>0){t.html(n.dom)}}if(n.js){return this.exec(n.js,t)}},debug:function(e){if(!CONFIG.DEBUG){return}Debugger.showInfo(e);e.css("padding","1px");return e.css("background","red")},loadAjaxData:function(){var e,t;e=this;t=e.data("url");if(!t){return}$.ajax({url:t,dataType:"json"}).done(function(t){e.html(t.data.html);e.removeClass("css-loading");return new Function(t.data.js).call(e)}).fail(function(){var n;e.html("<div class='async-module-error'><a href='#'>长时间没有响应，点击重新加载</a></div>");n=e.find(".async-module-error");n.css({position:"relative",top:e.height()/2+20,left:e.width()/2-90});return n.on("click",function(n){n.preventDefault();tools.loadAjaxData.call(e,t);return e.html("")})})}};util={reg_JS:/<script([^>]*)>([\w\W]*?)<\/script>/g,reg_comment_wrapper:/(^<\!--)|(-->$)/g};AsyncDOM=function(){function e(e,t){this.root=e;this.domStr=t;this.load(e)}e.prototype.filterJS=function(e){var t,n;t="";n=e.replace(util.reg_JS,function(e,n,r,o,i){t+=r;return""});return{remain:n,matched:t}};e.prototype.exec=function(e,t){return new Function(e).call(t)};e.prototype._prepareHTML=function(e){var t;t=this.filterJS(e);return{js:t.matched,dom:t.remain}};e.prototype.load=function(e){var t,n,r,o;DEBUG&&(o=[]);n=this.domStr.replace(/(^\s*)|(\s*$)/g,"");if(n.indexOf("<!--")===-1){return}DEBUG&&o.push(new Date);r=n.replace(util.reg_comment_wrapper,"");t=this._prepareHTML(r);DEBUG&&o.push(new Date);if(t.dom){if(t.dom.replace(/(^\s*)|(\s*$)/g,"").length>0){e.html(t.dom)}}DEBUG&&o.push(new Date);if(t.js){this.exec(t.js,e)}DEBUG&&o.push(new Date);return DEBUG&&this.debug(e,t,o)};e.prototype.debug=function(e,t,n){var r;e.css("position","relative");r=Debugger.genInfo(t,n);e.append(r);return this.observe(e,function(){return e.append(r)})};e.prototype.observe=function(e,t){var n,r;r=new MutationObserver(function(e){t&&t();return r.disconnect()});n={attributes:true,childList:true,characterData:true};return r.observe(e[0],n)};return e}();Debugger={id:0,genInfo:function(e,t){var n,r,o,i,a,s,c;i=[];c=t.slice(0,t.length-1);for(r=a=0,s=c.length;a<s;r=++a){o=c[r];i[r]=t[r+1]-t[r]}if(e.dom){n='<textarea rows="10">'+e.dom+"</textarea>"}else{n="——"}return $("<div class='amd'>\n    <div class='title'>ID: "+this.id++ +"</div>\n    <div class='content'>\n        <div class='section'>渲染时间(ms)：\n            <div class='row'>解析DOM："+i[0]+"</div>\n            <div class='row'>DOM插入："+i[1]+"</div>\n            <div class='row'>JS执行："+(i[2]||0)+'</div>\n        </div>\n\n        <div class="section">JS內容：\n            <div class="row">'+(e.js||"无")+"</div>\n        </div>\n    </div>\n</div>")},showInfo:function(e){var t,n,r,o,i;i=e.data("type");n=e.html();r=e.html().replace(/(^\s*)|(\s*$)/g,"").replace(/(<\!--)|(-->)/g,"");o=new Date;t=$("<div class='amd'>\n    <div class='title'>\n        ID: "+this.id+", TYPE: <span class='em'>"+i+"</span><span class='time'>"+(o.toTimeString().slice(0,9)+o.getMilliseconds())+"</span>\n    </div>\n\n    <div>\n        <span><button onclick='showSourceCode(this)'>原始HTML</button><textarea>"+n+"</textarea></span>\n        <span><button onclick='showSourceCode(this)'>解析出的代码</button><textarea>"+r+"</textarea></span>\n    </div>\n</div>");t.insertBefore(e);return this.id++},_init:function(){if(!CONFIG.DEBUG){return}$("<style type='text/css'>\n  .amd {background: #CCE8CF; position: absolute; z-index: 1314;top: 0;opacity: .9;width: 100%;height: 100%;left:0;}\n  .amd.html{background: }\n.amd .title{background: lightgreen;}\n.amd .section .row{padding-left: 20px;}\n.amd .em {color: darkred; font-weight: bold}\n.amd textarea{width: 100%}\n.amd .time {float: right;}\n\n#amd-code {\n    position: fixed;\n    left: 0;\n    top: 0;\n    background: #CCE8CF;\n    width: 450px;\n    height: 100%;\n}\n  </style>").appendTo("head");return window.showSourceCode=function(e){if(!e.show){$("#amd-code").remove();e.show=true;return $("<textarea id='amd-code'>"+$(e).next().html()+"</textarea>").appendTo("body")}else{e.show=false;return $("#amd-code").remove()}}}()};$.fn.loadModule=jQueryLoadModule=function(){var e,t;try{t=this.data("type");switch(t){case"ajax":tools.debug(this);return tools.loadAjaxData.call($(this));default:return new AsyncDOM(this,this.html())}}catch(n){e=n;if(CONFIG.DEBUG){throw e}}};(function(){var e,t,n,r;r=$(".async-module");e=$(window);t=function(t){var o,i,a,s,c,d,l,u,f,h;if(t==null){t=0}DEBUG&&(d=new Date);a=0;i=0;c=e.scrollTop();u=e.height();for(o=f=0,h=r.length;f<h;o=f+=1){s=r.eq(o);if(s[0]!==void 0){l=s.offset().top;if(l<c+u+t&&c-t-s.height()<l){s.loadModule();delete r[o];i++}else{a++}}}DEBUG&&i&&console.log("[Async Module]:#加载的模块数"+i+"  # 执行时间: "+(new Date-d)+"ms");DEBUG&&!a&&console.log("[Async Module]:[DONE] 全部异步模块加载完成");if(a===0){e.off("scroll",n)}};n=function(){clearTimeout(arguments.callee.tid);return arguments.callee.tid=setTimeout(function(){return t(CONFIG.bufferHeight||e.height()/2)},50)};if(r.length>0){e.on("scroll",n);return t()}})();

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/