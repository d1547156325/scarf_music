define(["core/utils","tmpl/rank/redrank/redUserInfoTmpl","tmpl/rank/redrank/upHistoryTmpl","tmpl/rank/redrank/daBangTaiTmpl","tmpl/rank/redrank/shouHuTuanTmpl","tmpl/rank/redrank/fenSiBangTmpl","widget/toast/toast","page/rank/redrank/common","domain_config"],function(i,t,e,a,n,o,s,l,r){var u=$(".ubang-detail"),c=false,d=u.data("artistid")||0,f=u.data("tab")||"",h=u.data("isbuy")||"",p=["getRedBillList","getProBill","getFansBill"],m=$(".ubang-detail-info"),g=$(".ubang-list-box"),b=$(".ubang-dabang"),v=$(".ubang-shouhu"),w=$(".ubang-fensi"),k=$(".last-line"),_=$(".loading-ubang"),y=$(".xingyunchi-value"),T=$(".xingyunchi-zan"),x=$(".top-list-nav"),U=p[0],C=true,A,F={offset:0,limit:10,have_more:1},B=function(){i.tingApi("baidu.ting.active.getRedUserInfo",{artist_id:d}).done(function(i){if(i.error_code==22e3){var e=t({item:i.result});A=i.result.name;m.html(e);var a=$(".mui-slider");if(a){a.slider({autoPlay:true,hoverShowController:true,speed:250,delay:5e3})}bdShare({bdText:"千千音乐U榜艺人",bdDesc:i.result.name+"正在千千音乐U榜进行打榜，快来一起支持吧！！",bdUrl:r.host+"/cms/webview/celebrity_list/v1/#/dbinfo-page/"+d,bdPic:i.result.pic_list[0]})}}).fail(function(i){u.html('<p class="reload-ubang">看你萌的，服务器都开小差了，3秒后重新来过吧!');setTimeout(function(){location.reload()},3e4)});if(f=="fensibang"){U=p[2];x.find("a").removeClass("active");$(".fensibangs").addClass("active")}k.hide();D({dataUrl:"baidu.ting.active."+U,_param:{offset:0,limit:10,artist_id:d}});N()},L=function(){var t=$(".friend-btn-hook").data("fid")||0;i.tingApi("baidu.ting.ugcfriend.doFriend",{fid:t,type:1}).done(function(i){if(d){l.addUpNums({artist_id:d,add_type:"follow"})}if(i.isFriend==1){var t="已关注"}else if(i.isFriend==2){var t="互相关注"}$(".follow-hook").removeClass("follow").html(t);s.show({data:{cls:"succ",text:"关注成功"}})}).fail(function(i){if(i.error_code==22452){ting.passport.checkLogin(function(){window.location.reload()})}else{s.show({data:{cls:"fail",text:"关注失败"}})}})},N=function(){u.on("click",".add-top-num",function(){P()}).on("click",".up-history",function(){S()}).on("click",".task-btn",function(){showTask()}).on("click",".task-close",function(){hideTask()}).on("click",".close-buy-shou",function(){z()}).on("click",".dabangtai",function(){x.find("a").removeClass("active");$(this).addClass("active");C=true;U=p[0];D({dataUrl:"baidu.ting.active."+U,_param:{offset:0,limit:10,artist_id:d}})}).on("click",".shouhutuan",function(){x.find("a").removeClass("active");$(this).addClass("active");U=p[1];C=true;D({dataUrl:"baidu.ting.active."+U,_param:{offset:0,limit:10,artist_id:d}})}).on("click",".fensibangs",function(){x.find("a").removeClass("active");$(this).addClass("active");U=p[2];C=true;D({dataUrl:"baidu.ting.active."+U,_param:{offset:0,limit:10,artist_id:d}})}).on("click",".xingyunchi-zan",function(){I()}).on("click",".follow",function(){L()}).on("click",".close-up-history",function(){H()}).on("click",".buy-shouhu-btn",function(){R()})},z=function(){var i=$(".buy-shouhu");var t=$(".buy-shouhu-bg");i.hide();t.hide()},P=function(){var i=$(".buy-shouhu");var t=$(".buy-shouhu-bg");i.show();t.show()},S=function(){if(d){i.tingApi("baidu.ting.active.getUpHistory",{artist_id:d}).done(function(i){u.append(e({item:i.result}));setTimeout(function(){$(".up-history-box").addClass("pop-show")},100)}).fail(function(i){})}},H=function(){$(".up-history-box").removeClass("pop-show");setTimeout(function(){$(".up-history-box").remove()},500)},I=function(){var t=$(".xingyunchi-zan-value");ting.passport.checkLogin(function(){if(Number(t.html())>0){i.tingApi("baidu.ting.active.addPoolScore",{artist_id:d}).done(function(i){if(i.error_code==22e3){var e=$(".xingyunchi-value");e.html(Number(e.html())+1);t.html(Number(t.html())-1);if(Number(e.html())>=2e3){e.html(0)}s.show({data:{cls:"succ",text:"恭喜您拼攒成功"}})}}).fail(function(i){s.show({data:{cls:"fail",text:"一小时只能拼攒一次哦"}})})}})},R=function(){ting.passport.checkLogin(function(){var t={type_id:"shouhu",type:5,action:"cloud",pay_type:"zfb",pay_client_type:2,artist_id:d,callback_url:r.host+"/redrank/artist/"+d+"?isbuy=1"};i.tingApi("baidu.ting.pay.sorder",t).done(function(i){window.open(i.result.desk_url)}).fail(function(i){if(i.error_code==22452){ting.passport.checkLogin(function(){window.location.reload()})}else{s.show({data:{cls:"fail",text:"操作失败，请稍后重试！"}})}})})},D=function(t){var t=t||{};if(F.have_more==0){}if(!t){return false}_.show();if(C){g.find("ul").html("");F={offset:0,limit:10,have_more:0}}c=true;i.tingApi(t.dataUrl,t._param).done(function(i){c=false;if(i.error_code==22e3){var t="";for(var e=0;e<i.result.length;e++){i.result[e].key=e+F.offset}if(U===p[0]){t=a({item:i.result});if(C){b.html(t)}else{b.append(t)}}else if(U===p[1]){t=n({item:i.result});if(C){v.html(t)}else{v.append(t)}}else if(U===p[2]){t=o({item:i.result});if(C){w.html(t)}else{w.append(t)}}if(i.have_more){F.offset=F.offset+10;k.hide()}else{k.show()}F.have_more=i.have_more;$(window).bind("scroll",q)}_.hide();$(".no-data-text").remove()}).fail(function(i){c=false;$(window).bind("scroll",q);if(U===p[0]){b.html("<p class='no-data-text'>TA暂无打榜专辑，稍后再来看看！</p>")}else if(U===p[1]){v.html("<p class='no-data-text'>TA还无人守护，快来成为ta的第一个守护天使吧！</p>")}else if(U===p[2]){w.html("<p class='no-data-text'>TA还没有粉丝，快成为ta的第一个真爱粉！</p>")}_.hide();k.hide()})},j=0,q=function(){var i=parseFloat($(window).scrollTop());totalheight=parseFloat($(window).height())+i;if(parseFloat($(window).scrollTop())<=j){j=parseFloat($(window).scrollTop());return false}j=parseFloat($(window).scrollTop());if(c==true){return false}if($(document).height()-50<=totalheight){$(window).unbind("scroll");if(F.have_more){C=false;D({dataUrl:"baidu.ting.active."+U,_param:{offset:F.offset,limit:10,artist_id:d}})}}};showTask=function(i){$(".task-box").show()};hideTask=function(i){$(".task-box").hide()};B();E();function E(){$(".share-list").live("click",function(){ting.logger.log("share",{page:"艺人页",sub:"",pos:"",contenttype:"artist",content:d,artistname:A})})}});

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/