(function(e,i){var t={add:"icon-add",collect:"icon-collect",download:"icon-download",play:"icon-play",playlist:"icon-playlist",recommend:"icon-recommend",songword:"icon-songword",subscribe:"icon-subscribe",send:"icon-send"};function n(e){var i=document.createElement("div");i.innerHTML=e;try{return i.childNodes[0].nodeValue}catch(t){return e}}e.widget("ting.musicIcon",{options:{songId:null,hasTip:true,songName:null},_create:function(){var i=this,n=i.element,o=i.options,a=(n.data("musicicon")?n.data("musicicon").iconStr:o.iconStr)||"",s=a.replace(/^\s+/,""),r=s.split(" "),c,l,p;if(r.length<=1){for(p in t){r.push(p)}}i.icons={};for(var d=0,g=r.length;d<g;d+=1){l=r[d];c=t[l];if(c){i.icons["$"+l]=e("."+c,i.element)}}i._initEvent()},log:function(e){var i=window.location.pathname.split("/"),t=i[2]=="collection"?"select":i[1]||"home";ting.logger.log("singleDown",{source:t,sid:e})},_initEvent:function(){var i=this,t=i.element,o=i.icons;var a=t.data("musicicon")?t.data("musicicon"):"",s={moduleName:a.moduleName||"",resourceTypeExt:a.resourceTypeExt||"",mediaType:a.mediaType};if(o.$play){o.$play.bind("click",function(t){var r=a.type||i.options.type,c="playSong";switch(r){case"song":c="playSong";break;case"album":c="playAlbum";break;case"diy":c="playDiy";break;case"artist":c="playArtist";break}if(s.resourceTypeExt&&(s.resourceTypeExt==3||s.resourceTypeExt==4)){if(s.mediaType==1){s.id=a.id;ting.checkSellResourse(s.id,"",function(e){s.isPay=e;if(s.isPay!=1||s.siPresaleFlag==1){ting.media.checkToSellPage(s)}else{l()}})}if(s.mediaType==2){s.albumId=a.id;ting.checkSellResourse("",s.albumId,function(e,i){s.isPay=i;if(s.isPay!=1||s.aiPresaleFlag==1){ting.media.checkToSellPage(s)}else{l()}})}}else{l()}function l(){ting.media[c](n(a.id||i.options.id),s);if(i.options.hasTip){if(r=="song"&&(a.kr_top=="1"||a.kr_top=="2")){var t=e("#krPlayTip");if(!t.length){t=e("<div>",{id:"krPlayTip","class":"kr-play-tip",html:'<span class="tip-arrow"></span><a target="_blank" href="http://static4.qianqian.com/king/top">King榜</a>打榜歌曲，<a target="_blank" href="http://static4.qianqian.com/king/legal#listen-rule">有效试听</a>可提升排名'}).appendTo("body");e(document).bind("mousedown",function(i){if(e.contains(e("#krPlayTip")[0],i.target)){return false}e("#krPlayTip").hide()})}t.attr("style","left:"+(o.$play.offset().left-(t.outerWidth()-o.$play.outerWidth())/2)+"px;"+"top:"+(o.$play.offset().top+o.$play.outerHeight()+8)+"px");t.show()}else{e(this).tip().tip("tipup",{msg:"已开始播放",iconClass:"tip-success"})}}}if(ting&&ting.logger&&ting.logger.plogClick){ting.logger.plogClick("play_"+r)}if(ting.browser.isSpecial()){ting.browser.add2box("play")}return false})}if(o.$recommend){o.$recommend.bind("tip.confirm",function(e,t){var n=a||i.options;n.description=t._textarea.val();ting.connect.recommend(null,n,function(e){o.$recommend.tip({contentType:"text",showTime:1e3,button:null}).tip("tipup",{msg:"推荐成功",iconClass:"tip-success"})},function(e){o.$recommend.tip({contentType:"text",showTime:1e3,button:null}).tip("tipup",{msg:e.errorMessage||"推荐失败",iconClass:"tip-error"})})}).bind("tip.cancel",function(e,i){if(i._textarea.val()){i._textarea.val("");i.textareaCheck();return false}else{return true}});o.$recommend.bind("click",function(e){ting.passport.checkLogin(function(){},function(){},function(){},function(){},{ref:"pop_web",operation:true});return false})}if(o.$collect){o.$collect.tip();var r={page:ting.logger.getPage(),pos:"collect_song",songcount:1};o.$collect.bind("click",function(n){var s=Number(t.data("musicicon").yyr_song_id),c=Number(t.data("musicicon").id);if(s){if(!ting.userInfo){ting.passport.checkLogin(function(){});return false}e.ajax({url:"http://y.taihe.com/data/song/favorite/add",type:"POST",dataType:"jsonp",data:{songId:c,from:"play"}}).done(function(i){if(i.errorCode!=22e3){if(i.errorCode==22322){e(o.$collect).tip("tipup",{msg:"歌曲已被保存",iconClass:"tip-error"});return false}var t=e('<div style="text-align: left;">您需要访问 <a target="_blank" href="http://y.baidu.com/">太合音乐人</a>平台，完成音乐收藏。</div>');t.dialog({className:"dialog-message",showBtn:true,confirm:{btn:"",close:true,callback:function(){window.open("http://y.taihe.com/song/"+s+"?buy="+s)},text:"立即去收藏"},cancel:false,destroy:true,title:"&nbsp;",width:360,showBg:true}).dialog("show")}else{e(o.$collect).tip("tipup",{msg:"已保存到我的收藏",iconClass:"tip-success"})}});return false}if(a.pay_type&&a.pay_type==="1"){var c=a.id,l=encodeURIComponent(window.location.pathname);if(/^\d+$/.test(c)){link="/song/"+c+"/collect?resource=kingfav&__o="+l}window.open(link,"","height=435,width=785,status=no,toolbar=no,menubar=no,location=no");ting.logger.plogClick("fav_music",c);return false}ting.connect.collect(null,{ids:a.id||i.options.id,type:a.type||i.options.type},function(i){e(o.$collect).tip("tipup",{msg:"已保存到我的收藏",iconClass:"tip-success"});if(ting&&ting.logger){r.state=1;ting.logger.log("collect",r)}if(ting.browser.isSpecial()){ting.browser.add2box("collect")}ting.media.collectSong(a.id)},function(i){var t="tip-error";switch(i.errorCode){case 22322:t="tip-warning";i.errTip="歌曲已被保存";break;case 22331:i.errTip="云空间已满，去<a href ='http://yinyueyun.baidu.com/' target = '_blank'>整理云空间</a>吧！";break;case 22232:i.errTip="对不起，千千音乐只能在中国内地提供服务";break;default:i.errTip="操作失败，请稍候再试";break}var n={msg:i.errTip?i.errTip:"操作失败",iconClass:t};if(i.errorCode=22331){n.showTime=5e3}if(ting&&ting.logger){r.state=i.errorCode;ting.logger.log("collect",r)}e(o.$collect).tip("tipup",n)});return false})}if(o.$subscribe){o.$subscribe.tip();o.$subscribe.bind("click",function(t){ting.connect.collect(null,{ids:a.id||i.options.id,type:a.type||i.options.type},function(i){e(o.$subscribe).tip("tipup",{msg:"已收录",iconClass:"tip-success"});ting.media.collectSong(a.id)},function(i){if(i.errorCode=="22322"){e(o.$subscribe).tip("tipup",{msg:"该自选辑已被收录",iconClass:"tip-error"})}else{e(o.$subscribe).tip("tipup",{msg:i.errorMessage||"收录失败",iconClass:"tip-error"})}});return false})}if(o.$add){o.$add.bind("click",function(t){var o=a.type||i.options.type,r="playSong";switch(o){case"song":r="addSong";break;case"album":r="addAlbum";break;case"diy":r="addDiy";break;case"artist":r="addArtist";break}if(s.resourceTypeExt&&(s.resourceTypeExt==3||s.resourceTypeExt==4)){if(s.mediaType==1){s.id=a.id;ting.checkSellResourse(s.id,"",function(e){s.isPay=e;if(s.isPay!=1||s.siPresaleFlag==1){ting.media.checkToSellPage(s)}else{c()}})}if(s.mediaType==2){s.albumId=a.id;ting.checkSellResourse("",s.albumId,function(e,i){s.isPay=i;if(s.isPay!=1||s.aiPresaleFlag==1){ting.media.checkToSellPage(s)}else{c()}})}}else{c()}function c(){ting.logger.log("siteToBox",{operation:"click_add_icon"});ting.media[r](n(a.id||i.options.id),s);if(ting&&ting.logger&&ting.logger.plogClick){ting.logger.plogClick("add_"+o)}if(i.options.hasTip){e(this).tip().tip("tipup",{msg:"添加成功！",iconClass:"tip-success"})}}if(ting.browser.isSpecial()){ting.browser.add2box("play")}return false})}if(o.$download){o.$download.bind("click",function(n){var o=Number(t.data("musicicon").yyr_song_id);if(o){if(!ting.userInfo){ting.passport.checkLogin(function(){});return false}var s=e('<div style="text-align: left;">您需要访问 <a target="_blank" href="http://y.baidu.com/">太合音乐人</a>平台，获取音乐下载。</div>');s.dialog({className:"dialog-message",showBtn:true,confirm:{btn:"",close:true,callback:function(){window.open("http://y.taihe.com/song/"+o+"?buy="+o)},text:"立即去下载"},cancel:false,destroy:true,title:"&nbsp;",width:360,showBg:true}).dialog("show");return false}if(parseInt(a.pay_type,10)!=3){ting.media.downloadSong(a.id||i.options.id)}else{ting.media.downloadSong(a.id||i.options.id,"",true)}i.log(a.id||i.options.id);if(ting&&ting.logger&&ting.logger.plogClick){ting.logger.plogClick("down_song")}return false})}if(o.$songword){o.$songword.bind("click",function(e){ting.media.lyric(a.id||i.options.id);return false})}if(o.$send){require(["../../../../m.baidu.com/static/as/res2exe/js/res2exe_1.0.4.min.js"/*tpa=http://m.baidu.com/static/as/res2exe/js/res2exe_1.0.4.min.js*/],function(){o.$send.sendByClient({songId:a.id||i.options.id}).on("click",function(e){e.preventDefault();o.$send.sendByClient("down");ting.logger.log("click",{page:ting.logger.getPage(),pos:"to_app",songid:a.id})})})}}});e(function(){e(".music-icon-hook").musicIcon()})})(jQuery);

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/