(function(i,e){var t={add:"icon-add",collect:"icon-collect",collects:"icon-collects",download:"icon-download",play:"icon-play",playlist:"icon-playlist",recommend:"icon-recommend",songword:"icon-songword",subscribe:"icon-subscribe",send:"icon-send",jump:"icon-jump",needvip:"icon-needvip"};function o(i){var e=document.createElement("div");e.innerHTML=i;try{return e.childNodes[0].nodeValue}catch(t){return i}}function n(i,e){ting.showTip({$tar:i,type:"needgoldvip",cancelEvent:"blur",reason:e})}i.widget("ting.musicIcon",{options:{songId:null,hasTip:true,songName:null},_create:function(){var e=this,o=e.element,n=e.options,s=o.data("musicicon")?o.data("musicicon"):"",a=(o.data("musicicon")?o.data("musicicon").iconStr:n.iconStr)||"",l=a.replace(/^\s+/,""),r=l.split(" "),c,g,p;if(r.length<=1){for(p in t){r.push(p)}}e.icons={};for(var d=0,u=r.length;d<u;d+=1){g=r[d];if(g=="play"&&s.is_jump){g="jump"}if(g=="play"&&s.playFee){g="needvip"}c=t[g];if(c){e.icons["$"+g]=i("."+c,e.element)}}e._initEvent()},log:function(i){var e=window.location.pathname.split("/"),t=e[2]=="collection"?"select":e[1]||"home";ting.logger.log("singleDown",{source:t,sid:i})},_initEvent:function(){var e=this,t=e.element,s=e.icons;var a=t.data("musicicon")?t.data("musicicon"):"",l={moduleName:a.moduleName||"",searchValue:a.searchValue||"",id:a.id||"",mediaType:1,albumId:a.albumId||"",siPresaleFlag:a.siPresaleFlag||"",resourceTypeExt:a.pay_type||"",songPic:a.songPic||"",songTitle:a.songTitle||"",songPublishTime:a.songPublishTime||""};if(s.$play){s.$play.bind("click",function(t){var n=a.type||e.options.type,r="playSong";var c={page:ting.logger.getPage(),pos:"play_song",songcount:1};switch(n){case"song":r="playSong";break;case"album":r="playAlbum";break;case"diy":r="playDiy";break;case"artist":r="playArtist";break}if(l.resourceTypeExt&&(l.resourceTypeExt==3||l.resourceTypeExt==4)){ting.checkSellResourse(l.id,l.albumId,function(i){l.isPay=i;ting.media[r](o(a.id||e.options.id),l);if(l.isPay!=1||l.siPresaleFlag==1){g("notTip")}else{g()}});c.song_title=l.songTitle;c.song_id=l.id;c.isPay=2}else{ting.media[r](o(a.id||e.options.id),l);g()}function g(o){o=o||"";if(e.options.hasTip){if(n=="song"&&(a.kr_top=="1"||a.kr_top=="2")){var l=i("#krPlayTip");if(!l.length){l=i("<div>",{id:"krPlayTip","class":"kr-play-tip",html:'<span class="tip-arrow"></span><a target="_blank" href="http://static4.qianqian.com/king/top">King榜</a>打榜歌曲，<a target="_blank" href="http://static4.qianqian.com/king/legal#listen-rule">有效试听</a>可提升排名'}).appendTo("body");i(document).bind("mousedown",function(e){if(i.contains(i("#krPlayTip")[0],e.target)){return false}i("#krPlayTip").hide()})}l.attr("style","left:"+(s.$play.offset().left-(l.outerWidth()-s.$play.outerWidth())/2)+"px;"+"top:"+(s.$play.offset().top+s.$play.outerHeight()+8)+"px");l.show()}else{if(o!="notTip"){i(t.target).tip().tip("tipup",{msg:"已开始播放",iconClass:"tip-success"})}}}}if(ting&&ting.logger&&ting.logger.plogClick){ting.logger.plogClick("play_"+n);ting.logger.log("play",c)}if(ting.browser.isSpecial()){ting.browser.add2box("play")}return false})}if(s.$needvip){s.$needvip.bind("click",function(t){var s=i(this);var r=a.id||e.options.id,c=c||"";ting.checkSellResourse(r,c,function(i){var t=i;if(BDUS&&BDUS.vipState!="gold"&&t!=1){n(s,"pay_listen")}else{var r=a.type||e.options.type;var c="playSong";switch(r){case"song":c="playSong";break;case"album":c="playAlbum";break;case"diy":c="playDiy";break;case"artist":c="playArtist";break}ting.media[c](o(a.id||e.options.id),l)}})})}if(s.$recommend){s.$recommend.bind("tip.confirm",function(i,t){var o=a||e.options;o.description=t._textarea.val();ting.connect.recommend(null,o,function(i){s.$recommend.tip({contentType:"text",showTime:1e3,button:null}).tip("tipup",{msg:"推荐成功",iconClass:"tip-success"})},function(i){s.$recommend.tip({contentType:"text",showTime:1e3,button:null}).tip("tipup",{msg:i.errorMessage||"推荐失败",iconClass:"tip-error"})})}).bind("tip.cancel",function(i,e){if(e._textarea.val()){e._textarea.val("");e.textareaCheck();return false}else{return true}});s.$recommend.bind("click",function(i){ting.passport.checkLogin(function(){},function(){},function(){},function(){},{ref:"pop_web",operation:true});return false})}if(s.$collects){s.$collects.tip();var r={page:ting.logger.getPage(),pos:"collect_song",songcount:1},c="";s.$collects.bind("click",function(e){c=i(this).parents(".fun-icon");e.stopPropagation();var t=c.closest("li").index();ting.passport.checkLogin(function(){require(["widget/ucollect_to/ucollect_to"],function(i){i.createSonglists(t,a.id,c)});i(".fun-icon").off().on("click",".mylist-mysinglesong",g)})});function g(o){i(".mylist-mysinglesong").die("click",g);i(".songlist-collect-to").hide();var n=Number(t.data("musicicon").yyr_song_id),l=Number(t.data("musicicon").id);if(n){if(!ting.userInfo){ting.passport.checkLogin(function(){});return false}i.ajax({url:"http://y.taihe.com/data/song/favorite/add",type:"POST",dataType:"jsonp",data:{songId:l,from:"play"}}).done(function(e){if(e.errorCode!=22e3){if(e.errorCode==22322){i(s.$collect).tip("tipup",{msg:"歌曲已被保存",iconClass:"tip-error"});return false}var t=i('<div style="text-align: left;">您需要访问 <a target="_blank" href="http://y.baidu.com/">太合音乐人</a>平台，完成音乐收藏。</div>');t.dialog({className:"dialog-message",showBtn:true,confirm:{btn:"",close:true,callback:function(){window.open("http://y.taihe.com/song/"+n+"?buy="+n)},text:"立即去收藏"},cancel:false,destroy:true,title:"&nbsp;",width:360,showBg:true}).dialog("show")}else{i(s.$collect).tip("tipup",{msg:"已保存到我的收藏",iconClass:"tip-success"})}});return false}if(!c){var c={isPay:""}}ting.connect.collect(null,{ids:a.id||e.options.id,type:a.type||e.options.type},function(e){i(s.$collects).tip("tipup",{msg:"已保存到我的收藏",iconClass:"tip-success"});if(ting&&ting.logger){r.state=1;ting.logger.log("collect",r)}if(ting.browser.isSpecial()){ting.browser.add2box("collect")}ting.media.collectSong(a.id)},function(e){var t="tip-error";switch(e.errorCode){case 22322:t="tip-warning";e.errTip="歌曲已被保存";break;case 22331:e.errTip="云空间已满，去<a href ='http://yinyueyun.baidu.com/' target = '_blank'>整理云空间</a>吧！";break;case 22232:e.errTip="对不起，千千音乐只能在中国内地提供服务";break;default:e.errTip="操作失败，请稍候再试";break}var o={msg:e.errTip?e.errTip:"操作失败",iconClass:t};if(e.errorCode=22331){o.showTime=5e3}if(ting&&ting.logger){r.state=e.errorCode;ting.logger.log("collect",r)}i(s.$collects).tip("tipup",o)});return false}}if(s.$collect){s.$collect.tip();var r={page:ting.logger.getPage(),pos:"collect_song",songcount:1},c="";s.$collect.bind("click",function(e){c=i(this).parents(".fun-icon");e.stopPropagation();var t=c.closest("li").index();if(ting.passport.isLogin){require(["widget/ucollect_to/ucollect_to"],function(i){i.createSonglists(t,a.id,c)});i(".fun-icon").off().on("click",".mylist-mysinglesong",g)}else{ting.passport.checkLogin(function(){location.reload()})}});function g(o){i(".mylist-mysinglesong").die("click",g);i(".songlist-collect-to").hide();var n=Number(t.data("musicicon").yyr_song_id),l=Number(t.data("musicicon").id);if(n){if(!ting.userInfo){ting.passport.checkLogin(function(){});return false}i.ajax({url:"http://y.taihe.com/data/song/favorite/add",type:"POST",dataType:"jsonp",data:{songId:l,from:"play"}}).done(function(e){if(e.errorCode!=22e3){if(e.errorCode==22322){i(s.$collect).tip("tipup",{msg:"歌曲已被保存",iconClass:"tip-error"});return false}var t=i('<div style="text-align: left;">您需要访问 <a target="_blank" href="http://y.baidu.com/">太合音乐人</a>平台，完成音乐收藏。</div>');t.dialog({className:"dialog-message",showBtn:true,confirm:{btn:"",close:true,callback:function(){window.open("http://y.taihe.com/song/"+n+"?buy="+n)},text:"立即去收藏"},cancel:false,destroy:true,title:"&nbsp;",width:360,showBg:true}).dialog("show")}else{i(s.$collect).tip("tipup",{msg:"已保存到我的收藏",iconClass:"tip-success"})}});return false}if(!c){var c={isPay:""}}ting.connect.collect(null,{ids:a.id||e.options.id,type:a.type||e.options.type},function(e){i(s.$collects).tip("tipup",{msg:"已保存到我的收藏",iconClass:"tip-success"});if(ting&&ting.logger){r.state=1;ting.logger.log("collect",r)}if(ting.browser.isSpecial()){ting.browser.add2box("collect")}ting.media.collectSong(a.id)},function(e){var t="tip-error";switch(e.errorCode){case 22322:t="tip-warning";e.errTip="歌曲已被保存";break;case 22331:e.errTip="云空间已满，去<a href ='http://yinyueyun.baidu.com/' target = '_blank'>整理云空间</a>吧！";break;case 22232:e.errTip="对不起，千千音乐只能在中国内地提供服务";break;default:e.errTip="操作失败，请稍候再试";break}var o={msg:e.errTip?e.errTip:"操作失败",iconClass:t};if(e.errorCode=22331){o.showTime=5e3}if(ting&&ting.logger){r.state=e.errorCode;ting.logger.log("collect",r)}i(s.$collects).tip("tipup",o)});return false}}if(s.$subscribe){s.$subscribe.tip();s.$subscribe.bind("click",function(t){ting.connect.collect(null,{ids:a.id||e.options.id,type:a.type||e.options.type},function(e){i(s.$subscribe).tip("tipup",{msg:"已收录",iconClass:"tip-success"});ting.media.collectSong(a.id)},function(e){if(e.errorCode=="22322"){i(s.$subscribe).tip("tipup",{msg:"该自选辑已被收录",iconClass:"tip-error"})}else{i(s.$subscribe).tip("tipup",{msg:e.errorMessage||"收录失败",iconClass:"tip-error"})}});return false})}if(s.$add){s.$add.bind("click",function(t){var s=a.type||e.options.type,r="playSong";var c={page:ting.logger.getPage(),pos:"add_song",songcount:1};switch(s){case"song":r="addSong";break;case"album":r="addAlbum";break;case"diy":r="addDiy";break;case"artist":r="addArtist";break}if(l.resourceTypeExt&&(l.resourceTypeExt==3||l.resourceTypeExt==4)){ting.checkSellResourse(l.id,l.albumId,function(i){l.isPay=i;ting.media[r](o(a.id||e.options.id),l);if(l.isPay!=1||l.siPresaleFlag==1){u("notTip")}else{u()}});c.song_title=l.songTitle;c.song_id=l.id;c.isPay=2;c.operation="click_add_icon"}else{var g=i(this);if(g.hasClass("song-add-vip")){var p=a.id||e.options.id,d=d||"";ting.checkSellResourse(p,d,function(i){var t=i;if(BDUS&&BDUS.vipState!="gold"&&t!=1){n(g,"pay_listen")}else{ting.media[r](o(a.id||e.options.id),l);u()}})}else{ting.media[r](o(a.id||e.options.id),l);u()}}function u(o){if(ting&&ting.logger&&ting.logger.plogClick){ting.logger.log("siteToBox",c);ting.logger.plogClick("add_"+s)}if(e.options.hasTip){if(o!="notTip"){i(t.target).tip().tip("tipup",{msg:"添加成功！",iconClass:"tip-success"})}}}if(ting.browser.isSpecial()){ting.browser.add2box("play")}return false})}if(s.$download){s.$download.bind("click",function(o){var n=i(this);l.isGray=n.parents("li").hasClass("song-message-gray");if(l.isGray){l.albumid=n.parents("li").data("albumid")}l.clientUrlPos="web_danqu";var s=Number(t.data("musicicon").yyr_song_id);var r={page:ting.logger.getPage(),pos:"download_song",songcount:1};if(s){if(!ting.userInfo){ting.passport.checkLogin(function(){});return false}var c=i('<div style="text-align: left;">您需要访问 <a target="_blank" href="http://y.baidu.com/">太合音乐人</a>平台，获取音乐下载。</div>');c.dialog({className:"dialog-message",showBtn:true,confirm:{btn:"",close:true,callback:function(){window.open("http://y.taihe.com/song/"+s+"?buy="+s)},text:"立即去下载"},cancel:false,destroy:true,title:"&nbsp;",width:360,showBg:true}).dialog("show");return false}if(l.resourceTypeExt&&(l.resourceTypeExt==3||l.resourceTypeExt==4)){ting.checkSellResourse(l.id,l.albumId,function(i){l.isPay=i;ting.media.downloadSong(a.id||e.options.id,"","","",l)});r.song_title=l.songTitle;r.song_id=l.id;r.isPay=2}else{if(n.hasClass("song-down-vip")){var g=a.id||e.options.id,p=p||"";ting.checkSellResourse(g,p,function(i){var t=i;if(BDUS&&BDUS.vipState!="gold"&&t!=1){ting.media.downloadSong(a.id||e.options.id,"","","",l,t)}else{ting.media.downloadSong(a.id||e.options.id,"","","",l)}})}else{ting.media.downloadSong(a.id||e.options.id,"","","",l)}}e.log(a.id||e.options.id);if(ting&&ting.logger&&ting.logger.plogClick){ting.logger.plogClick("down_song");ting.logger.log("download",r)}return false})}if(s.$songword){s.$songword.bind("click",function(i){ting.media.lyric(a.id||e.options.id);return false})}if(s.$jump){s.$jump.bind("click",function(e){var t=i(this).data("provider");var o={page:"pcweb_music",pos:"skip_button",sub:"cooperate_"+t};ting.logger.log("click",o)})}if(s.$send){s.$send.sendByClient({songId:a.id||e.options.id}).on("click",function(i){i.preventDefault();if(l.resourceTypeExt&&(l.resourceTypeExt==3||l.resourceTypeExt==4)){ting.checkSellResourse(l.id,l.albumId,function(i){l.isPay=i;if(l.isPay!=1||l.siPresaleFlag==1){ting.media.checkToSellPage(l)}else{s.$send.sendByClient("down");ting.logger.log("click",{page:ting.logger.getPage(),pos:"to_app",songid:a.id})}})}else{s.$send.sendByClient("down");ting.logger.log("click",{page:ting.logger.getPage(),pos:"to_app",songid:a.id})}})}}});i(function(){i(".music-icon-hook").musicIcon()})})(jQuery);

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/