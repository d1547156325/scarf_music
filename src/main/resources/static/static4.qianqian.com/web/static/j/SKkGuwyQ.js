define(["core/config","plugin/WebChat","ting/ting.cutString","plugin/_","plugin/aes","http://static4.qianqian.com/web/static/j/plugin/jquery.md5"],function(e,t,r){var n=e.cfg;return{tingApi:function(e,t,r){var i=$.Deferred(),a={type:"GET",dataType:"json",handleError:function(e,t,r){console.debug("tingApi error:",e,t,r)}};if(_.isArray(e)){var o=this;var s=_.map(e,function(e){return o.tingApi(e,t)});return $.when.apply(o,s)}var c=_.extend(a,r);t=t||{};t.from="web";t=n.tingApi.notAesMethod.toString().indexOf(e)>=0?t:this.aesPassEncod(t);if("https:"==document.location.protocol){t.s_protocol=1}t.from="web";var u=n.tingApi.url.replace("{{method}}",e);$.ajax({url:u,data:t,dataType:c.dataType,type:c.type,beforeSend:c.beforeSend,success:function(r){if(r){var a=Number(r.error_code);if(a){if(_.indexOf([n.tingApi.code.SUCCESS],a)!==-1){i.resolve(r)}else{i.reject(r,e,t);c.handleError(r,e,t)}}else{i.reject(r)}}else{i.reject();c.handleError("empty data error")}},error:function(){i.reject();c.handleError("ajax error")}});return i.promise()},aesPassEncod:function(e){var t=Math.floor((new Date).getTime()/1e3);var r=$.md5("baidu_taihe_music_secret_key"+t),r=r.substr(8,16),n=r;var i=[],a="";for(var o in e){i.push(o)}i.sort();for(var s=0;s<i.length;s++){var o=i[s];a+=(s===0?"":"&")+o+"="+encodeURIComponent(e[o])}var c={stringify:function(e){var t={ct:e.ciphertext.toString(CryptoJS.enc.Base64)};if(e.iv){t.iv=e.iv.toString()}if(e.salt){t.s=e.salt.toString()}return t},parse:function(e){var t=JSON.parse(e);var r=CryptoJS.lib.CipherParams.create({ciphertext:CryptoJS.enc.Base64.parse(t.ct)});if(t.iv){r.iv=CryptoJS.enc.Hex.parse(t.iv)}if(t.s){r.salt=CryptoJS.enc.Hex.parse(t.s)}return r}};var o=CryptoJS.enc.Utf8.parse(r);var n=CryptoJS.enc.Utf8.parse(r);var u=CryptoJS.AES.encrypt(a,o,{iv:n,blockSize:16,mode:CryptoJS.mode.CBC,format:c});var p=u.toString().ct;var d=$.md5("baidu_taihe_music"+p+t);var f={timestamp:t,param:p,sign:d};return f},base64Encode:function(e){var t=CryptoJS.enc.Utf8.parse(e);var r=CryptoJS.enc.Base64.stringify(t);return r},getApiCode:function(){var e=n.tingApi.code;return e},getWebChat:function(e){var r=this,n={httpInterval:1e3*10,setLetter:function(e,t){n.setUnreadM.call(this)},setNums:function(e){},setUnreadD:function(e){},setUnreadM:function(e){},setFans:function(e){}},i;if(window.webChat){n=$.extend(n,window.webChat.opt,e);i=window.webChat.callBackJson||{}}else{n=$.extend(n,e);i={}}i.main=function(e){if(e.serverid==10001||e.serverid==10002){var t=e.content;try{t=JSON.parse(e.content)}catch(i){}n.setLetter.apply(r,[e,t])}if(e.serverid==10003){n.setNums.apply(r,[e])}if(e.serverid==10003||e.serverid==10004&&e.message_type==1){n.setUnreadM.apply(r,[e])}if(e.serverid==10004&&e.message_type==2){n.setUnreadD.apply(r,[e])}if(e.serverid==10101||e.serverid==10102){n.setFans.apply(r,[e])}};if(window.webChat){window.webChat.httpInterval=n.httpInterval;window.webChat.opt=n;return window.webChat}window.webChat=new t({debug:false,reconnectInterval:1e3,httpInterval:n.httpInterval,successCallBack:function(e){$.each(i,function(t,n){n.apply(r,[e])})}});window.webChat.opt=n;window.webChat.callBackJson=i;window.webChat.onopen();return window.webChat},getSpUserInfo:function(e){var t=$.Deferred();var r={username:"未知用户名",userid:e,userpic:""};this.tingApi("baidu.ting.ugccenter.getMsgUserInfo",{type_id:e}).always(function(n){if(n.result){r=$.extend(r,n.result[e])}t.resolve(r)});return t.promise()},htmlDecode:function(e){e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");var t=document.createElement("div");t.innerHTML=e;var r=t.innerText||t.textContent;t=null;return e},dateFormat:function(e,t){e=new Date(e);var r={M:e.getMonth()+1,d:e.getDate(),h:e.getHours(),m:e.getMinutes(),s:e.getSeconds(),q:Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};t=t.replace(/([yMdwhmsqS])+/g,function(t,n){var i=r[n];if(i!==undefined){if(t.length>1){i="0"+i;i=i.substr(i.length-2)}return i}else if(n==="y"){return(e.getFullYear()+"").substr(4-t.length)}else if(n==="w"){var a;if(e.getDay()==0)a="周日";if(e.getDay()==1)a="周一";if(e.getDay()==2)a="周二";if(e.getDay()==3)a="周三";if(e.getDay()==4)a="周四";if(e.getDay()==5)a="周五";if(e.getDay()==6)a="周六";return a}return t});return t},cutString:function(e,t,n,i){var a=r.cutString;return a.cutStr(e,t,n,i)},setCookie:function(e,t,r,n){r=r||10*12*30*24*60*60*1e3;n=n||"/";var i=new Date;i.setTime(i.getTime()+r);document.cookie=e+"="+encodeURIComponent(t)+"; expires="+i.toUTCString()+"; path="+n},getCookie:function(e){var t="(?:; )?"+encodeURIComponent(e)+"=([^;]*);?";t=new RegExp(t);if(t.test(document.cookie)){return decodeURIComponent(RegExp.$1)}return""},getQueryString:function(e){var t={};if(e=void 0!==e?e:window.location.search,"string"==typeof e&&e.length>0){"?"===e[0]&&(e=e.substring(1)),e=e.split("&");for(var r=0,n=e.length;n>r;r++){var i,a,o=e[r],s=o.indexOf("=");s>=0?(i=o.substr(0,s),a=o.substr(s+1)):(i=o,a=""),a=decodeURIComponent(a),void 0===t[i]?t[i]=a:t[i]instanceof Array?t[i].push(a):t[i]=[t[i],a]}}return t}}});

/** If u are interested in our code and would like to make it robust, just contact us^^ <@音乐前端> **/
/** Generated by M3D. **/